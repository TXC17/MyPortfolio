try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{})["__faroBundleId_gptengineer-app"]="17638416719484a12ecf001"}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4179],{4075:(e,s,a)=>{a.d(s,{N:()=>N});var t=a(77145),i=a(81496),n=a(95661),r=a(46753),l=a.n(r),o=a(13410),c=a(92912),d=a(56024),u=a(77214),m=a(52811),p=a(69730),x=a(40074);let h=e=>{let{type:s,message:a,persistDismiss:i=!1,storageKey:r,bgColor:h,href:j,onClick:g,className:f,darkCloseIcon:v=!1}=e,y=(0,o.usePathname)(),b=(0,n.useRef)(null),[N,w]=(0,u.V)(r||"default-banner-key",{defaultValue:!0}),[k,C]=(0,n.useState)(!1),[_,S]=(0,n.useState)(!1);(0,n.useEffect)(()=>{S(!0),C(!0)},[]);let E=(null==y?void 0:y.startsWith("/projects/"))&&["ph-launch-banner","rebrand-banner"].includes(r||""),P=!E&&(i?N:k);if(E)return null;if(i&&!r)return console.error("storageKey is required when persistDismiss is true"),null;if(!P||x.env.TEST_E2E)return null;let I=(0,t.jsxs)("div",{ref:b,className:(0,d.cn)("z-[1050] hidden w-full items-center justify-between px-2 py-2 text-sm text-white transition-opacity duration-300 md:px-4 md:text-base",h||("error"===s?"bg-destructive-primary":"bg-background"),f,_&&"flex"),children:[(0,t.jsx)("div",{className:"flex flex-grow items-center justify-center space-x-4 pr-6 md:text-center",children:a}),(0,t.jsx)(m.$,{variant:"ghost",size:"icon",className:(0,d.cn)("hover:bg-transparent md:absolute md:right-2",v?"text-primary-foreground hover:text-primary-foreground":"text-primary"),onClick:e=>{e.preventDefault(),e.stopPropagation(),i?w(!1):C(!1),c.Ay.capture("banner_dismissed",{banner_type:s,message:a,persisted:i})},children:(0,t.jsx)(p.A,{name:"x_small"})})]});return j?(0,t.jsx)(l(),{href:j,target:"_blank",rel:"noopener noreferrer",onClick:g,className:"w-full",children:I}):I};var j=a(35418),g=a(28717),f=a(27458),v=a(47226),y=a(41541);let b=()=>{let{userData:e}=(0,g.ur)(),{advocateCredits:s,isLoading:a}=(0,y.H)(),[i,r]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{null===window.localStorage.getItem("hide_referral_banner_".concat(null==e?void 0:e.id))&&e&&((null==e?void 0:e.referred_by_workspace)===void 0||(null==e?void 0:e.qualified_referral)||r(!0))},[e]),i)?(0,t.jsxs)("div",{className:(0,d.cn)("z-[1050] flex w-full items-center justify-between border-b bg-muted px-2 py-4 text-sm text-foreground transition-opacity duration-300 md:px-4 md:text-base"),children:[(0,t.jsxs)("div",{className:"flex flex-grow items-center justify-center space-x-4 md:text-center",children:[(0,t.jsxs)("span",{children:["You've signed up using a referral link. Publish your first project and reward your friend with"," ",a?(0,t.jsx)(v.E,{className:"inline-block h-4 w-16"}):(0,t.jsxs)("b",{children:[s," bonus credits"]}),"."]}),(0,t.jsx)(f.Fy,{className:"hidden size-4 lg:block"})]}),(0,t.jsx)(m.$,{variant:"ghost",size:"icon",className:"text-primary hover:bg-transparent md:absolute md:right-2",onClick:()=>{window.localStorage.setItem("hide_referral_banner_".concat(null==e?void 0:e.id),"true"),r(!1)},children:(0,t.jsx)(p.A,{name:"x_small"})})]}):null},N=e=>{let{className:s}=e,[a,r]=(0,n.useState)({showStatusBanner:!1,statusBannerContent:"",statusBannerLink:""});if((0,n.useEffect)(()=>{(async()=>{try{let e=(0,i.H9)(j.db,"system","info"),s=await (0,i.x7)(e);s.exists()&&r(s.data())}catch(e){console.error("Failed to fetch system info:",e)}})()},[]),!a.showStatusBanner||!a.statusBannerContent)return(0,t.jsx)(b,{});let l=a.statusBannerSeverity||"incident";return(0,t.jsx)(h,{message:a.statusBannerContent,type:"error",bgColor:{incident:"bg-destructive-primary",warning:"bg-warning-primary",info:"bg-accent-primary"}[l],className:s,href:a.statusBannerLink})}},19525:(e,s,a)=>{a.d(s,{m:()=>P});var t=a(77145),i=a(92912),n=a(95661),r=a(83220),l=a(52811),o=a(21921),c=a(69994),d=a(92763),u=a(39528),m=a(56024),p=a(33966),x=a(19695);let h=()=>{let e=(0,r.j4)(e=>e.currentWorkspace),{isLowOnCredits:s}=(0,d.S)(e),a=(0,c.D)(e),h=(0,o.s)(),j=(0,p.X5)(),g=a.totalRemaining;return((0,n.useEffect)(()=>{s&&i.Ay.capture(u.ZK.WORKSPACE_MODAL.PROMPT_SHOWN,{credits_remaining:g,current_plan:null==e?void 0:e.plan})},[s,g,null==e?void 0:e.plan]),s)?(0,t.jsx)("div",{"data-nudge":!0,className:"relative -mt-6 flex w-full flex-col rounded-b-xl border border-t-0 border-border bg-background md:rounded-b-lg md:border-muted-border",children:(0,t.jsxs)("div",{className:"flex h-full w-full items-stretch justify-between gap-2 pb-2 pl-2 pr-1 pt-8",children:[(0,t.jsx)("div",{className:"relative flex flex-1 items-start gap-2 p-1 pl-0",children:(0,t.jsx)("div",{className:(0,m.cn)("ml-0 flex flex-1 gap-1 pl-0.5"),children:(0,t.jsx)("span",{className:"text-sm font-normal text-foreground",children:"Low on credits?"})})}),(0,t.jsx)("div",{className:"flex items-start gap-1 self-stretch pr-1",children:(0,t.jsx)("div",{className:"flex h-full flex-col items-center justify-start gap-1",children:(0,t.jsx)(x.Q,{showTooltip:!h,tooltipContent:"Ask the workspace owner to top up",children:(0,t.jsx)(l.$,{variant:"affirmative",size:"sm",onClick:()=>{i.Ay.capture(u.ZK.WORKSPACE_MODAL.BUTTON_CLICKED,{credits_remaining:g,current_plan:null==e?void 0:e.plan}),j()},className:"w-full gap-1.5",disabled:!h,children:"Add credits"})})})})]})}):null};var j=a(8974),g=a(89006),f=a(63025),v=a(47679),y=a(69730),b=a(58295),N=a(43610),w=a(53792),k=a(72632),C=a(87252),_=a(63424);let S=e=>{let{workspace:s,isOwnerOfWorkspace:a,membership:i}=e,n=(0,c.D)(s),{openSettings:r}=(0,v.t)(),{userMonthlyUsage:l,maxUserMonthlyUsage:o,hasCreditLimit:d}=(0,N.$)(s),{isBizPlan:u,isFreePlan:p,isLitePlan:x}=(0,k.cb)(s.plan),h=(0,_.x_)(n.currentlyConsuming,n.sources),S=(0,j.GP)((0,g.w)((0,f.P)(new Date,1)),"dd MMM");return(0,t.jsxs)("div",{className:"z-10 flex flex-col gap-2.5 rounded-xl bg-muted p-4 md:rounded-lg md:p-3",children:[(0,t.jsxs)("div",{className:(0,m.cn)("flex items-center justify-between",{"cursor-pointer transition-all duration-150 ease-in-out hover:opacity-80":a}),onClick:a?()=>{r("billing")}:void 0,children:[(0,t.jsx)("p",{className:"text-base font-medium text-foreground md:text-sm",children:"Credits"}),(0,t.jsxs)("div",{className:"flex items-center gap-px",children:[(0,t.jsx)("p",{className:(0,m.cn)("text-base font-normal md:text-sm",0===n.totalRemaining&&a?"text-foreground":"text-muted-foreground"),children:0===n.totalRemaining&&a?"Upgrade":0===n.totalRemaining?"0 left":"".concat((0,C.Q)(n.totalRemaining)," left")}),a&&(0,t.jsx)(y.A,{name:"chevron_right",size:"small",className:(0,m.cn)(0===n.totalRemaining?"text-foreground":"text-muted-foreground")})]})]}),(0,t.jsx)(_.bY,{progressData:n}),(n.currentlyConsuming||0===n.totalRemaining)&&!p&&(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"h-2 w-2 rounded-full ".concat(h)}),(0,t.jsx)("p",{className:"text-base text-muted-foreground md:text-sm",children:(0,_.bT)(n.currentlyConsuming)})]}),(p||x)&&(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"h-2 w-2 rounded-full bg-muted-foreground"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:n.totalCreditsUsedInBillingPeriod>=w.le?"Free credits reset on ".concat(S):"Daily credits reset at midnight UTC"})]}),u&&(0,t.jsx)("div",{className:"flex flex-col gap-2.5",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("p",{className:"text-base font-medium text-foreground md:text-sm",children:"Personal usage"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("p",{className:"text-base font-normal text-muted-foreground md:text-sm",children:[(0,C.Q)(l),d&&" / ".concat((0,C.Q)(o))]}),(0,t.jsxs)(b.m_,{children:[(0,t.jsx)(b.k$,{asChild:!0,children:(0,t.jsx)("div",{children:(null==i?void 0:i.role)!=="owner"&&d&&(0,t.jsx)(y.A,{name:"info",size:"small",className:"h-4 w-4 cursor-pointer text-muted-foreground"})})}),(null==i?void 0:i.role)!=="owner"&&d&&(0,t.jsx)(b.ZI,{children:(0,t.jsx)("p",{children:"Ask your workspace admin to increase the limit"})})]})]})]})})]})};var E=a(15365);let P=e=>{let{workspace:s,membership:a,className:i}=e,n=(0,E.WW)();if("inactive"===s.plan)return null;let r=(null==a?void 0:a.role)==="owner"||(null==a?void 0:a.role)==="admin",{isBizPlan:l,isEnterprisePlan:o}=(0,k.cb)(s.plan);return o?null:(0,t.jsx)("div",{className:(0,m.cn)("flex flex-col",i),children:(!(l&&!r)||n)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S,{workspace:s,isOwnerOfWorkspace:(null==a?void 0:a.role)==="owner",membership:a}),(0,t.jsx)(h,{})]})})}},20098:(e,s,a)=>{a.d(s,{T:()=>r});var t=a(77145),i=a(95661),n=a(58295);let r=e=>{let[s,a]=(0,i.useState)(!1),r=(0,i.useRef)(void 0),l=(0,i.useCallback)(e=>{e&&(clearTimeout(r.current),navigator.clipboard.writeText(e),a(!0),r.current=setTimeout(()=>{a(!1)},1e3))},[]);return a=>{let{TriggerComponent:i,textToCopy:r,copiedFeedbackText:o="Copied!"}=a;return(0,t.jsx)(n.Bc,{children:(0,t.jsxs)(n.m_,{open:s,children:[(0,t.jsx)(n.k$,{onClick:s=>{(null==e||!e.altKey||s.altKey)&&r&&l(r)},asChild:!0,className:"hello",children:(0,t.jsx)(i,{})}),(0,t.jsx)(n.ZI,{children:(0,t.jsx)("p",{children:o})})]})})}}},20795:(e,s,a)=>{a.d(s,{b:()=>t});let t=e=>e.replace(/(^\w+:|^)\/\//,"")},20834:(e,s,a)=>{a.d(s,{O:()=>S});var t=a(77145),i=a(95661),n=a(89391),r=a(83220),l=a(61374),o=a(49493),c=a(52811),d=a(20247),u=a(67539),m=a(87299),p=a(6698),x=a(31088),h=a(40702),j=a(83473),g=a(63851),f=a(19620),v=a(69850),y=a(69427),b=a(56024),N=a(74507),w=a(57841),k=a(34895),C=a(19695),_=a(69730);function S(e){let{trigger:s,projectId:a,projectName:S,open:E,setOpen:P,isRootDialog:I=!1}=e,A=(0,o.Mu)(e=>e.workspaces),L=A.length>1,{permitted:D}=(0,l.J)(N.eZ.TransferProject),{moveProjectToWorkspace:z,isMovingProject:F}=(e=>{let{onSettled:s}=e,{authUser:a}=(0,h.Z2)(),t=(0,m.jE)(),{mutate:i,isPending:n}=(0,p.n)({mutationFn:async e=>{let{projectId:s,workspaceId:t,sourceWorkspaceId:i}=e;if(!a)throw Error("User must be logged in to move projects");let n=(0,g.P)();await n.put("/projects/".concat(s,"/move-to-workspace"),{workspace_id:t})},onSuccess:async(e,s)=>{t.invalidateQueries({queryKey:v.workspaceKeys.detail(s.sourceWorkspaceId)}).catch(e=>{f.logging.error("Failed to invalidate source workspace queries after project transfer",{error:e})}),t.invalidateQueries({queryKey:v.workspaceKeys.detail(s.workspaceId)}).catch(e=>{f.logging.error("Failed to invalidate destination workspace queries after project transfer",{error:e})}),t.invalidateQueries({queryKey:v.gO.detail(s.projectId)}).catch(e=>{f.logging.error("Failed to invalidate project query after transfer",{error:e})}),x.toast.success("Project moved successfully",{description:"Moved project to ".concat(s.workspaceName||"new workspace")})},onError:e=>{(0,j.Ni)(e)},onSettled:()=>{null==s||s()}});return{moveProjectToWorkspace:i,isMovingProject:n}})({onSettled:()=>{U(!1),B("")}}),T=(0,r.QY)(),O=(0,r.j4)(e=>e.currentWorkspace),[M,R]=(0,i.useState)(!1),U=P||R,$=async e=>{a&&O&&z({projectId:a,workspaceId:e.id,workspaceName:e.name,sourceWorkspaceId:O.id})},[q,B]=(0,i.useState)(""),W=(0,o.Mu)(e=>e.setShowCreateWorkspaceDialog),G=!D||!L,K=A.find(e=>e.id===q),V=(0,y.G)(K);if(!T||null==O)return null;let Y=K?V:null;return(0,t.jsxs)(d.lG,{open:P?E:M,onOpenChange:U,children:[!I&&(0,t.jsx)(C.Q,{showTooltip:G,tooltipContent:D?L?"":"You need to be a member of another workspace to transfer projects.":"You don't have permission to transfer this project",children:(0,t.jsx)(d.zM,{asChild:!0,disabled:G,children:s||(0,t.jsx)(c.$,{variant:"default",disabled:G,children:"Transfer"})})}),(0,t.jsxs)(d.Cf,{size:"sm",children:[(0,t.jsxs)(d.c7,{children:[(0,t.jsxs)(d.L3,{className:"text-left",children:["Transfer ",S||"Project"]}),(0,t.jsxs)(d.rr,{className:"text-left",children:[(0,t.jsx)("p",{children:K?(0,t.jsxs)("span",{children:["Moving this project to ",(0,t.jsx)("span",{className:"font-medium",children:K.name})," will:"]}):(0,t.jsx)("span",{children:"Moving this project to a new workspace will:"})}),(0,t.jsxs)("ul",{className:"list-disc pl-4 text-sm",children:[(0,t.jsxs)("li",{children:["Remove access for members of ",(0,t.jsx)("span",{className:"font-medium",children:O.name})]}),(0,t.jsxs)("li",{children:["Grant access to members of"," ",K?(0,t.jsx)("span",{className:"font-medium",children:null==K?void 0:K.name}):(0,t.jsx)("span",{children:"the new workspace"})]}),(0,t.jsx)("li",{children:"Preserve access for anyone directly invited to the project"}),(0,t.jsx)("li",{children:"May require you to re-link GitHub and Supabase organizations/projects"})]}),(0,t.jsxs)(k.Fc,{className:(0,b.cn)(!Y&&"hidden","text-sm","mt-4"),children:[(0,t.jsx)(_.A,{name:"info_circle",className:"h-4 w-4"}),(0,t.jsx)(k.XL,{children:"Warning"}),(0,t.jsxs)(k.TN,{className:"text-sm",children:["This action will make the project ",(0,t.jsx)("span",{className:"font-medium",children:"draft"===Y?"personal":"private"===Y?"private":"public"})]})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"min-w-[60px] text-sm font-medium",children:"From"}),(0,t.jsxs)("div",{className:"flex w-full items-center gap-2 rounded-md border px-2 py-1.5 opacity-70",children:[(0,t.jsx)(w.z,{workspace:O,className:"h-5 w-5 rounded-[6px]"}),(0,t.jsx)("p",{className:"text-sm",children:null==O?void 0:O.name}),(0,t.jsx)(n.U,{plan:null==O?void 0:O.plan})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"min-w-[60px] text-sm font-medium",children:"To"}),(0,t.jsxs)(u.l6,{value:q,onValueChange:B,children:[(0,t.jsx)(u.bq,{className:"px-2 py-1.5",children:(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)(u.yv,{placeholder:"Select a workspace",className:"mr-auto"})})}),(0,t.jsxs)(u.gC,{children:[A.map(e=>{var s,a,i,r,l,o;return(0,t.jsx)(u.eb,{value:e.id,disabled:e.id===O.id||(null==(s=e.membership)?void 0:s.role)!=="owner"&&(null==(a=e.membership)?void 0:a.role)!=="admin"&&(null==(i=e.membership)?void 0:i.role)!=="member",className:"focus:bg-accent/50",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(w.z,{workspace:e,className:"h-5 w-5 rounded-[6px]"}),(0,t.jsx)("p",{children:e.name}),e.plan&&(0,t.jsx)(n.U,{plan:e.plan}),(null==(r=e.membership)?void 0:r.role)!=="owner"&&(null==(l=e.membership)?void 0:l.role)!=="admin"&&(null==(o=e.membership)?void 0:o.role)!=="member"&&(0,t.jsx)("span",{className:"text-sm text-destructive-foreground",children:"(Not an editor)"})]})},e.id)}),(0,t.jsxs)("button",{className:"flex w-full items-center gap-2 rounded-sm px-2 py-1.5 text-sm hover:bg-accent",onClick:()=>{W(!0)},children:[(0,t.jsx)("div",{className:"flex h-5 w-5 items-center justify-center",children:(0,t.jsx)(_.A,{name:"plus_small",size:"small"})}),"Create new"]})]})]})]})]}),(0,t.jsxs)(d.Es,{className:"gap-2",children:[(0,t.jsx)(c.$,{size:"sm",variant:"outline",onClick:()=>U(!1),children:"Cancel"}),(0,t.jsx)(c.$,{disabled:!K,variant:"affirmative",size:"sm",onClick:()=>{K&&$(K)},loading:F,children:F?"Transferring...":"Confirm transfer"})]})]})]})}},28214:(e,s,a)=>{a.d(s,{$:()=>h});var t=a(77145),i=a(26294),n=a(92912),r=a(53986),l=a(83220),o=a(51762),c=a(69730),d=a(39528),u=a(72632),m=a(56024),p=a(8711),x=a(72723);let h=()=>{let e=(0,i.c3)("EarnFreeCredits"),s=(0,o.f)(r.E),a=(0,x.Q)(),h=(0,l.j4)(e=>{var s;return null==(s=e.currentWorkspace)?void 0:s.plan}),{isEnterprisePlan:j}=(0,u.cb)(h);return j?null:(0,t.jsxs)(p._2,{onClick:()=>{n.Ay.capture(d.h6.OPENED_DIALOG,{button_used:"menu_item",was_highlighted:a.shouldHighlight}),s({childProps:{onSuccess:()=>s(!1)}})},className:(0,m.cn)(a.shouldHighlight&&"text-accent-foreground"),children:[(0,t.jsx)(c.A,{name:"gift",size:"small"}),(0,t.jsx)("span",{children:e("getFreeCredits")})]})}},34883:(e,s,a)=>{a.d(s,{default:()=>t$});var t=a(77145),i=a(13410),n=a(95661),r=a(55966),l=a(83220),o=a(61374),c=a(47679),d=a(28717),u=a(75417),m=a(71148),p=a(46753),x=a.n(p),h=a(92912),j=a(31088),g=a(9059),f=a.n(g),v=a(63851),y=a(19620),b=a(31443);let N=(e,s)=>{let{txtToken:a}=s,t="development"===e?"185.158.133.10":"185.158.133.1";return{domain:[{type:"A",host:"@",value:t,ttl:300},{type:"TXT",host:"_lovable",value:"lovable_verify=".concat(a),ttl:300}],subDomain:[{type:"A",host:"{SUBDOMAIN}",value:t,ttl:300},{type:"TXT",host:"_lovable.{SUBDOMAIN}",value:"lovable_verify=".concat(a),ttl:300}]}},w={primary:"#1C1C1C",onPrimary:"#FAF7F2",secondary:"#1C1C1C",onSecondary:"#F5F0E6",headerBackground:"#1C1C1C",interactive:"#4E93FF",premiumBadge:"#4E93FF",onPremiumBadge:"#F3FAFF",priceBadge:"#1C1C1C",onPriceBadge:"#FAF7F2",activating:"#4E93FF",onActivating:"#F3FAFF",bg:"#4E93FF",fg:"#F3FAFF",links:"#1C1C1C",buttons:{border:{style:"none",radius:"8px"}},lightBox:{color:"rgba(0, 0, 0, 0.5)"}};async function k(){return(0,v.P)().get("/entri/token")}var C=a(6698),_=a(83473);let S=e=>{let{projectId:s,silent:a=!1}=e;return(0,C.n)({mutationFn:async e=>{let{domainId:a}=e,t=(0,v.P)();await t.delete("/projects/".concat(s,"/v2/domains/").concat(a))},onSuccess:()=>{a||j.toast.success("Domain removed",{description:"Your custom domain was successfully removed from the project."})},onError:e=>{a||(0,_.Ni)(e)}})};var E=a(39528),P=a(9898),I=a(52037),A=a(75222),L=a(52811),D=a(20247),z=a(27549),F=a(69730),T=a(6397),O=a(27458),M=a(24500);let R=A.Ik({domain:A.Yj().min(1,{message:"Please enter a domain name"}).transform(e=>e.trim().replace(/^https?:\/\//i,"")).pipe(A.Yj().regex(/^(?:[a-zA-Z0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF](?:[a-zA-Z0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF_-]{0,61}[a-zA-Z0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])?\.)+[a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}$/,{message:"Please enter a valid domain name (e.g., example.com)"}))}),U=e=>{let{mode:s,projectId:a,projectName:i,onSuccess:r,onClose:l}=e,o=(0,C.n)({mutationFn:async e=>{let{projectId:s,domain:a,mode:t}=e;return(0,v.P)().post("/projects/".concat(s,"/v2/domains"),{domain:a,mode:t})}}),c=S({projectId:a,silent:!0}),[d,u]=(0,n.useState)(!1),m=(0,I.mN)({resolver:(0,P.u)(R),defaultValues:{domain:"buy"===s?"".concat(i,".com"):""}}),p=async e=>{m.clearErrors("domain");try{let t=await o.mutateAsync({projectId:a,domain:e.domain,mode:s}),i={domain:t.domain,id:t.domain_id,txtToken:t.txt_token};u(!0);try{await r(i)}catch(t){try{await c.mutateAsync({domainId:i.id})}catch(e){y.logging.error("Failed to delete domain after Entri error",{error:e,projectId:a,domainId:i.id})}let s="Unable to start domain flow. Please try again.";t instanceof Error&&t.message&&(s=t.message),u(!1),m.setError("domain",{type:"entri",message:s}),y.logging.error("Failed to start Entri flow",{error:t,projectId:a,domain:e.domain})}}catch(t){let s="Failed to create domain";t instanceof M.L&&(s=t.details||t.message||s),m.setError("domain",{type:"server",message:s}),y.logging.error("Failed to create domain",{error:t,projectId:a,domain:e.domain})}},x=o.isPending||d;return(0,t.jsx)(D.lG,{open:!0,onOpenChange:e=>!e&&!x&&l(),children:(0,t.jsxs)(D.Cf,{size:"sm",children:[(0,t.jsxs)(D.c7,{children:[(0,t.jsx)("div",{className:"flex py-4",children:(0,t.jsx)(O.Fy,{className:"h-12 w-12"})}),(0,t.jsx)(D.L3,{children:"Custom domain"}),(0,t.jsx)(D.rr,{children:"buy"===s?"Enter the domain name you'd like to purchase through Ionos.":"Enter the domain name you'd like to connect to your project."})]}),(0,t.jsx)(z.lV,{...m,children:(0,t.jsxs)("form",{onSubmit:m.handleSubmit(p),className:"space-y-4",children:[(0,t.jsx)(z.zB,{control:m.control,name:"domain",render:e=>{let{field:s}=e;return(0,t.jsxs)(z.eI,{children:[(0,t.jsx)(z.lR,{htmlFor:"domain",children:"Domain Name"}),(0,t.jsx)(z.MJ,{children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(F.A,{name:"link",className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:"small"}),(0,t.jsx)(T.p,{id:"domain",...s,autoFocus:!0,disabled:x,className:"pl-10"})]})}),(0,t.jsx)(z.Rr,{children:"e.g., example.com or subdomain.example.com"}),(0,t.jsx)(z.C5,{})]})}}),(0,t.jsxs)(D.Es,{children:[(0,t.jsx)(L.$,{variant:"outline",type:"button",onClick:l,disabled:x,children:"Cancel"}),(0,t.jsx)(L.$,{variant:"affirmative",type:"submit",disabled:x,className:"flex items-center gap-2",children:x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(F.A,{name:"progress_activity",className:"animate-spin",size:"small"}),"Processing..."]}):"buy"===s?"Buy domain":"Connect domain"})]})]})})]})})};var $=a(32388),q=a(63875),B=a(72938),W=a(95018),G=a(3555),K=a(60617),V=a(77563),Y=a(56770),Z=a(75996);let Q=e=>{let{project:s,open:a,closeModal:i,title:r,description:l}=e,[o,d]=(0,n.useState)(null),[u,m]=(0,n.useState)(""),{securitySummary:p}=(0,B.t)(),x=p.errorCount>0,{errorMessage:h,isBuildError:j,handlePublish:g,handlePublishAnyway:f,publishMutation:v}=(0,q.I)({projectId:s.id,hasCriticalSecurityIssues:x,setDialogState:d,projectUrl:s.url||void 0}),{handleSecurityReview:b}=(e=>{let{projectId:s,setIsOpen:a}=e,t=(0,G.Qd)({projectId:s,onSuccess:()=>{null==a||a(!1)}});return{handleSecurityReview:()=>{if(!s)return void y.logging.error("project id is missing, can't start security review");t.mutate({body:{message:"Please perform a comprehensive security review of my project.",id:(0,W.A)(),intent:K.a.SECURITY_REVIEW,chat_only:!0}})}}})({projectId:s.id}),{closeSettings:N}=(0,c.t)(),w=(0,n.useCallback)(()=>{d(null),N(),b(),i()},[b,i,N]);return(0,n.useEffect)(()=>{v.isSuccess&&"confirm"!==o&&"failed"!==o&&i()},[v.isSuccess,o,i]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(D.lG,{open:a,onOpenChange:e=>{e||i()},children:(0,t.jsxs)(D.Cf,{size:"sm",children:[(0,t.jsxs)(D.c7,{children:[(0,t.jsx)("div",{className:"flex py-4",children:(0,t.jsx)(O.Fy,{className:"h-12 w-12"})}),(0,t.jsx)(D.L3,{children:r}),(0,t.jsx)(D.rr,{children:l})]}),!(null==s?void 0:s.name)&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(V.Label,{htmlFor:"publish-subdomain-input",children:"URL subdomain (optional)"}),(0,t.jsx)($.B,{value:u,onChange:m,id:"publish-subdomain-input",className:"h-10",wrapperClassName:"px-3"})]}),(0,t.jsxs)(D.Es,{children:[(0,t.jsx)(L.$,{variant:"outline",onClick:i,disabled:v.isPending,children:"Cancel"}),(0,t.jsx)(L.$,{variant:"affirmative",onClick:()=>{g((null==s?void 0:s.name)?void 0:u)},disabled:v.isPending,className:"flex items-center gap-2",children:v.isPending?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(F.A,{name:"progress_activity",className:"animate-spin",size:"small"}),"Publishing..."]}):"Publish"})]})]})}),(0,t.jsx)(Y.h,{open:"failed"===o,onOpenChange:e=>d(e?"failed":null),errorMessage:h,isBuildError:j}),(0,t.jsx)(Z.Z,{open:"confirm"===o,onOpenChange:e=>d(e?"confirm":null),onPublishAnyway:()=>{f((null==s?void 0:s.name)?void 0:u)},onReviewIssues:w})]})},H=e=>{let{project:s,mode:a,close:i,existingDomain:r}=e,l=(0,n.useRef)(!1),o=S({projectId:s.id,silent:!0}),[c,d]=(0,n.useState)(null),{status:u,error:m,buyDomain:p,connectDomain:x}=(e=>{let{onClose:s}=e,[a,t]=(0,n.useState)(null),[i,r]=(0,n.useState)("loading"),[l,o]=(0,n.useState)(null),c=(0,n.useRef)(!1);(0,n.useEffect)(()=>{c.current||(c.current=!0,(async()=>{try{r("loading"),o(null);let[e]=await Promise.all([k(),f().load()]);t(e),r("ready")}catch(e){y.logging.error("Failed to initialize Entri",{error:e}),o("Unable to load domain service. Please try again later."),r("error")}})())},[]);let d=(0,n.useCallback)(e=>{null==s||s(e.detail)},[s]);(0,n.useEffect)(()=>{if(s)return window.addEventListener("onEntriClose",d,!1),()=>{window.removeEventListener("onEntriClose",d)}},[d,s]);let u=(0,n.useCallback)(async function(e,s){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("ready"!==i||!a)throw Error("Entri is not ready");let l=N("production",s),c={...a,prefilledDomain:s.domain,dnsRecords:l,userId:JSON.stringify({domain_id:s.id,version:2}),monitor:!0,sellVersion:"v3",hostRequired:!1,whiteLabel:{customCopy:{initialScreen:{title:{en:"Use your domain with Lovable"}}},theme:w,logo:"https://lovable.dev/img/pwa/logo-192x192.png",sell:{partnerLogo:"https://lovable.dev/img/lovable-logo-text-nav.png",overlayScreenHeight:"75%",flowTarget:"_blank"}}};try{"buy"===e?await f().purchaseDomain(c):await f().showEntri(c)}catch(a){if(!n){let a;y.logging.info("Attempting to refresh Entri token");try{a=await k()}catch(e){y.logging.error("Failed to refresh Entri token",{error:e}),o("Unable to load domain service. Please try again later."),r("error");return}return t(a),u(e,s,!0)}throw y.logging.error("Entri ".concat(e," flow failed after retry"),{error:a}),a}},[a,i]);return{status:i,error:l,buyDomain:(0,n.useCallback)(async e=>{o(null),await u("buy",e)},[u]),connectDomain:(0,n.useCallback)(async e=>{o(null),await u("connect",e)},[u])}})({onClose:(0,n.useCallback)(async e=>{if(!c)return;let t=(0,v.P)();if(e.success){h.Ay.capture(E.$6.CUSTOM_DOMAIN.ENTRI_MODAL_SUCCEEDED,{mode:a,project_id:s.id,domain_id:c.id,domain:c.domain,version:2});try{await t.post("/projects/".concat(s.id,"/v2/domains/").concat(c.id,"/entri-completed")),j.toast.success("Domain connected!",{description:"The domain ".concat(c.domain," is now mapped to your project. It might take a few minutes to propagate.")})}catch(e){y.logging.error("Failed to mark domain as entri completed",{error:e,projectId:s.id,domainId:c.id}),j.toast.error("Domain connection failed",{description:"There was an error finalizing your domain connection. Please try again."})}}else await o.mutateAsync({domainId:c.id}),h.Ay.capture(E.$6.CUSTOM_DOMAIN.ENTRI_MODAL_CANCELLED,{mode:a,project_id:s.id,domain_id:c.id,domain:c.domain,version:2});i()},[s.id,i,a,o,c])});(0,n.useEffect)(()=>{m&&(j.toast.error("Domain Service Error",{description:m}),i())},[m,i]);let g=(0,n.useCallback)(async e=>{if("ready"!==u)throw Error("Entri is not ready");d(e),h.Ay.capture(E.$6.CUSTOM_DOMAIN.ENTRI_MODAL_SHOWN,{mode:a,project_id:s.id,domain_id:e.id,domain:e.domain,version:2}),"buy"===a?await p(e):await x(e)},[u,a,s.id,p,x]);(0,n.useEffect)(()=>{if(!s.url||!(null==r?void 0:r.txtToken)||"ready"!==u||l.current)return;l.current=!0;let e={domain:r.domain,id:r.id,txtToken:r.txtToken};(async()=>{try{await g(e)}catch(s){let e=s instanceof Error&&s.message?s.message:"Unable to start domain flow. Please try again.";j.toast.error("Domain Flow Error",{description:e}),i()}})()},[s.url,r,u,g,i]);let b=!s.url,C=s.url&&!r;if(b){let e="buy"===a?"buy and connect":"connect";return(0,t.jsx)(Q,{open:b,project:s,title:"Publish to connect a domain",description:"In order to ".concat(e," a custom domain you need to publish your project first"),closeModal:()=>{var e,t;h.Ay.capture(E.$6.CUSTOM_DOMAIN.PUBLISH_CANCELLED,{mode:a,project_id:s.id,domain_id:null!=(e=null==c?void 0:c.id)?e:null==r?void 0:r.id,domain:null!=(t=null==c?void 0:c.domain)?t:null==r?void 0:r.domain,version:2}),i()}})}return C?(0,t.jsx)(U,{mode:a,projectId:s.id,projectName:s.name,onSuccess:g,onClose:i}):null};var J=a(66531),X=a(27623),ee=a(26158),es=a(52873),ea=a(6272),et=a(34895),ei=a(58295),en=a(17693);function er(e){let{value:s}=e;return(0,t.jsxs)("div",{className:"flex flex-wrap gap-0.5 sm:gap-1",children:[(0,t.jsx)("div",{className:"min-w-0 break-all font-mono",children:s}),(0,t.jsx)(en.i,{text:s,stopPropagation:!0,className:"flex-shrink-0 opacity-100 transition-opacity sm:opacity-0 sm:group-hover:opacity-100"})]})}let el=e=>{let{dnsRecords:s,showDriftedMessage:a}=e;return(0,t.jsxs)("div",{className:"rounded-lg border border-input px-4 py-3 @container",children:[(0,t.jsx)("p",{className:"mb-3 text-sm text-muted-foreground @sm:mb-4",children:a?"Add the following DNS records in your domain's settings":"If the status doesn't update automatically, please verify that your DNS records are set up correctly"}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5 @sm:gap-2",children:[(0,t.jsxs)("div",{className:"grid grid-cols-[40px_90px_1fr] gap-1.5 text-xs font-medium text-muted-foreground @sm:grid-cols-[40px_140px_1fr] @sm:gap-2 @md:grid-cols-[40px_1fr_2fr] @md:gap-3",children:[(0,t.jsx)("div",{children:"Type"}),(0,t.jsx)("div",{children:"Host"}),(0,t.jsx)("div",{children:"Value"})]}),s.map(e=>(0,t.jsxs)("div",{className:"group grid grid-cols-[40px_90px_1fr] gap-1.5 bg-muted/30 py-1.5 text-xs @sm:grid-cols-[40px_140px_1fr] @sm:gap-2 @md:grid-cols-[40px_1fr_2fr] @md:gap-3",children:[(0,t.jsx)("div",{className:"font-medium",children:e.type}),(0,t.jsx)(er,{value:e.host}),(0,t.jsx)(er,{value:e.value})]},"".concat(e.type,"-").concat(e.host,"-").concat(e.value)))]})]})};var eo=a(8711);let ec=e=>{let{open:s,onOpenChange:a,utf8Domain:i,onConfirm:n,isDeleting:r}=e;return(0,t.jsx)(D.lG,{open:s,onOpenChange:a,children:(0,t.jsxs)(D.Cf,{size:"sm",children:[(0,t.jsxs)(D.c7,{children:[(0,t.jsxs)(D.L3,{children:["Remove ",i,"?"]}),(0,t.jsx)(D.rr,{children:"This will disconnect the domain from this project. You will need to reconfigure it if you want to use it with this project in the future."})]}),(0,t.jsxs)(D.Es,{children:[(0,t.jsx)(L.$,{variant:"outline",size:"sm",onClick:()=>a(!1),children:"Cancel"}),(0,t.jsx)(L.$,{variant:"destructive",size:"sm",onClick:n,loading:r,children:"Remove"})]})]})})};var ed=a(87299),eu=a(78623);let em=e=>{let{projectId:s,domain:a,isPrimaryDomain:i,showActions:r,hideRemove:l,onCompleteDnsSetup:o,utf8Domain:c,project:d}=e,[u,m]=(0,n.useState)(!1),[p,x]=(0,n.useState)(!1),[g,f]=(0,n.useState)(!1),{mutateAsync:y,isPending:b}=S({projectId:s}),{mutateAsync:N,isPending:w}=(e=>{let{projectId:s}=e;return(0,C.n)({mutationFn:async e=>{let{domainId:a}=e,t=(0,v.P)();await t.post("/projects/".concat(s,"/v2/domains/").concat(a,"/retry"))},onSuccess:()=>{j.toast.success("Retry started",{description:"Attempting to provision your domain again."})},onError:_.Ni})})({projectId:s}),{mutateAsync:k,isPending:P}=(e=>{let{projectId:s}=e,a=(0,ed.jE)();return(0,C.n)({mutationFn:async e=>{let{domainId:a,isPrimary:t}=e,i=(0,v.P)();t?await i.delete("/projects/".concat(s,"/v2/domains/primary")):await i.post("/projects/".concat(s,"/v2/domains/primary"),{domain_id:a})},onError:_.Ni,onSettled:()=>{a.invalidateQueries({queryKey:["project",s]})}})})({projectId:s}),I="initiated"===a.status,A="provisioning_failed"===a.status,D="active"===a.status,z="unpublished"===a.status,T=e=>{h.Ay.capture(e,{project_id:s,domain_id:a.id,domain:a.domain,version:2})},O=async()=>{T(E.$6.CUSTOM_DOMAIN.RETRY_CLICKED),await N({domainId:a.id})},M=async()=>{T(i?E.$6.CUSTOM_DOMAIN.UNSET_PRIMARY_CLICKED:E.$6.CUSTOM_DOMAIN.SET_PRIMARY_CLICKED),await k({domainId:a.id,isPrimary:!!i}),f(!1)},R=async()=>{await y({domainId:a.id}),T(E.$6.CUSTOM_DOMAIN.DELETE_CLICKED),m(!1)};return(0,t.jsxs)("div",{className:"flex flex-col-reverse items-end gap-1 @md:flex-row @md:items-center",children:[r&&(0,t.jsxs)(t.Fragment,{children:[I&&(0,t.jsx)(L.$,{variant:"outline",className:"bg-background",size:"sm",onClick:()=>{T(E.$6.CUSTOM_DOMAIN.COMPLETE_SETUP_CLICKED),null==o||o(a)},children:"Complete setup"}),A&&(0,t.jsx)(L.$,{variant:"outline",className:"bg-background",size:"sm",onClick:O,loading:w,children:"Retry"}),i&&(0,t.jsx)(eu.q,{className:"flex h-7 w-7 items-center justify-center"}),(D||!l||z)&&(0,t.jsxs)(eo.rI,{open:g,onOpenChange:f,children:[(0,t.jsx)(eo.ty,{asChild:!0,children:(0,t.jsx)(L.$,{variant:"ghost",size:"icon-sm",children:(0,t.jsx)(F.A,{name:"ellipsis_horizontal",size:"small"})})}),(0,t.jsxs)(eo.SQ,{align:"end",children:[z&&(0,t.jsxs)(eo._2,{onClick:()=>x(!0),children:[(0,t.jsx)(F.A,{name:"web",size:"small"}),"Publish project"]}),D&&(0,t.jsx)(eo._2,{onClick:M,onSelect:e=>e.preventDefault(),disabled:P,children:(0,t.jsxs)(t.Fragment,{children:[(!i||P)&&(0,t.jsx)(F.A,{name:P?"progress_activity":"star",size:"small",className:P?"animate-spin":""}),P?"".concat(i?"Unsetting":"Setting"," as primary..."):"".concat(i?"Unset":"Set"," as primary")]})}),!l&&(0,t.jsxs)(eo._2,{className:"text-destructive-primary",onClick:()=>{m(!0)},disabled:b,children:[(0,t.jsx)(F.A,{name:"trash",size:"small"}),"Remove"]})]})]})]}),(0,t.jsx)(ec,{open:u,onOpenChange:m,utf8Domain:c,onConfirm:R,isDeleting:b}),(0,t.jsx)(Q,{open:p,project:d,closeModal:()=>x(!1),title:"Publish your project",description:"Publishing your project will make it accessible on this domain."})]})};var ep=a(67844);let ex={unpublished:{label:"Unpublished",description:"Publish your project to activate this domain",variant:"warning"},ready:{label:"Ready",description:"Domain will be active once the project is published",variant:"success"},initiated:{label:"Action required",description:"Complete setup",variant:"warning",alert:{message:"Complete the domain setup to activate your custom domain.",messageLevel:"warning_outline"}},awaiting_dns:{label:"Verifying",description:"Verifying DNS records",variant:"warning",alert:{message:"DNS settings can take up to 72 hours to propagate.",messageLevel:"bordered"}},active_provisioning:{label:"Setting up",description:"Setting up your domain",variant:"warning",alert:{message:"DNS settings can take up to 72 hours to propagate.",messageLevel:"bordered"}},active:{label:"Live",description:"Domain is live",variant:"success"},drifted:{label:"Offline",description:"DNS records missing",variant:"warning",alert:{message:"Your domain is no longer pointing to your project. Update your DNS settings at your domain provider to reconnect it.",messageLevel:"warning_outline"}},provisioning_failed:{label:"Failed",description:"Setup failed",variant:"warning",alert:{message:"Domain setup failed. Please try again, or contact support if the issue persists.",messageLevel:"warning_outline"}},tombstoned:{label:"Removed",description:"Domain removed",variant:"warning",alert:{message:"This domain is no longer available for this project. To use it, remove it from the list and add it again.",messageLevel:"warning_outline"}}},eh=e=>{let{status:s,className:a}=e,i=ex[s]||ex.awaiting_dns;return(0,t.jsxs)(ei.m_,{children:[(0,t.jsx)(ei.k$,{asChild:!0,children:(0,t.jsx)(ep.E,{variant:i.variant,className:a,children:i.label})}),(0,t.jsx)(ei.ZI,{children:i.description})]})},ej=e=>{let{domain:s,showActions:a,hideRemove:i,onCompleteDnsSetup:n,isPrimaryDomain:r,project:l}=e,o=(e=>{try{return(0,ea.Pk)(e)}catch(s){return y.logging.error("Failed to get UTF-8 domain",{domain:e,error:s}),e}})(s.domain),c=((e,s)=>{if(!("txtToken"in e)||!e.txtToken)return[];let a=N(s,{domain:e.domain,id:e.id,txtToken:e.txtToken}),t=(0,b.qg)(e.domain);if("subdomain"in t&&t.subdomain){let{subdomain:e}=t;return a.subDomain.map(s=>({...s,host:s.host.replace("{SUBDOMAIN}",e)}))}return a.domain})(s,"production"),d=("awaiting_dns"===s.status||"drifted"===s.status)&&s.txtToken&&c.length>0,u=!!l.url,m="active"!==s.status||u?s.status:"ready",p=ex[m].alert,h="active"===s.status&&u;return(0,t.jsxs)("div",{className:"w-full @container","aria-label":"Domain ".concat(o),children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsx)("div",{className:"min-w-0 flex-1 overflow-hidden",children:(0,t.jsxs)("div",{className:"flex flex-col items-start gap-1 @md:flex-row @md:items-center @md:gap-2",children:[(0,t.jsxs)("div",{className:"flex min-h-7 min-w-0 max-w-full items-center gap-2",children:[(0,t.jsx)(F.A,{name:"web",size:"small",className:"flex-shrink-0 text-muted-foreground"}),(0,t.jsx)("span",{className:"min-w-0 truncate text-sm",children:o}),h&&(0,t.jsxs)(ei.m_,{children:[(0,t.jsx)(ei.k$,{asChild:!0,children:(0,t.jsx)(L.$,{variant:"ghost",size:"icon-sm",asChild:!0,className:"flex-shrink-0",children:(0,t.jsx)(x(),{href:"https://".concat(s.domain),target:"_blank",rel:"noopener noreferrer",children:(0,t.jsx)(F.A,{name:"arrow_up_right",size:"small"})})})}),(0,t.jsxs)(ei.ZI,{children:["Visit ",o]})]})]}),(0,t.jsx)(eh,{status:m,className:"w-fit flex-shrink-0 rounded-full px-3"})]})}),(0,t.jsx)(em,{projectId:l.id,domain:s,isPrimaryDomain:r,showActions:a,hideRemove:i,onCompleteDnsSetup:n,utf8Domain:o,project:l})]}),(p||d)&&(0,t.jsxs)("div",{className:"flex flex-col gap-2 pb-4 pt-2",children:[p&&(0,t.jsxs)(et.Fc,{variant:p.messageLevel,children:[(0,t.jsx)(F.A,{name:"warning_outline"===p.messageLevel?"error":"info_circle",size:"small"}),(0,t.jsx)(et.TN,{children:p.message})]}),d&&(0,t.jsx)(el,{dnsRecords:c,showDriftedMessage:"drifted"===s.status})]})]})};var eg=a(72632),ef=a(20795),ev=a(74507),ey=a(99473),eb=a(30849);let eN=e=>{let{scenario:s,className:a="cursor-pointer text-sm text-muted-foreground underline transition-opacity duration-150 ease-in-out hover:opacity-75",children:i="Upgrade your plan"}=e,n=(0,X.BK)();return(0,t.jsx)("span",{onClick:()=>{n(s)},className:a,children:i})};var ew=a(43987);let ek=e=>{let{projectWorkspace:s,canEdit:a}=e;return s&&a?(0,t.jsx)(ew.M,{workspace:s,requiredPlanCategory:"pro"}):null},eC=e=>{let{title:s,description:a,buttonText:i,imageSrc:n,iconName:r,onClick:l,canPossiblyManageDomains:o,isPaidPlan:c,projectWorkspace:d}=e,u=o?c?a:(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(eN,{scenario:X.KU.PRO_DOMAIN_CONNECT})}):"You don't have permission to manage domains for this project.";return(0,t.jsxs)(es.Zp,{className:"flex flex-col gap-2 rounded-xl border-0 bg-muted p-4 sm:flex-row sm:items-center sm:gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-row items-start gap-4 sm:flex-1 sm:items-center",children:[(0,t.jsxs)("div",{className:"relative h-[47px] w-[47px] flex-shrink-0 overflow-hidden rounded-xl",children:[(0,t.jsx)(eb.default,{src:n,alt:"",fill:!0,className:"object-cover",sizes:"47px"}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)(F.A,{name:r,className:"text-white"})})]}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h3",{className:"text-sm font-medium",children:s}),(0,t.jsx)(ek,{projectWorkspace:d,canEdit:o})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:u})]})]}),(0,t.jsx)(L.$,{variant:"outline",size:"sm",type:"button",onClick:l,disabled:!o,className:"self-end bg-background sm:w-auto sm:flex-shrink-0",children:i})]})},e_={type:"spring",stiffness:170,damping:24,mass:1.2},eS=e=>{let{project:s}=e,{permitted:a}=(0,o.J)(ev.eZ.EditProject),{permitted:i}=(0,o.J)(ev.eZ.ManageProjectDomains),{domains:r}=(0,J.m)(s.id,s.primary_custom_domain_id),c=(0,l.j4)(e=>e.currentWorkspace),[d,p]=(0,n.useState)(null),g=(0,X.BK)(),f=e=>a?"free"===(null==c?void 0:c.plan)?void g(X.KU.PRO_DOMAIN_CONNECT):void(h.Ay.capture(E.$6.CUSTOM_DOMAIN.CLICKED,{mode:e,project_id:s.id,version:2}),p({mode:e})):void j.toast.error("You don't have permission to manage domains for this project."),v=e=>{p({mode:e.mode,existingDomain:e})},y=(0,n.useCallback)(()=>{p(null)},[]),{isPaidPlan:b}=(0,eg.cb)(null==c?void 0:c.plan),N=i||!b,w=(0,ey.Kr)();return(0,t.jsxs)(ee.Pt,{value:"domains",title:"Domains",description:a?"Publish your project to custom domains.":"View domains connected to this project.",descriptionAction:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ee.cY,{href:"https://docs.lovable.dev/features/custom-domain#custom-domain",className:"min-h-7 sm:hidden"}),(0,t.jsx)(L.$,{variant:"outline",size:"sm",type:"button",asChild:!0,className:"hidden sm:flex",children:(0,t.jsxs)(x(),{href:"https://docs.lovable.dev/features/custom-domain#custom-domain",target:"_blank",children:["How Domains Work ",(0,t.jsx)(F.A,{name:"arrow_up_right",size:"small"})]})})]}),children:[(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)(es.Zp,{className:"flex flex-col gap-3 overflow-hidden rounded-xl border-0 bg-muted p-4",children:[(0,t.jsx)("div",{className:"text-base font-medium",children:"Overview"}),(0,t.jsxs)(u.N,{initial:!1,mode:"popLayout",children:[(0,t.jsx)(m.P.div,{layout:"position",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:e_,children:(0,t.jsx)(ej,{showActions:N,hideRemove:!0,project:s,domain:{id:"default",domain:s.primary_custom_domain_id&&"default"!==s.primary_custom_domain_id&&s.url?(0,ef.b)(s.url):s.name?"".concat(s.name).concat(w):"No URL subdomain",status:s.url?"active":"unpublished"},isPrimaryDomain:"default"===s.primary_custom_domain_id})},"default"),null==r?void 0:r.map(e=>(0,t.jsx)(m.P.div,{layout:"position",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:e_,children:(0,t.jsx)(ej,{project:s,domain:e,showActions:N,onCompleteDnsSetup:v,isPrimaryDomain:e.id===s.primary_custom_domain_id})},e.id))]})]}),(0,t.jsx)("div",{className:"@container",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 @5xl:grid-cols-2",children:[(0,t.jsx)(eC,{title:"Add Existing Domain",description:"Connect a domain you already own.",buttonText:"Connect domain",imageSrc:"/img/domain-connect.png",iconName:"link",onClick:()=>f("connect"),canPossiblyManageDomains:N,isPaidPlan:b,projectWorkspace:c}),(0,t.jsx)(eC,{title:"Purchase New Domain",description:"Buy a new domain through Ionos.",buttonText:"Buy new domain",imageSrc:"/img/domain-buy.png",iconName:"explore",onClick:()=>f("buy"),canPossiblyManageDomains:N,isPaidPlan:b,projectWorkspace:c})]})})]}),d&&(0,t.jsx)(H,{project:s,mode:d.mode,existingDomain:d.existingDomain,close:y})]})};var eE=a(73893),eP=a(32313),eI=a(56024),eA=a(82149);let eL=()=>{let[e,s]=(0,n.useState)(""),a=(0,eA.Iw)(e=>e.project);(0,n.useEffect)(()=>{(null==a?void 0:a.custom_instructions)&&s(a.custom_instructions)},[a]);let{updateProject:i}=(0,eA.Om)(),r=async()=>{try{i({custom_instructions:e},{onSuccess:()=>{h.Ay.capture(E.$6.KNOWLEDGE.SAVED),j.toast.success("Custom instructions updated",{description:"Your custom instructions have been saved successfully."})}}),o(!1)}catch(e){j.toast.error("Error",{description:"Failed to update custom instructions. Please try again."})}},[l,o]=(0,n.useState)(!1),c=e.length,d=c>1e5;return(0,t.jsx)(ee.Pt,{value:"knowledge",title:"Knowledge",description:"Add custom knowledge to your project.",docsLink:"https://docs.lovable.dev/features/knowledge",children:(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"mb-2 flex flex-col gap-2",children:[(0,t.jsx)("p",{className:"text-base font-medium",children:"Instructions & Guidelines"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Provide guidelines and context to improve your projectâ€™s edits. Use this space to:"}),(0,t.jsxs)("ul",{className:"list-disc pl-6 text-sm text-muted-foreground",children:[(0,t.jsx)("li",{children:"Set project-specific rules or best practices."}),(0,t.jsx)("li",{children:"Set coding style preferences (e.g. indentation, naming conventions)."}),(0,t.jsx)("li",{children:"Include external documentation or style guides."})]})]}),(0,t.jsx)(eP.T,{value:e,onChange:e=>{s(e.target.value),e.target.value!==(null==a?void 0:a.custom_instructions)?o(!0):o(!1)},placeholder:"Enter your instructions here...",className:"resize-none border border-border bg-inherit p-4",rows:14}),(0,t.jsx)("div",{className:(0,eI.cn)("flex justify-end",l&&"mb-12"),children:(0,t.jsx)(L.$,{variant:"outline",size:"sm",type:"button",asChild:!0,children:(0,t.jsxs)(x(),{href:"https://docs.lovable.dev/features/knowledge",target:"_blank",children:["Get Inspiration ",(0,t.jsx)(F.A,{name:"arrow_up_right",size:"small"})]})})}),l&&(0,t.jsxs)(eE.E,{className:"justify-end gap-3",children:[d&&(0,t.jsxs)("div",{className:"mr-auto text-sm text-destructive-foreground",children:["Message is too long. Exceeded by ",c-1e5," characters."]}),(0,t.jsx)(L.$,{variant:"outline",onClick:()=>{s((null==a?void 0:a.custom_instructions)||""),o(!1)},children:"Cancel"}),(0,t.jsx)(L.$,{onClick:r,variant:"affirmative",disabled:d,children:"Save"})]})]})})};var eD=a(67539),ez=a(47226),eF=a(40911);let eT=()=>{let[e,s]=(0,n.useState)([]),[a,i]=(0,n.useState)(!1),[r,o]=(0,n.useState)(!1),c=(0,eA.Iw)(e=>e.project),d=(0,ed.jE)(),u=(0,l.j4)(e=>e.currentWorkspace),{data:m,isLoading:p}=(0,eF.I)({queryKey:["projects",null==c?void 0:c.id,"library-connections"],queryFn:async()=>{if(!(null==c?void 0:c.id))return[];let e=(0,v.P)();return(await e.get("/projects/".concat(c.id,"/library-connections"))).libraries||[]},enabled:!!(null==c?void 0:c.id),permission:ev.eZ.EditProject}),{data:x,isLoading:g}=(0,eF.I)({queryKey:["available-library-projects",null==u?void 0:u.id],queryFn:async()=>{if(!(null==u?void 0:u.id))return[];let e=(0,v.P)();return(await e.get("/workspaces/".concat(u.id,"/available-library-projects"))).libraries||[]},enabled:!!(null==u?void 0:u.id),permission:ev.eZ.ViewWorkspace});(0,n.useEffect)(()=>{m&&!a&&(s(m),o(!1))},[m,a]);let f=async()=>{try{if(!(null==c?void 0:c.id))return;let s=(0,v.P)();await s.patch("/projects/".concat(c.id,"/library-connections"),{libraries:e.map(e=>{let{project_id:s,name:a}=e;return{project_id:s,name:null!=a?a:null}})}),await d.invalidateQueries({queryKey:["projects",c.id,"library-connections"]}),h.Ay.capture(E.$6.KNOWLEDGE.SAVED),j.toast.success("Libraries updated",{description:"Your library connections have been saved successfully."}),o(!1),i(!1)}catch(e){j.toast.error("Error",{description:"Failed to save libraries. Please try again."})}};return(0,t.jsx)(ee.Pt,{value:"libraries",title:"Libraries",description:"Connect library projects to provide additional knowledge and design guidelines.",docsLink:"https://docs.lovable.dev/features/libraries",children:(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"mb-2 flex flex-col gap-2",children:[(0,t.jsx)("p",{className:"text-base font-medium",children:"Library Connections"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Connect library projects to share design systems, components, and knowledge across projects."}),(0,t.jsxs)("ul",{className:"list-disc pl-6 text-sm text-muted-foreground",children:[(0,t.jsx)("li",{children:"The first library's design guidelines will be used as the system prompt."}),(0,t.jsx)("li",{children:"Knowledge files from all libraries will be available to the AI agent."}),(0,t.jsx)("li",{children:"Files are deduplicated by filename (first library wins)."})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[p&&void 0===m?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"rounded-lg border border-border p-4",children:[(0,t.jsx)(ez.E,{className:"h-4 w-32"}),(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,t.jsx)(ez.E,{className:"h-9 w-full"}),(0,t.jsx)(ez.E,{className:"h-4 w-40"})]})]}),(0,t.jsxs)("div",{className:"rounded-lg border border-border p-4",children:[(0,t.jsx)(ez.E,{className:"h-4 w-32"}),(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,t.jsx)(ez.E,{className:"h-9 w-full"}),(0,t.jsx)(ez.E,{className:"h-4 w-40"})]})]})]}):e.length>0?(0,t.jsx)("div",{className:"space-y-3",children:e.map((a,i)=>(0,t.jsxs)("div",{className:"flex items-start gap-3 rounded-lg border border-border p-4",children:[(0,t.jsx)("div",{className:"flex-1 space-y-3",children:(0,t.jsxs)("div",{children:[(0,t.jsx)(V.Label,{htmlFor:"library-select-".concat(i),children:"Library Project"}),g&&!x?(0,t.jsxs)("div",{className:"mt-1 space-y-2",children:[(0,t.jsx)(ez.E,{className:"h-9 w-full"}),(0,t.jsx)(ez.E,{className:"h-4 w-40"})]}):x&&x.length>0?(0,t.jsxs)(eD.l6,{value:a.project_id,onValueChange:a=>((a,t)=>{let i=null==x?void 0:x.find(e=>e.id===t);i&&(s(e.map((e,s)=>s===a?{project_id:t,name:i.name||"Untitled Library"}:e)),o(!0))})(i,a),children:[(0,t.jsx)(eD.bq,{id:"library-select-".concat(i),children:(0,t.jsx)(eD.yv,{placeholder:"Select a library project"})}),(0,t.jsx)(eD.gC,{children:x.map(e=>(0,t.jsx)(eD.eb,{value:e.id,children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{children:e.name||"Untitled Library"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Updated ".concat(new Date(e.updated_at).toLocaleDateString())})]})},e.id))})]}):(0,t.jsxs)("div",{className:"mt-1",children:[(0,t.jsx)(T.p,{id:"project-id-".concat(i),value:a.project_id,onChange:a=>{var t;return t=a.target.value,void(s(e.map((e,s)=>s===i?{...e,project_id:t}:e)),o(!0))},placeholder:"Enter project ID"}),(0,t.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:"No library projects available. Mark a project as a library in its settings."})]})]})}),(0,t.jsx)(L.$,{variant:"ghost",size:"icon",onClick:()=>{s(e.filter((e,s)=>s!==i)),o(!0)},className:"mt-2",children:(0,t.jsx)(F.A,{name:"trash",size:"small"})})]},a.project_id))}):null,(0,t.jsxs)(L.$,{variant:"outline",onClick:()=>{s([...e,{project_id:"",name:""}]),i(!0),o(!0)},className:"w-full",children:[(0,t.jsx)(F.A,{name:"plus",size:"small"}),"Add Library Connection"]})]}),0===e.length&&!p&&(0,t.jsx)("div",{className:"py-8 text-center text-sm text-muted-foreground",children:"No library connections yet. Add one to get started."}),r&&(0,t.jsxs)(eE.E,{className:"justify-end gap-3",children:[(0,t.jsx)(L.$,{variant:"outline",onClick:()=>{m&&s(m),o(!1),i(!1)},children:"Cancel"}),(0,t.jsx)(L.$,{onClick:f,variant:"affirmative",children:"Save"})]})]})})};var eO=a(8974);let eM=e=>{let{project:s,onCategoryChange:a,disabled:i=!1}=e;return(0,t.jsx)(eE.m,{label:"Project Category",description:"Categorize your project to help others find it.",mobileLayout:"horizontal",justify:"end",children:(0,t.jsxs)(eD.l6,{defaultValue:(null==s?void 0:s.category)||"",onValueChange:e=>{a(e)},disabled:i,children:[(0,t.jsx)(eD.bq,{className:"w-[180px]",children:(0,t.jsx)(eD.yv,{placeholder:"Select category"})}),(0,t.jsxs)(eD.gC,{children:[(0,t.jsx)(eD.eb,{value:"internal_tools",children:"Internal Tools"}),(0,t.jsx)(eD.eb,{value:"website",children:"Website"}),(0,t.jsx)(eD.eb,{value:"personal",children:"Personal"}),(0,t.jsx)(eD.eb,{value:"consumer_app",children:"Consumer App"}),(0,t.jsx)(eD.eb,{value:"b2b_app",children:"B2B App"}),(0,t.jsx)(eD.eb,{value:"prototype",children:"Prototype"})]})]})})};var eR=a(169),eU=a(54504);let e$={Title:e=>{let{title:s,description:a,className:i,...n}=e;return(0,t.jsxs)("div",{className:(0,eI.cn)("flex flex-col",i),...n,children:[(0,t.jsx)("h2",{children:s}),a&&(0,t.jsx)("p",{className:"text-muted-foreground",children:a})]})},Entry:e=>{let{label:s,value:a,onEdit:i}=e;return(0,t.jsxs)("div",{className:"flex flex-col text-sm",children:[(0,t.jsx)("p",{className:"font-medium text-muted-foreground",children:s}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:["string"==typeof a?(0,t.jsx)("p",{className:"text-base",children:a}):a,i&&(0,t.jsx)(L.$,{variant:"ghost",size:"icon-md",onClick:i,className:"h-5 w-5 flex-shrink-0 p-0 text-muted-foreground hover:text-foreground","aria-label":"Edit ".concat(s.toLowerCase()),children:(0,t.jsx)(F.A,{name:"pen",size:"small"})})]})]})},Separator:eU.w};var eq=a(20834),eB=a(26800),eW=a(69850);let eG=A.Ik({domain:A.Yj().min(1,"URL domain is required").max(45,"URL domain must be less than 45 characters").regex(/^[a-z0-9-]+$/,{message:"URL domain can only contain lowercase letters, numbers, and hyphens."}).regex(/^(?!.*--).+$/,{message:"URL domain cannot contain consecutive hyphens."}).regex(/^[a-z]/,{message:"URL domain must start with a lowercase letter."}).regex(/[a-z0-9]$/,{message:"URL domain cannot end with a hyphen."})}),eK=e=>{let{project:s,isOpen:a,onClose:i}=e,n=(0,ed.jE)(),r=(0,l.j4)(e=>{var s;return null==(s=e.currentWorkspace)?void 0:s.id}),o=(0,I.mN)({resolver:(0,P.u)(eG),defaultValues:{domain:s.name||""}}),c=(0,C.n)({mutationFn:async e=>{let{domain:a}=e;return(0,v.P)().put("/projects/".concat(s.id),{name:a})},onSuccess:(e,s)=>{n.invalidateQueries({queryKey:eW.gO.all}),n.invalidateQueries({queryKey:eW.workspaceKeys.detail(r||"")}),j.toast.success("URL subdomain updated successfully"),i(),o.reset({domain:s.domain})},onError:e=>{(0,_.Ni)(e)}}),d=async e=>{await c.mutateAsync({domain:e.domain})},u=!!o.formState.dirtyFields.domain,m=(0,ey.Kr)();return(0,t.jsx)(D.lG,{open:a,onOpenChange:i,children:(0,t.jsxs)(D.Cf,{size:"sm",children:[(0,t.jsxs)(D.c7,{children:[(0,t.jsx)(D.L3,{children:"Edit URL subdomain"}),(0,t.jsx)(D.rr,{children:"Change the URL subdomain for your published project."})]}),(0,t.jsx)(z.lV,{...o,children:(0,t.jsxs)("form",{onSubmit:o.handleSubmit(d),className:"flex w-full flex-col gap-4",children:[(0,t.jsxs)("div",{className:"w-full space-y-4",children:[(0,t.jsx)(z.zB,{control:o.control,name:"domain",render:e=>{let{field:s}=e;return(0,t.jsxs)(z.eI,{children:[(0,t.jsx)(z.lR,{children:"URL subdomain"}),(0,t.jsx)(z.MJ,{children:(0,t.jsx)(T.p,{placeholder:"my-awesome-project",...s})}),!o.formState.errors.domain&&(0,t.jsx)(z.Rr,{children:"Use lowercase letters, numbers, and hyphens only. This will be used in your project URL."}),(0,t.jsx)(z.C5,{})]})}}),(0,t.jsxs)("div",{className:"space-y-2 rounded-md bg-muted p-3 text-xs text-muted-foreground",children:[(0,t.jsx)("p",{className:"font-medium",children:"Your project will be accessible at:"}),(0,t.jsxs)("code",{className:"block break-all text-foreground",children:["https://",o.watch("domain")||"your-project",m]})]}),s.display_name&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:[(0,t.jsx)("span",{className:"font-medium",children:"Display name:"})," ",s.display_name]})]}),(0,t.jsxs)(D.Es,{children:[(0,t.jsx)(L.$,{variant:"outline",onClick:i,type:"button",children:"Cancel"}),(0,t.jsx)(L.$,{type:"submit",disabled:!u||c.isPending,loading:c.isPending,children:c.isPending?"Updating...":"Update URL subdomain"})]})]})})]})})};var eV=a(57993),eY=a(19695),eZ=a(81635),eQ=a(702),eH=a(15365),eJ=a(214),eX=a(7204),e0=a(37474),e1=a(42971),e2=a(91218),e4=a(93160),e5=a(34056);let e3=e=>{var s;let{isPaidUser:a,className:i,always_hide_badge:r}=e,{setBadgeVisibility:l}=(0,eA.Om)(),o=(0,eA.Iw)(e=>e.project),c=(0,X.BK)(),d=null!=r&&r,u=d||null!=(s=null==o?void 0:o.hide_badge)&&s,[m,p]=(0,n.useState)(u);return(0,t.jsx)(eZ.d,{checked:m,onCheckedChange:e=>{if(!d){if(!a)return void c(X.KU.PRO_HIDE_BADGE);l(e),p(e)}},disabled:d,className:(0,eI.cn)("",i)})},e6=e=>{let{projectId:s,initialFeatured:a,className:i}=e,[r,l]=(0,n.useState)(a),o=(0,C.n)({mutationFn:e=>{let{featured:a}=e;return(0,v.P)().put("/projects/".concat(s,"/featured"),{featured:a})},onSuccess:(e,s)=>{let{featured:a}=s;l(a),j.toast.success("Featured status updated",{description:"Project is now ".concat(a?"featured":"not featured",".")})},onError:e=>{(0,_.Ni)(e)}});return(0,t.jsx)(eZ.d,{disabled:o.isPending,checked:r,onCheckedChange:e=>{o.mutate({featured:e})},className:(0,eI.cn)("",i)})},e9=e=>{var s,a,i,r,c,d;let{project:u}=e,{permitted:m}=(0,o.J)(ev.eZ.EditProject),{permitted:p}=(0,o.J)(ev.eZ.DeleteProject),{permitted:x}=(0,o.J)(ev.eZ.DeployPrivateProject),{permitted:h}=(0,o.J)(ev.eZ.DeployPublicProject),g=(null==u?void 0:u.publish_visibility)==="private"?x:h,[f,v]=(0,n.useState)(!1),[b,N]=(0,n.useState)(!1),[w,k]=(0,n.useState)(!1),C=(0,eJ.B1)(),_=(0,e0.R)(),S=(0,l.j4)(e=>e.currentWorkspace),E=(null==S?void 0:S.plan)||null,P=u.id,I=(0,eH.WW)(),{isProjectRemixAllowed:A,projectRemixNotAllowedReason:D}=(0,eR.O)({projectId:null!=(c=null==u?void 0:u.id)?c:"",enabled:!!u}),{updateProject:z}=(0,eA.Om)(),F=(0,e5.D)(),T=(0,ed.jE)(),{isBizOrEnterprisePlan:O}=(0,eg.cb)(E),M=(0,X.BK)(),{showUnpublishDialog:R,closeDialog:U}=(0,e1.S)(),{handleUnpublish:$,unpublishMutation:q}=(0,e2.N)({projectId:null==u?void 0:u.id,onUnpublishComplete:()=>{U()}}),B=async e=>O?(null==u?void 0:u.visibility)==="draft"&&e?void j.toast.error("Personal projects cannot be used as templates",{description:"Change the project visibility to Public or Workspace to use it as a template."}):void z({is_template:e},{onSuccess:()=>{T.invalidateQueries({queryKey:eW.workspaceKeys.templates((null==S?void 0:S.id)||"")})}}):void M(X.KU.BIZ_TEMPLATES),W=(null==u?void 0:u.is_analytics_disabled)||!1,G=(null==S?void 0:S.always_hide_badge)===!0,K=async e=>{z({is_analytics_disabled:e},{onSuccess:()=>{(0,eX.o)({projectId:P}).catch(e=>{y.logging.error("Error updating deployment ID",e)})}})},{isPaidPlan:V}=(0,eg.cb)(E);return(0,t.jsx)(ee.Pt,{value:"project",title:"Project Settings",description:"Manage your project details, visibility, and preferences.",children:(0,t.jsxs)("div",{className:"flex w-full flex-col gap-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-5",children:[(0,t.jsx)("p",{className:"col-span-full font-medium",children:"Overview"}),(0,t.jsx)(e$.Entry,{label:"Display name",value:(null==u?void 0:u.display_name)||(null==u?void 0:u.name),onEdit:m?()=>v(!0):void 0}),(0,t.jsx)(e$.Entry,{label:"URL subdomain",value:(null==u?void 0:u.name)||"No URL subdomain",onEdit:(null==u?void 0:u.name)&&m?()=>N(!0):void 0}),(0,t.jsx)(e$.Entry,{label:"Owner",value:(null==u?void 0:u.created_by)&&(0,t.jsx)(eQ.f,{username:u.created_by,className:"break-words text-base text-foreground underline"})}),(0,t.jsx)(e$.Entry,{label:"Created at",value:(e=>(null==e?void 0:e.seconds)?(0,eO.GP)(new Date(1e3*e.seconds),"yyyy-MM-dd HH:mm:ss"):void 0)(null==u?void 0:u.created_at)}),(null==u||null==(s=u.creation_options)?void 0:s.tech_stack)&&(0,t.jsx)(e$.Entry,{label:"Tech stack",value:null==u||null==(a=u.creation_options)?void 0:a.tech_stack}),(0,t.jsx)(e$.Entry,{label:"Messages count",value:(null==u||null==(i=u.user_message_count)?void 0:i.toString())||"0"}),(0,t.jsx)(e$.Entry,{label:"AI Edits count",value:(null==u||null==(r=u.edit_count)?void 0:r.toString())||"0"})]}),(0,t.jsx)(e$.Separator,{}),(0,t.jsx)(eE.m,{label:"Project Visibility",description:"Keep your project hidden and prevent others from remixing it.",mobileLayout:"vertical",justify:"end",children:(0,t.jsx)(e4.B,{})}),u&&(0,t.jsx)(eM,{project:u,onCategoryChange:e=>z({category:e}),disabled:!m}),(0,t.jsx)(eE.m,{label:'Hide "Lovable" Badge',description:G?'Your workspace enforces hiding the "Edit with Lovable" badge on all projects.':V?'Remove the "Edit with Lovable" badge from your published work.':(0,t.jsxs)("p",{children:[(0,t.jsx)(eN,{scenario:X.KU.PRO_HIDE_BADGE}),' to remove the "Edit with Lovable" badge from your published work.']}),mobileLayout:"horizontal",justify:"end",customBadge:S&&(0,t.jsx)(ew.M,{workspace:S,requiredPlanCategory:"pro"}),className:G?"opacity-50":"",children:(0,t.jsx)(e3,{isPaidUser:V,always_hide_badge:null!=(d=null==S?void 0:S.always_hide_badge)&&d})}),u&&I&&(0,t.jsx)(eE.m,{label:"Feature Project",description:"Highlight this project on the homepage.",mobileLayout:"horizontal",justify:"end",children:(0,t.jsx)(e6,{projectId:P,initialFeatured:!!u.featured})}),O&&(0,t.jsx)(eE.m,{label:"Use as a Template",description:(0,t.jsxs)("p",{children:["Use this project as a template in"," ",(0,t.jsx)("span",{className:"font-medium",children:(null==S?void 0:S.name)?S.name:"your workspace"})," ","to reference when starting new projects."]}),mobileLayout:"horizontal",justify:"end",customBadge:S&&(0,t.jsx)(ew.M,{workspace:S,requiredPlanCategory:"biz"}),children:(0,t.jsx)(eY.Q,{showTooltip:(null==u?void 0:u.visibility)==="draft",tooltipContent:"Change project visibility to Public or Workspace to use it as a template.",delayDuration:0,children:(0,t.jsx)(eZ.d,{checked:(null==u?void 0:u.is_template)||!1,onCheckedChange:B,disabled:(null==u?void 0:u.visibility)==="draft"})})}),C&&(0,t.jsx)(eE.m,{label:"Use as Library",description:"Allow this project to be used as a library by other projects in your workspace. Library projects provide design guidelines and knowledge files.",mobileLayout:"horizontal",justify:"end",children:(0,t.jsx)(eY.Q,{showTooltip:!m,tooltipContent:"You don't have permission to change library settings.",children:(0,t.jsx)(eZ.d,{checked:(null==u?void 0:u.is_library)||!1,onCheckedChange:e=>z({is_library:e}),disabled:!m})})}),u&&m&&(0,t.jsx)(eE.m,{label:"Rename Project",description:"Update your project's title.",mobileLayout:"horizontal",justify:"end",children:(0,t.jsx)(L.$,{onClick:()=>v(!0),children:"Rename"})}),u&&(0,t.jsx)(eE.m,{label:"Remix Project",description:"Duplicate this app in a new project.",mobileLayout:"horizontal",justify:"end",children:(0,t.jsx)(eY.Q,{showTooltip:!A,tooltipContent:D,children:(0,t.jsx)(L.$,{onClick:()=>F(u),disabled:!A,children:"Remix"})})}),(0,t.jsx)(eE.m,{label:"Transfer",description:"Move this project to a different workspace.",mobileLayout:"horizontal",justify:"end",children:(0,t.jsx)(eq.O,{projectId:P,projectName:(null==u?void 0:u.display_name)||(null==u?void 0:u.name),currentWorkspaceId:null==u?void 0:u.workspace_id})}),u&&(0,t.jsx)(eE.m,{label:"Disable Analytics",description:"Disable collecting analytics data for this project.",mobileLayout:"horizontal",justify:"end",children:(0,t.jsx)(eY.Q,{showTooltip:!m,tooltipContent:"You don't have permission to disable analytics.",children:(0,t.jsx)(eZ.d,{checked:W,onCheckedChange:K,disabled:!m})})}),u&&(0,t.jsx)(eE.m,{label:"Unpublish Project",description:"Remove public access to this project.",mobileLayout:"horizontal",justify:"end",children:(0,t.jsx)(eY.Q,{showTooltip:!g,tooltipContent:"You don't have permission to unpublish this project.",children:(0,t.jsx)(L.$,{onClick:()=>R({onConfirm:$}),disabled:q.isPending||!(null==u?void 0:u.is_published)||!g,children:"Unpublish"})})}),u&&(0,t.jsx)(eE.m,{label:"Delete Project",description:"Permanently delete this project.",mobileLayout:"horizontal",justify:"end",children:(0,t.jsx)(eY.Q,{showTooltip:!p,tooltipContent:"You don't have permission to delete this project.",children:(0,t.jsx)(L.$,{variant:"destructive",onClick:()=>k(!0),disabled:!p,children:"Delete"})})}),u&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eV.U,{project:u,isOpen:f,onClose:()=>v(!1)}),(0,t.jsx)(eK,{project:u,isOpen:b,onClose:()=>N(!1)}),(0,t.jsx)(eB.B,{project:u,isOpen:w,onClose:()=>k(!1),hasActiveLock:_})]})]})})};var e7=a(94123),e8=a(36137),se=a(96373),ss=a(88604),sa=a(21016);let st=e=>{var s,a,t;let i=(null==(a=e.detail)||null==(s=a.originalEvent)?void 0:s.target)||e.target;i&&i.closest(".toaster")&&(e.preventDefault(),null==(t=e.stopPropagation)||t.call(e))},si=e=>{let{children:s,open:a,onOpenChange:i}=e;return(0,sa.A)("md")?(0,t.jsx)(ss._s,{open:a,onOpenChange:i,children:(0,t.jsx)(sr,{children:s})}):(0,t.jsx)(D.lG,{open:a,onOpenChange:i,children:(0,t.jsx)(sn,{children:s})})},sn=e=>{let{children:s,className:a,...i}=e;return(0,t.jsxs)(D.Cf,{hideCloseButton:!0,className:(0,eI.cn)("flex h-[90dvh] max-h-[800px] w-[95dvw] flex-1 flex-col items-start px-0 py-0",a),size:"2xl",onFocusOutside:st,onPointerDownOutside:st,onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},...i,"aria-describedby":"Settings dialog",children:[(0,t.jsxs)(se.s6,{children:[(0,t.jsx)(D.rr,{children:"Settings dialog"}),(0,t.jsx)(e8.L3,{children:"Settings dialog"})]}),(0,t.jsx)(e8.HM,{asChild:!0,children:(0,t.jsx)(L.$,{variant:"ghost",size:"icon-sm",className:"absolute right-2 top-2 z-10 hover:bg-transparent hover:opacity-75",children:(0,t.jsx)(F.A,{name:"x",size:"small"})})}),s]})},sr=e=>{let{children:s,className:a,...i}=e;return(0,t.jsxs)(ss.zj,{className:(0,eI.cn)("flex h-[90dvh] flex-col items-start px-0 py-0",a),onInteractOutside:st,...i,children:[(0,t.jsxs)(se.s6,{children:[(0,t.jsx)(ss.I6,{children:"Settings drawer"}),(0,t.jsx)(ss.gk,{children:"Settings drawer"})]}),s]})};var sl=a(53792),so=a(51573),sc=a(99989),sd=a(57841),su=a(72723),sm=a(49121),sp=a(40702),sx=a(24072),sh=a(6971);function sj(e){let{title:s,description:a,featureKey:i,checked:n}=e,{authUser:r}=(0,sp.Z2)(),{mutate:l}=function(e){let{featureKey:s,silent:a=!1,onSuccess:t,onError:i,retry:n}=e,{authUser:r}=(0,sp.Z2)(),l=(0,sx.sf)(),o=(0,ed.jE)(),c=["labs-feature",null==r?void 0:r.uid,s];return(0,C.n)({mutationKey:c,retry:n,mutationFn:async e=>{if(!(null==r?void 0:r.uid))throw Error("User not found");return(0,v.P)().patch("/users/".concat(null==r?void 0:r.uid,"/experimental-features"),{feature:s,enabled:e})},onMutate:e=>{o.cancelQueries({queryKey:sh.Y.experimentalFeatures({user:r}).queryKey});let a=o.getQueryData(sh.Y.experimentalFeatures({user:r}).queryKey);return o.setQueryData(sh.Y.experimentalFeatures({user:r}).queryKey,a=>a?{...a,[s]:e}:null),{previousFeatures:a}},onSuccess:(e,a)=>{l.capture("lab-feature-toggled",{feature:s,enabled:a}),null==t||t(a)},onError:(e,t,n)=>{o.setQueryData(sh.Y.experimentalFeatures({user:r}).queryKey,e=>{var a;return e?{...e,[s]:null==n||null==(a=n.previousFeatures)?void 0:a[s]}:null}),a||(0,_.Ni)(e),null==i||i(e)},onSettled:()=>{let e=sh.Y.experimentalFeatures({user:r}).queryKey;o.invalidateQueries({queryKey:e})}})}({featureKey:i,silent:!1});return(0,t.jsx)(eE.m,{label:s,description:a,mobileLayout:"horizontal",children:(0,t.jsx)(eZ.d,{checked:n,onCheckedChange:l,disabled:!r,className:"ml-auto"})})}let sg=()=>{let{isLoading:e,features:s}=(0,sm.l)();return(0,t.jsx)(ee.Pt,{value:"labs",title:"Labs",description:"These are experimental features, that might be modified or removed.",docsLink:"https://docs.lovable.dev/features/labs",children:e?(0,t.jsx)(ez.E,{className:"h-10 w-full"}):(0,t.jsx)(sj,{title:"GitHub branch switching",description:"Select the branch to make edits to in your GitHub repository.",featureKey:"git_branch_switching",checked:!!(null==s?void 0:s.git_branch_switching)})})};var sf=a(83548);let sv=e=>{let{userData:s,authUser:a}=e;return(0,t.jsx)(eE.m,{label:"Your avatar",description:"Your avatar is either fetched from your linked identity provider or automatically generated based on your account.",mobileLayout:"horizontal",children:(0,t.jsx)(sf.O,{className:"ml-auto h-10 w-10 md:ml-0",userData:s,authUser:a})})},sy=e=>{var s;let{authUser:a}=e;return(0,t.jsx)(eE.m,{label:"Email",description:"Your email address associated with your account.",children:(0,t.jsx)(T.p,{value:null!=(s=null==a?void 0:a.email)?s:"",disabled:!0,readOnly:!0,className:"w-full",placeholder:"No email available"})})};var sb=a(91604);let sN=A.Ik({display_name:A.Yj().optional(),bio:A.Yj().optional(),location:A.Yj().optional(),link:A.Yj().optional(),hide_profile_pictures:A.zM().optional()}),sw=e=>{var s,a,i,n,r,l,o,c,d,u;let{userData:m,avatarExists:p}=e,x=(0,I.mN)({defaultValues:{display_name:null!=(l=null==(s=m.attributes)?void 0:s.display_name)?l:"",bio:null!=(o=null==(a=m.attributes)?void 0:a.bio)?o:"",location:null!=(c=null==(i=m.attributes)?void 0:i.location)?c:"",link:null!=(d=null==(n=m.attributes)?void 0:n.link)?d:"",hide_profile_pictures:null!=(u=null==(r=m.attributes)?void 0:r.hide_profile_pictures)&&u},resolver:(0,P.u)(sN)}),g=(0,ed.jE)(),{mutate:f,isPending:y}=(0,C.n)({mutationFn:async e=>(0,v.P)().put("/user/".concat(m.id),{attributes:e}),onSuccess:(e,s)=>{j.toast.success("Success",{description:"Account settings updated successfully"}),x.reset(s),g.invalidateQueries({queryKey:eW.workspaceKeys.all})},onError:e=>{(0,_.Ni)(e)}});return(0,t.jsx)(z.lV,{...x,children:(0,t.jsxs)("form",{className:"flex w-full flex-col gap-6",onSubmit:x.handleSubmit(e=>{let s=x.formState.defaultValues,a=Object.keys(e).filter(a=>e[a]!==(null==s?void 0:s[a]));h.Ay.capture(E.fF.SETTINGS_UPDATED,{changedFields:a,fieldsCount:a.length,hasDisplayName:!!e.display_name,hasBio:!!e.bio,hasLocation:!!e.location,hasLink:!!e.link,hideProfilePictures:!!e.hide_profile_pictures}),f(e)}),children:[(0,t.jsx)(eE.m,{label:"Name",description:"Your full name, as visible to others.",children:(0,t.jsx)(z.zB,{control:x.control,name:"display_name",render:e=>{let{field:s}=e;return(0,t.jsxs)(z.eI,{className:"w-full",children:[(0,t.jsx)(z.MJ,{children:(0,t.jsx)(T.p,{...s})}),(0,t.jsx)(z.C5,{})]})}})}),(0,t.jsx)(eE.m,{label:"Description",description:"A short description of yourself or your work.",children:(0,t.jsx)(z.zB,{control:x.control,name:"bio",render:e=>{let{field:s}=e;return(0,t.jsxs)(z.eI,{className:"w-full",children:[(0,t.jsx)(z.MJ,{children:(0,t.jsx)(eP.T,{className:"resize-none border bg-background",rows:3,...s})}),(0,t.jsx)(z.C5,{})]})}})}),(0,t.jsx)(eE.m,{label:"Location",description:"Where you're based.",children:(0,t.jsx)(z.zB,{control:x.control,name:"location",render:e=>{let{field:s}=e;return(0,t.jsxs)(z.eI,{className:"w-full",children:[(0,t.jsx)(z.MJ,{children:(0,t.jsx)(T.p,{...s})}),(0,t.jsx)(z.C5,{})]})}})}),(0,t.jsx)(eE.m,{label:"Link",description:"Add a link to your personal website or portfolio.",children:(0,t.jsx)(z.zB,{control:x.control,name:"link",render:e=>{let{field:s}=e;return(0,t.jsxs)(z.eI,{className:"w-full",children:[(0,t.jsx)(z.MJ,{children:(0,t.jsx)(T.p,{...s})}),(0,t.jsx)(z.C5,{})]})}})}),p&&(0,t.jsx)(eE.m,{label:"Hide profile picture",mobileLayout:"horizontal",className:"last:border-b",children:(0,t.jsx)(z.zB,{control:x.control,name:"hide_profile_pictures",render:e=>{let{field:s}=e;return(0,t.jsxs)(z.eI,{className:"ml-auto flex flex-row items-center space-x-2 space-y-0",children:[(0,t.jsx)(z.MJ,{children:(0,t.jsx)(sb.S,{checked:s.value,onCheckedChange:s.onChange})}),(0,t.jsx)(z.C5,{})]})}})}),x.formState.isDirty&&(0,t.jsxs)(eE.E,{className:"justify-end gap-2",children:[(0,t.jsx)(L.$,{type:"button",variant:"secondary",onClick:()=>{h.Ay.capture(E.fF.SETTINGS_CANCELLED),x.reset()},children:"Cancel"}),(0,t.jsx)(L.$,{type:"submit",loading:y,variant:"affirmative",children:"Update"})]})]})})},sk=A.Ik({username:A.Yj().min(3,{message:"Username must be at least 3 characters"}).max(16,{message:"Username must be at most 16 characters"}).regex(/^[a-z0-9_]+$/,{message:"Username can only contain lowercase English letters, numbers, and underscores"}).regex(/^[a-z]/,{message:"Username must start with a lowercase English letter"})}),sC=e=>{let s=(0,I.mN)({resolver:(0,P.u)(sk),defaultValues:{username:""}}),a=(0,C.n)({mutationFn:async e=>{let{username:s}=e;return(0,v.P)().put("/user/username",{username:s})},onSuccess:()=>{var s;j.toast.success("Success",{description:"Username updated successfully"}),null==(s=e.onOpenChange)||s.call(e,!1)},onError:e=>{(0,_.Ni)(e)}});return(0,t.jsx)(D.lG,{...e,children:(0,t.jsxs)(D.Cf,{children:[(0,t.jsx)(D.L3,{children:"Set Username"}),(0,t.jsx)(D.rr,{children:"Please enter your desired username. You cannot change your username once you have set it."}),(0,t.jsx)("form",{onSubmit:s.handleSubmit(e=>{a.mutate(e)}),children:(0,t.jsxs)(z.lV,{...s,children:[(0,t.jsx)(z.zB,{control:s.control,name:"username",render:e=>{let{field:s}=e;return(0,t.jsxs)(z.eI,{className:"w-full",children:[(0,t.jsx)(z.lR,{children:"Username"}),(0,t.jsx)(z.MJ,{children:(0,t.jsx)(T.p,{...s})}),(0,t.jsx)(z.C5,{})]})}}),(0,t.jsx)(D.Es,{className:"mt-4",children:(0,t.jsx)(L.$,{loading:a.isPending,type:"submit",children:"Save"})})]})})]})})},s_=e=>{let{username:s,userId:a}=e,[i,r]=(0,n.useState)(!1),l=!!a&&s===a;return(0,t.jsxs)(eE.m,{label:"Username",description:"Your public identifier and profile URL.",children:[(0,t.jsxs)("div",{className:"flex w-full flex-col gap-4",children:[(0,t.jsx)("div",{className:"flex items-center justify-start gap-2",children:(0,t.jsx)(T.p,{placeholder:"Username",className:"w-full",value:null!=s?s:"",disabled:!l,readOnly:!0,onClick:()=>{s&&r(!0)}})}),(0,t.jsxs)("p",{className:"flex items-center gap-1 break-all text-sm text-muted-foreground underline transition-colors duration-150 ease-in-out hover:text-muted-foreground/80",children:[s?(0,t.jsxs)(x(),{className:"",href:"".concat(window.location.origin,"/@").concat(s),target:"_blank",rel:"noreferrer",children:["lovable.dev/@",s]}):"lovable.dev/@<username>",(0,t.jsx)(F.A,{name:"arrow_up_right",size:"small"})]})]}),(0,t.jsx)(sC,{open:i,onOpenChange:r})]})},sS=()=>{let{userData:e}=(0,d.ur)();return(0,n.useCallback)((s,a)=>{h.Ay.capture(s,{...a,userId:null==e?void 0:e.id})},[null==e?void 0:e.id])};var sE=a(16596),sP=a(49493),sI=a(26846),sA=a(35418);let sL=["I didn't find the product useful","It's too confusing","Missing features","Too expensive","Privacy concerns","I'm switching to a different product","This is a duplicate account","Other"],sD=e=>{let{isOpen:s,onClose:a,userEmail:r,userId:l}=e,[o,c]=(0,n.useState)(null),[u,m]=(0,n.useState)("workspaces"),[p,x]=(0,n.useState)(0),[h,g]=(0,n.useState)(""),[f,y]=(0,n.useState)(!1),[b,N]=(0,n.useState)(0),[w,k]=(0,n.useState)(""),[C,S]=(0,n.useState)(""),[P,I,A]=(0,sE.Rt)(sA.auth),z=(0,i.useRouter)(),{userData:O}=(0,d.ur)(),M=(0,sP.Mu)(e=>e.workspaces),R=(0,n.useMemo)(()=>M.filter(e=>e.owner_id===l),[M,l]),U=R.length>0,[$,q]=(0,n.useState)({}),B=sS(),W=(0,n.useMemo)(()=>{var e;let s=null!=(e=null==O?void 0:O.scheduledDeletionAt)?e:null;return s?(0,eO.GP)(s.toDate(),"MMM d, yyyy"):null},[O]),G=(0,n.useMemo)(()=>(0,eO.GP)(new Date(Date.now()+1728e5),"MMM d, yyyy"),[]),K=h.trim().toLowerCase(),Y=(r||"").trim().toLowerCase(),Z=f||K!==Y||!r;(0,n.useEffect)(()=>{"workspaces"!==u||U||m("email")},[u,U]),(0,n.useEffect)(()=>{p>0&&p>=R.length&&x(Math.max(0,R.length-1))},[p,R.length]),(0,n.useEffect)(()=>{if(W||"intro"!==u)N(0);else{N(3);let e=setInterval(()=>{N(s=>s<=1?(clearInterval(e),0):s-1)},1e3);return()=>clearInterval(e)}},[u,W]);let Q=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];e&&B(E.fF.DELETE_ACCOUNT.DIALOG_CLOSED,{step:u}),a(),c(null),m(U?"workspaces":"email"),x(0),g(""),q({}),k(""),S("")},H=async()=>{let e={reason:w,..."Other"===w&&C?{reasonOther:C}:{}};B(E.fF.DELETE_ACCOUNT.DELETION_CONFIRMED,e),y(!0);try{await (0,v.P)().delete("/user/".concat(l)),B(E.fF.DELETE_ACCOUNT.DELETION_SCHEDULED),j.toast.success("Deletion scheduled",{description:"Your account will be deleted in 2 days."}),z.push("/"),await P(),await fetch("/api/logout"),z.refresh(),Q(!1)}catch(e){(0,_.Ni)(e),c("Failed to schedule account deletion")}finally{y(!1)}},J=async()=>{y(!0);try{await (0,v.P)().post("/user/".concat(l,"/deletion/cancel")),B(E.fF.DELETE_ACCOUNT.DELETION_CANCELLED),j.toast.success("Deletion canceled",{description:"Your account will not be deleted."}),z.refresh(),Q(!1)}catch(e){(0,_.Ni)(e),c("Failed to cancel deletion")}finally{y(!1)}},X=W?{title:"Cancel account deletion",description:"Your account is scheduled for deletion on ".concat(W,". You can cancel this to keep your account.")}:"intro"===u?{title:"Delete your account",description:"This action is permanent and cannot be undone."}:"workspaces"===u?{title:"Confirm workspace deletion",description:"You own this workspace. To keep it, transfer ownership to another member before deleting your account."}:{title:"Confirm email",description:(0,t.jsxs)(t.Fragment,{children:["Type your email address to confirm: ",(0,t.jsx)("span",{className:"font-medium",children:r})]})},ee=W||"intro"!==u?null:(0,t.jsxs)("div",{className:"rounded-lg border border-destructive-primary/50 bg-destructive p-4 text-destructive-foreground",children:[(0,t.jsx)("div",{className:"mb-2 text-base font-medium",children:"This will permanently delete:"}),(0,t.jsxs)("ul",{className:"list-disc space-y-1 pl-5 text-sm",children:[(0,t.jsx)("li",{children:"Your active subscriptions"}),(0,t.jsx)("li",{children:"Any workspaces you own, unless you transferred ownership"}),(0,t.jsx)("li",{children:"Your workspace memberships and invitations"}),(0,t.jsx)("li",{children:"Your account and all associated data"})]})]});return(0,t.jsx)(D.lG,{open:s,onOpenChange:()=>Q(),children:(0,t.jsxs)(D.Cf,{size:"md",className:"flex flex-col gap-3",children:[(0,t.jsxs)(D.c7,{children:[(0,t.jsx)(D.L3,{className:"text-xl leading-none",children:X.title}),(0,t.jsx)(D.rr,{className:"text-sm",children:X.description})]}),ee&&ee,(()=>{if(W)return o&&(0,t.jsx)("p",{className:"text-sm text-destructive-primary",children:o});if("intro"===u)return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"rounded-lg bg-muted p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)(F.A,{name:"schedule",className:"text-muted-foreground",size:"small"}),(0,t.jsxs)("span",{children:["Deletion will be scheduled for ",(0,t.jsx)("span",{className:"font-medium",children:G}),"."]})]})}),(0,t.jsxs)("div",{className:"space-y-3 pb-4",children:[(0,t.jsx)(V.Label,{className:"text-sm font-medium text-muted-foreground",children:"Why are you deleting your account?"}),(0,t.jsx)(sI.z,{value:w,onValueChange:k,children:sL.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(sI.C,{value:e,id:"reason-".concat(e)}),(0,t.jsx)(V.Label,{htmlFor:"reason-".concat(e),className:"cursor-pointer text-sm font-normal",children:e})]},e))}),"Other"===w&&(0,t.jsx)(T.p,{type:"text",placeholder:"Tell us more (optional)",value:C,onChange:e=>S(e.target.value),maxLength:500,onKeyDown:e=>e.stopPropagation(),className:"mt-2"})]})]});if("workspaces"===u){var e;let s=R.length,a=R[Math.min(p,Math.max(s-1,0))],i=null!=(e=a&&$[a.id])?e:"";return a&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"rounded-lg bg-muted p-4",children:[(0,t.jsx)("div",{className:"mb-2 text-sm text-muted-foreground",children:"Workspace"}),(0,t.jsx)("div",{className:"text-base font-medium",children:a.name})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(V.Label,{htmlFor:"confirm-workspace-name-input",className:"text-sm font-medium",children:"Type the workspace name to confirm"}),(0,t.jsx)(T.p,{id:"confirm-workspace-name-input",type:"text",placeholder:"Workspace name",value:i,onChange:e=>q(s=>({...s,[a.id]:e.target.value})),onKeyDown:e=>e.stopPropagation(),autoFocus:!0})]})]})}return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(V.Label,{htmlFor:"confirm-email-input",className:"text-sm font-medium",children:"Type your email address to confirm"}),(0,t.jsx)(T.p,{id:"confirm-email-input",type:"email",placeholder:"email@domain.com",value:h,onChange:e=>g(e.target.value),autoFocus:!0,onKeyDown:e=>e.stopPropagation()})]}),o&&(0,t.jsx)("p",{className:"text-sm text-destructive-primary",children:o})]})})(),(0,t.jsx)(D.Es,{className:"flex w-full gap-3",children:(()=>{if(W)return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(L.$,{variant:"secondary",onClick:()=>Q(),disabled:f,className:"flex-1",children:"Close"}),(0,t.jsx)(L.$,{onClick:J,loading:f,className:"flex-1",children:f?"Canceling...":"Keep my account"})]});if("intro"===u)return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(L.$,{variant:"secondary",onClick:()=>{m("email")},disabled:f,className:"flex-1",children:"Back"}),(0,t.jsx)(L.$,{variant:"destructive",onClick:H,disabled:Z||b>0||""===w,loading:f,className:"flex-1",children:f?"Processing...":b>0?"Delete account (".concat(b,")"):"Delete account"})]});if("workspaces"===u){var e,s;let a=R.length,i=R[Math.min(p,Math.max(a-1,0))],n=(null!=(e=null==i?void 0:i.name)?e:"").trim(),r=(null!=(s=i&&$[i.id])?s:"").trim();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(L.$,{variant:"secondary",onClick:()=>Q(),className:"flex-1",children:"Cancel"}),(0,t.jsx)(L.$,{onClick:()=>{p>=a-1?(B(E.fF.DELETE_ACCOUNT.CONTINUE_FROM_WORKSPACES),m("email")):x(e=>Math.min(a-1,e+1))},disabled:r!==n,className:"flex-1",children:"Continue"})]})}return(0,t.jsxs)(t.Fragment,{children:[U?(0,t.jsx)(L.$,{variant:"secondary",onClick:()=>{m("workspaces")},disabled:f,className:"flex-1",children:"Back"}):(0,t.jsx)(L.$,{variant:"secondary",onClick:()=>Q(),disabled:f,className:"flex-1",children:"Cancel"}),(0,t.jsx)(L.$,{onClick:()=>{B(E.fF.DELETE_ACCOUNT.CONTINUE_FROM_EMAIL),m("intro")},disabled:K!==Y||f,className:"flex-1",children:"Continue"})]})})()})]})})},sz=()=>{let{authUser:e}=(0,sp.Z2)(),{userData:s}=(0,d.ur)(),[a,i]=(0,n.useState)(!1),r=sS();if(!s)return null;let l=!!s.scheduledDeletionAt,o=l?(0,eO.GP)(s.scheduledDeletionAt.toDate(),"MMM d, yyyy"):null,c=(null==e?void 0:e.email)||"";return(0,t.jsxs)(eE.m,{label:"Delete account",description:l?"Your account is scheduled to be deleted on ".concat(o,"."):"Permanently delete your Lovable account. This cannot be undone.",children:[l?(0,t.jsx)(L.$,{onClick:()=>{r(E.fF.DELETE_ACCOUNT.DIALOG_OPENED),i(!0)},children:"Cancel deletion"}):(0,t.jsx)(L.$,{variant:"destructive",onClick:()=>{r(E.fF.DELETE_ACCOUNT.DIALOG_OPENED),i(!0)},children:"Delete account"}),(0,t.jsx)(sD,{isOpen:a,onClose:()=>i(!1),userEmail:c,userId:s.id})]})};var sF=a(14934),sT=a(18502);let sO=Math.ceil(365/7),sM=e=>{let{userId:s}=e,{userData:a}=(0,d.ur)(),{contributions:i,isLoading:r}=(e=>{let{data:s={},isLoading:a}=(0,sT.I)({...sh.Y.contributions({userId:e}),enabled:!!e,staleTime:3e5});return{contributions:s,isLoading:a}})(null!=s?s:null==a?void 0:a.id),l=(0,n.useRef)(null),[o,c]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1);if((0,n.useEffect)(()=>{let e=()=>{let e=l.current;e&&(c(e.scrollLeft>0),m(e.scrollLeft+e.clientWidth<e.scrollWidth-1))},s=l.current;if(s)return s.scrollLeft=s.scrollWidth,c(s.scrollLeft>0),m(s.scrollWidth>s.clientWidth&&s.scrollLeft+s.clientWidth<s.scrollWidth-1),s.addEventListener("scroll",e),window.addEventListener("resize",e),()=>{s.removeEventListener("scroll",e),window.removeEventListener("resize",e)}},[]),r)return(0,t.jsxs)("div",{className:"mb-4 flex flex-col gap-2",children:[(0,t.jsx)("div",{className:"h-5 w-64 animate-pulse rounded bg-muted"}),(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("div",{className:"inline-block min-w-[600px] max-w-[760px] rounded-xl border border-input bg-card p-2",children:(0,t.jsx)("div",{className:"flex gap-[2px]",children:Array.from({length:sO}).map((e,s)=>(0,t.jsx)("div",{className:"flex flex-col gap-[2px]",children:Array.from({length:7}).map((e,a)=>(0,t.jsx)("div",{className:"size-2.5 animate-pulse rounded-[2px] bg-muted"},"skeleton-day-".concat(s,"-").concat(a)))},"skeleton-week-".concat(s)))})})}),(0,t.jsxs)("div",{className:"grid max-w-[652px] grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"border-r py-3",children:[(0,t.jsx)("div",{className:"h-4 w-20 animate-pulse rounded bg-muted"}),(0,t.jsx)("div",{className:"mt-1 h-5 w-16 animate-pulse rounded bg-muted"})]}),(0,t.jsxs)("div",{className:"border-r py-3",children:[(0,t.jsx)("div",{className:"h-4 w-20 animate-pulse rounded bg-muted"}),(0,t.jsx)("div",{className:"mt-1 h-5 w-16 animate-pulse rounded bg-muted"})]}),(0,t.jsxs)("div",{className:"py-3",children:[(0,t.jsx)("div",{className:"h-4 w-20 animate-pulse rounded bg-muted"}),(0,t.jsx)("div",{className:"mt-1 h-5 w-16 animate-pulse rounded bg-muted"})]})]})]});let{weeks:p,max:x,totalEditsYear:h,daysEdited:j,currentStreak:g,dailyAverage:f,daysEditedPct:v}=(e=>{let s=new Date,a=[];for(let t=0;t<sO;t++){let i=[];for(let a=0;a<7;a++){let n=(0,sF.e)(s,(sO-t-1)*7+(7-a-1)),r=e[(0,eO.GP)(n,"yyyy-MM-dd")]||0;i.push({date:n,count:r})}a.push(i)}let t=Math.max(...Object.values(e),0),i=a.flat().slice(-365),n=0,r=0;for(let e of i)n+=e.count,e.count>0&&r++;let l=0;for(let e=i.length-1;e>=0;e--)if(i[e].count>0)l++;else break;let o=n/365,c=r/365*100;return{weeks:a,max:t,totalEditsYear:n,daysEdited:r,currentStreak:l,dailyAverage:o,daysEditedPct:c}})(i);return(0,t.jsxs)("div",{className:"mb-4 flex flex-col gap-2",children:[(0,t.jsxs)("p",{className:"flex items-center gap-1 text-base font-medium",children:[h," edits on"," ",(0,t.jsxs)("span",{className:"pl-0.5 pr-px",children:[(0,t.jsx)(O.Qn,{className:"flex h-[12px] dark:hidden"}),(0,t.jsx)(O.I_,{className:"hidden h-[12px] dark:flex"})]})," ","in the last year"]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{ref:l,className:"overflow-x-auto pb-2",children:(0,t.jsx)("div",{className:"inline-block min-w-[600px] max-w-[760px] rounded-xl border border-input bg-card p-2",children:(0,t.jsx)("div",{className:"flex gap-[2px]",children:p.map(e=>(0,t.jsx)("div",{className:"flex flex-col gap-[2px]",children:e.map(e=>(0,t.jsxs)(ei.m_,{children:[(0,t.jsx)(ei.k$,{asChild:!0,children:(0,t.jsx)("div",{className:"relative size-2.5",children:(0,t.jsx)("div",{className:(0,eI.cn)("absolute inset-0 z-10 size-2.5 rounded-[2px] transition-colors duration-200",((e,s)=>{if(0===e||0===s)return"bg-muted";let a=e/s;return a<=.25?"bg-brand-sapphire-primary/40":a<=.5?"bg-brand-sapphire-primary/60":a<=.75?"bg-brand-sapphire-primary/80":"bg-brand-sapphire-primary"})(e.count,x))})})}),(0,t.jsxs)(ei.ZI,{side:"top",align:"center",children:["".concat((0,eO.GP)(e.date,"MMM d, yyyy"),": ").concat(e.count>0?e.count:"No"," ").concat(1===e.count?"edit":"edits"),(0,t.jsx)(ei.PR,{})]})]},e.date.getTime()))},e[0].date.getTime()))})})}),o&&(0,t.jsx)("div",{className:"pointer-events-none absolute left-0 top-0 h-full w-6 bg-gradient-to-r from-background via-background/80 to-transparent"}),u&&(0,t.jsx)("div",{className:"pointer-events-none absolute right-0 top-0 h-full w-6 bg-gradient-to-l from-background via-background/80 to-transparent"})]}),(0,t.jsxs)("div",{className:"grid max-w-[652px] grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"border-r py-3",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Daily average"}),(0,t.jsxs)("div",{className:"text-base font-medium",children:[f.toFixed(1)," ","1.0"===f.toFixed(1)?"edit":"edits"]})]}),(0,t.jsxs)("div",{className:"border-r py-3",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Days edited"}),(0,t.jsxs)("div",{className:"text-base font-medium",children:[j," (",v.toFixed(0),"%)"]})]}),(0,t.jsxs)("div",{className:"py-3",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Current streak"}),(0,t.jsxs)("div",{className:"text-base font-medium",children:[g," ",1===g?"day":"days"]})]})]})]})};var sR=a(30101);let sU=e=>{switch(e){case"password":return"Password";case"google.com":return"Google";case"github.com":return"GitHub";case"microsoft.com":return"Microsoft";case"apple.com":return"Apple";default:if(e.startsWith("oidc.")||e.startsWith("saml."))return"SSO";return e}},s$=()=>{var e;let s=(0,ed.jE)(),[a,i]=(0,n.useState)(null),[r,l]=(0,n.useState)(!1),[o,c]=(0,n.useState)(null),{data:d,isLoading:u}=(0,sT.I)({queryKey:["auth-providers"],queryFn:async()=>(0,v.P)().get("/user/auth-providers"),staleTime:3e4}),m=null!=(e=null==d?void 0:d.providers)?e:[],{mutateAsync:p}=(0,C.n)({mutationFn:async e=>(0,v.P)().delete("/user/auth-providers/".concat(e)),onSuccess:()=>{j.toast.success("Provider unlinked"),s.invalidateQueries({queryKey:["auth-providers"]})},onError:e=>{(0,_.Ni)(e)},onSettled:()=>{i(null),l(!1),c(null)}}),x=async()=>{o&&(i(o.provider_id),await p(o.provider_id))};return u||0!==m.length?(0,t.jsxs)(eE.m,{label:"Linked sign-in providers",description:"Manage authentication providers linked to your account.",children:[(0,t.jsx)("div",{className:"w-full space-y-3",children:u?(0,t.jsxs)("div",{className:"flex w-full items-center justify-between rounded-md border p-3",children:[(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-3",children:[(0,t.jsx)(ez.E,{className:"h-8 w-8 rounded-md"}),(0,t.jsxs)("div",{className:"min-w-0 space-y-2",children:[(0,t.jsx)(ez.E,{className:"h-4 w-24"}),(0,t.jsx)(ez.E,{className:"h-3 w-40"})]})]}),(0,t.jsx)(ez.E,{className:"h-8 w-16"})]}):m.map(e=>{var s,i;let n="password"===e.provider_id,r=!e.can_unlink;return(0,t.jsxs)("div",{className:"flex w-full items-center justify-between rounded-md border p-3",children:[(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-3",children:[(0,t.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-md bg-secondary text-secondary-foreground",children:"google.com"===e.provider_id?(0,t.jsx)(O.gu,{name:"Google",className:"h-5 w-5"}):"apple.com"===e.provider_id?(0,t.jsx)(O.gu,{name:"Apple",className:"h-5 w-5"}):"github.com"===e.provider_id?(0,t.jsx)(O.gu,{name:"GitHub",className:"h-5 w-5"}):"microsoft.com"===e.provider_id?(0,t.jsx)(O.gu,{name:"Outlook",className:"h-5 w-5"}):(0,t.jsx)(F.A,{name:(e=>"password"===e?"key":"google.com"===e||"github.com"===e||"microsoft.com"===e||"apple.com"===e?"globe":e.startsWith("oidc.")||e.startsWith("saml.")?"shield":"link")(e.provider_id)})}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"font-medium",children:sU(e.provider_id)}),e.is_primary?(0,t.jsx)(ep.E,{variant:"secondary",children:"Primary"}):null]}),(0,t.jsx)("div",{className:"truncate text-sm text-muted-foreground",children:null!=(s=e.email)?s:""})]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:n||r?null:(0,t.jsx)(L.$,{variant:"outline",size:"sm",disabled:a===e.provider_id,onClick:()=>{c(e),l(!0)},children:a===e.provider_id?"Unlinkingâ€¦":"Unlink"})})]},"".concat(e.provider_id,":").concat(null!=(i=e.email)?i:""))})}),(0,t.jsx)(sR.A,{open:r,onOpenChange:l,icon:"warning",title:"Unlink provider",description:o?(0,t.jsxs)("div",{className:"text-sm",children:["This will disconnect ",(0,t.jsx)("span",{className:"font-medium",children:sU(o.provider_id)}),o.email?(0,t.jsxs)("span",{children:[" (",o.email,")"]}):null," from your account. You may need to sign in again with another linked method."]}):"",confirmText:a===(null==o?void 0:o.provider_id)?"Unlinking...":"Unlink",cancelText:"Cancel",confirmVariant:"destructive",isLoading:a===(null==o?void 0:o.provider_id),onConfirm:x})]}):null},sq=e=>{let{active:s,setActive:a,onClick:i,disabled:n}=e;return(0,t.jsxs)(sI.z,{className:"flex w-full flex-col gap-4",disabled:n,defaultValue:s,onValueChange:e=>{a(e)},children:[(0,t.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,t.jsx)(sI.C,{value:"firstgen",id:"firstgen",onClick:()=>{null==i||i()}}),(0,t.jsx)(V.Label,{htmlFor:"firstgen",className:"flex w-full cursor-pointer flex-col gap-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium",children:[(0,t.jsx)(F.A,{size:"small",name:"volume_1",className:"text-muted-foreground"}),"First Generation"]})})]}),(0,t.jsxs)("div",{className:"flex w-full items-start space-x-2",children:[(0,t.jsx)(sI.C,{value:"always",id:"always",onClick:()=>{null==i||i()}}),(0,t.jsx)(V.Label,{htmlFor:"always",className:"flex w-full cursor-pointer flex-col gap-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium",children:[(0,t.jsx)(F.A,{size:"small",name:"volume_on",className:"text-muted-foreground"}),"Always"]})})]}),(0,t.jsxs)("div",{className:"flex w-full items-start space-x-2",children:[(0,t.jsx)(sI.C,{value:"never",id:"never",onClick:()=>{null==i||i()}}),(0,t.jsx)(V.Label,{htmlFor:"never",className:"flex w-full cursor-pointer flex-col gap-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium",children:[(0,t.jsx)(F.A,{size:"small",name:"volume_off",className:"text-muted-foreground"}),"Never"]})})]})]})},sB=()=>{var e;let{userData:s}=(0,d.ur)(),a=(()=>{let{userData:e}=(0,d.ur)();return(0,C.n)({mutationFn:async s=>{let a=(0,v.P)();return await a.put("/user/".concat(e.id),{sound_effect_active:s})},onSuccess:(e,s)=>{j.toast.success("Sound effect settings updated",{description:"Sound effects will now play ".concat("firstgen"===s?"on first generation":"always"===s?"on all generations":"never")})},onError:e=>{(0,_.Ni)(e)}})})(),i=null!=(e=null==s?void 0:s.sound_effect_active)?e:"firstgen";return(0,t.jsx)(eE.m,{label:"Generation complete sound",description:"Plays a satisfying sound notification when a generation is finished.",children:s?(0,t.jsx)(sq,{active:i,setActive:e=>{a.mutate(e)}}):(0,t.jsx)(ez.E,{className:"h-10 w-full"})})},sW=()=>{let{userData:e}=(0,d.ur)(),s=(()=>{let{userData:e}=(0,d.ur)();return(0,C.n)({mutationFn:async s=>(0,v.P)().put("/user/".concat(e.id),{suggestions_enabled:s}),onSuccess:(e,s)=>{j.toast.success("Suggestions settings updated",{description:"Suggestions are now ".concat(s?"enabled":"disabled")})},onError:e=>{(0,_.Ni)(e)}})})(),a=(null==e?void 0:e.suggestions_enabled)!==!1;return(0,t.jsx)(eE.m,{label:"Chat Suggestions",description:"Show helpful suggestions in the chat interface to enhance your experience.",mobileLayout:"horizontal",isLast:!1,children:e?(0,t.jsx)(eZ.d,{checked:a,onCheckedChange:e=>{s.mutate(e)},className:"ml-auto"}):(0,t.jsx)(ez.E,{className:"h-5 w-9"})})},sG=()=>{let{authUser:e}=(0,sp.Z2)(),{userData:s}=(0,d.ur)(),a=(0,l.j4)(e=>{var s;return null==(s=e.currentWorkspace)?void 0:s.plan}),{isEnterprisePlan:n}=(0,eg.cb)(a),r=(0,i.useRouter)();return s?(0,t.jsxs)(ee.Pt,{value:"account",title:"Account settings",description:"Personalize how others see and interact with you on Lovable.",children:[!n&&(0,t.jsx)(sM,{}),(0,t.jsx)(sv,{userData:s,authUser:e}),(0,t.jsx)(s_,{userId:s.id,username:s.username}),(0,t.jsx)(sy,{authUser:e}),(0,t.jsx)(sw,{userData:s,avatarExists:!!(null==e?void 0:e.photoURL)}),(0,t.jsx)(sW,{}),(0,t.jsx)(sB,{}),(0,t.jsx)(s$,{}),(0,t.jsx)(eE.m,{label:"Link SSO",description:"Connect your account to company SSO.",children:(0,t.jsx)(L.$,{variant:"outline",onClick:()=>r.push("/sso-login/"),children:"Link SSO"})}),(0,t.jsx)(sz,{}),(0,t.jsx)("div",{className:"mb-12"})]}):null};var sK=a(35385),sV=a(56239);let sY=e=>{var s,a,t;let{userData:i}=(0,d.ur)(),r=null==i||null==(s=i.github)?void 0:s.encrypted_access_token,l=(0,n.useRef)(r),o=(0,eF.I)({...sc.y.workspaceGithubInstallations({workspaceId:e}),permission:ev.eZ.CreateWorkspaceProjects});return(0,n.useEffect)(()=>{l.current!==r&&(o.refetch().catch(()=>{}),l.current=r)},[r,o]),{installations:null==(a=o.data)?void 0:a.installations,requiredAction:null==(t=o.data)?void 0:t.required_action}};var sZ=a(71733);let sQ=e=>{let{isLoading:s,hasAccessToken:a,hasValidAccessToken:i,githubUsername:r,onGithubConnected:l,canManageWorkspaceGit:o}=e;return(0,n.useEffect)(()=>{let e=e=>{"githubAppAuthenticated"===e.data&&l()};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[l]),(0,t.jsx)(eE.m,{label:"Connected Account",description:"Add your GitHub account to manage connected organizations.",justify:"end",badges:["admin"],children:s?(0,t.jsx)(ez.E,{className:"h-7 w-32"}):a&&i?(0,t.jsxs)(L.$,{disabled:!0,variant:"outline",size:"sm",children:[(0,t.jsx)(O.gu,{name:"GitHub",className:"h-4 w-4"}),null!=r?r:"Connected"]}):(0,t.jsx)(sH,{canManageWorkspaceGit:o})})},sH=e=>{let{canManageWorkspaceGit:s}=e;return(0,t.jsxs)(L.$,{variant:"default",size:"sm",onClick:sZ.pT,disabled:!s,children:[(0,t.jsx)(O.gu,{name:"GitHub",className:"h-4 w-4"}),"Connect GitHub"]})};var sJ=a(89002),sX=a(89405);function s0(e){let{projectId:s,main_branch:a,searchTerm:i,setSearchTerm:r,switchBranchMutation:l}=e,{data:o,isPending:c,error:d}=(0,sT.I)({queryKey:eW.gO.branches(s),queryFn:async()=>(0,v.P)().get("/projects/".concat(s,"/github/branches"))}),u=(0,n.useMemo)(()=>null==o?void 0:o.some(e=>e.name===a),[o,a]),{branchesWithCurrentFirst:m,filteredBranches:p}=(0,n.useMemo)(()=>{if(!o)return{branchesWithCurrentFirst:[],filteredBranches:[]};let e=o.filter(e=>e.name.toLowerCase().includes(i.toLowerCase())),s=e.find(e=>e.name===a);return s?{branchesWithCurrentFirst:[s,...e.filter(e=>e.name!==a)],filteredBranches:e}:{branchesWithCurrentFirst:e,filteredBranches:e}},[o,a,i]);return(0,t.jsxs)("div",{className:"relative flex flex-col gap-3 p-4",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)("h4",{children:"Switch or create branch"}),(0,t.jsx)(sJ.iN,{className:"absolute right-2 top-2",asChild:!0,children:(0,t.jsx)(L.$,{variant:"ghost",size:"icon-sm",children:(0,t.jsx)(F.A,{name:"x",size:"small"})})})]}),(0,t.jsx)("div",{children:c?(0,t.jsx)(sX.I,{text:"Loading branches from GitHub..."}):d?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-destructive-primary",children:[(0,t.jsx)(F.A,{name:"warning_fill",size:"small"}),d.message]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"",children:(0,t.jsx)(T.p,{type:"text",placeholder:"Find or create a branch...",value:i,onChange:e=>r(e.target.value)})}),(0,t.jsxs)("div",{className:"branches-list flex max-h-[40vh] flex-col gap-2 overflow-y-auto pt-2",children:[m.map(e=>(0,t.jsxs)(L.$,{className:"branch-item flex w-full items-center justify-between px-3 text-left",onClick:()=>l.mutate(e.name),variant:e.name===a?"default":"ghost",disabled:l.isPending||e.name===a,loading:l.isPending&&l.variables===e.name,children:[(0,t.jsx)("span",{children:l.isPending&&l.variables===e.name?"Switching to "+e.name:e.name}),e.name===a&&(0,t.jsx)(F.A,{name:"check"})]},e.name)),i&&!p.some(e=>e.name===i)&&(0,t.jsx)(eY.Q,{showTooltip:!u,tooltipContent:"Your current branch does not exist on GitHub. Please switch to an existing branch first, then create your new branch.",children:(0,t.jsxs)(L.$,{className:(0,eI.cn)("h-auto w-full items-center justify-start"),onClick:()=>l.mutate(i),variant:"outline",disabled:l.isPending||!u,loading:l.isPending,children:[(0,t.jsx)(F.A,{name:"plus_small",className:"text-muted-foreground",size:"small"}),(0,t.jsxs)("p",{className:"text-wrap text-left",children:["Create branch ",(0,t.jsx)("strong",{children:i})," from ",(0,t.jsx)("strong",{children:a})]})]})})]})]})})]})}let s1=e=>{let{mainBranch:s,projectId:a}=e,[i,r]=(0,n.useState)(""),[l,o]=(0,n.useState)(!1),c=(0,eA.Iw)(e=>{var s;return(null==(s=e.project)?void 0:s.main_branch)||"main"}),d=(0,sa.A)("md"),u=(0,ed.jE)(),m=(0,C.n)({mutationFn:async e=>{await (0,v.P)().post("/projects/".concat(a,"/github/branches"),{branch_name:e})},onSuccess:(e,s)=>{u.invalidateQueries({queryKey:eW.gO.branches(a)}),j.toast.success("Lovable is now using branch: ".concat(s)),r(""),o(!1)},onError:e=>{(0,_.Ni)(e)}});return(0,t.jsx)(eE.m,{label:"Branch",description:"Choose the GitHub branch you want to work on inside Lovable.",justify:"end",badges:["labs"],children:(0,t.jsxs)(sJ.AM,{open:l,onOpenChange:o,children:[(0,t.jsx)(sJ.Wv,{asChild:!0,children:(0,t.jsxs)(L.$,{variant:"outline",size:"sm",loading:m.isPending,children:[(0,t.jsx)(F.A,{name:"graph_1",className:"h-4 w-4"}),s,(0,t.jsx)(F.A,{name:"chevron_right",size:"small",className:"rotate-90"})]})}),(0,t.jsx)(sJ.hl,{className:"p-0",align:d?"start":"end",children:(0,t.jsx)(s0,{projectId:a,main_branch:c,searchTerm:i,setSearchTerm:r,switchBranchMutation:m})})]})})};var s2=a(13163),s4=a(20098);let s5=e=>{let{label:s,value:a}=e;return(0,t.jsx)(s2.Xi,{className:"rounded-none border-b border-transparent px-0 py-0.5 text-xs data-[state=active]:border-b-border data-[state=active]:font-medium data-[state=active]:shadow-none",value:a,children:s})},s3=e=>{let{url:s}=e,a=(0,n.forwardRef)((e,s)=>(0,t.jsx)(L.$,{ref:s,...e,variant:"ghost",className:"-mr-2 h-8 hover:text-primary",size:"icon-sm",children:(0,t.jsx)(F.A,{name:"copy",className:"h-4 w-4"})}));a.displayName="TriggerComponent";let i=(0,s4.T)()({TriggerComponent:a,textToCopy:s});return(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(T.p,{className:"h-8 flex-1 p-2 font-mono text-muted-foreground focus:text-primary md:text-xs",value:s,onFocus:e=>e.target.select(),readOnly:!0}),(0,t.jsxs)(ei.m_,{children:[(0,t.jsx)(ei.k$,{asChild:!0,children:i}),(0,t.jsx)(ei.ZI,{children:"Copy to clipboard"})]})]})},s6=e=>{var s,a;let{project:i}=e,n=(null==i?void 0:i.github_repo_name)?(0,sK.rZ)(i.github_repo_name,null==i||null==(s=i.github_owner)?void 0:s.name):"#",r=(null==i||null==(a=i.github_owner)?void 0:a.name)+"/"+(null==i?void 0:i.github_repo_name);return(0,t.jsx)(eE.m,{label:"Clone",description:"Copy this repository to your local environment.",justify:"end",children:(0,t.jsxs)(s2.tU,{defaultValue:"https",className:"w-full pb-2",children:[(0,t.jsxs)(s2.j7,{className:"gap-2 px-0 pb-0 pt-0",children:[(0,t.jsx)(s5,{value:"https",label:"HTTPS"}),(0,t.jsx)(s5,{value:"ssh",label:"SSH"}),(null==i?void 0:i.is_github)&&(0,t.jsx)(s5,{value:"githubcli",label:"GitHub CLI"})]}),(0,t.jsx)(s2.av,{value:"https",className:"mt-0",children:(0,t.jsx)(s3,{url:"".concat(n,".git")})}),(0,t.jsx)(s2.av,{value:"ssh",className:"mt-0",children:(0,t.jsx)(s3,{url:"git@github.com:".concat(r,".git")})}),(0,t.jsx)(s2.av,{value:"githubcli",className:"mt-0",children:(0,t.jsx)(s3,{url:"gh repo clone ".concat(r)})})]})})};var s9=a(33986),s7=a(86652);let s8=e=>{let{setStep:s,installations:a,workspaceInstallations:i,workspace:n}=e,r=i.filter(e=>!a.some(s=>s.id===e.id)),{addGithubTarget:l,isAddGithubTargetLoading:o}=(e=>{let s=(0,ed.jE)(),{mutate:a,isPending:t}=(0,C.n)({mutationFn:async s=>{let{githubInstallation:a}=s,t=(0,v.P)();return await t.post("/workspaces/".concat(e,"/github-installations"),{github_installation_id:a.id})},onSuccess:async(a,t)=>{let i=eW.workspaceKeys.workspaceGithubInstallations(e),n=s.getQueryData(i);n&&s.setQueryData(i,{...n,installations:[...n.installations,t.githubInstallation]}),j.toast.success("Added GitHub Organization",{description:"You can now transfer projects in this workspace to ".concat(t.githubInstallation.account.login)})},onError:e=>{(0,_.Ni)(e)},onSettled:()=>{s.invalidateQueries({queryKey:eW.workspaceKeys.workspaceGithubInstallations(e)})}});return{addGithubTarget:a,isAddGithubTargetLoading:t}})(n.id),c=e=>{l({githubInstallation:e})},{deleteGithubTarget:d,isDeleteGithubTargetLoading:u}=(e=>{let s=(0,ed.jE)(),{mutate:a,isPending:t}=(0,C.n)({mutationFn:async s=>{let{githubInstallation:a}=s;return(0,v.P)().delete("/workspaces/".concat(e,"/github-installations/").concat(a.id))},onSuccess:async(a,t)=>{let i=eW.workspaceKeys.workspaceGithubInstallations(e),n=s.getQueryData(i);n&&s.setQueryData(i,{...n,installations:n.installations.filter(e=>e.id!==t.githubInstallation.id)}),j.toast.success("Removed GitHub Organization",{description:"You can no longer transfer projects in this workspace to ".concat(t.githubInstallation.account.login)})},onError:e=>{(0,_.Ni)(e)},onSettled:()=>{s.invalidateQueries({queryKey:eW.workspaceKeys.workspaceGithubInstallations(e)})}});return{deleteGithubTarget:a,isDeleteGithubTargetLoading:t}})(n.id),m=e=>{d({githubInstallation:e})},p=i.length>0;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s9.Fh,{title:"Link your workspace to GitHub",description:"Anyone in your Lovable workspace can add Lovable projects to GitHub organizations.",badge:"admin"}),(0,t.jsx)(eU.w,{}),(0,t.jsxs)("div",{className:"grid min-h-[200px] grid-cols-1 gap-3 px-6 py-6 md:grid-cols-2",children:[(0,t.jsx)(s9.tX,{workspace:n}),(0,t.jsxs)("div",{className:"flex max-h-[40vh] flex-col gap-3 overflow-y-auto",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-muted-foreground",children:"GitHub Organizations"}),a.map(e=>{let s=i.find(s=>s.id===e.id);return(0,t.jsx)(ae,{installation:e,workspaceInstallation:s,addWorkspaceInstallation:c,disabled:o||u,deleteGithubTarget:m},e.id)}),r.length>0&&(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Other users have added the following organizations:"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"If unlinked, you can not add them back."}),(0,t.jsx)("div",{className:"flex flex-col gap-2",children:r.map(e=>(0,t.jsx)(ae,{installation:e,workspaceInstallation:e,addWorkspaceInstallation:c,disabled:o||u,deleteGithubTarget:m},e.id))})]})}),(0,t.jsx)(L.$,{variant:a.length>0?"outline":"default",size:"sm",onClick:()=>(0,sZ.CN)({githubOwner:null,workspaceId:n.id}),className:"mt-auto",children:"Add Organizations"})]})]}),(0,t.jsx)(eU.w,{}),(0,t.jsx)(s9.p8,{children:(0,t.jsx)(eY.Q,{tooltipContent:"Please add and enable at least one organization to continue.",showTooltip:!p,className:"ml-auto",children:(0,t.jsx)(L.$,{disabled:!p,onClick:()=>s("transfer"),size:"sm",className:"ml-auto",children:"Continue"})})})]})},ae=e=>{let{installation:s,workspaceInstallation:a,addWorkspaceInstallation:i,disabled:n,deleteGithubTarget:r}=e,l=(null==a?void 0:a.id)===s.id;return(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(s7.eu,{className:"h-7 w-7 border",children:(0,t.jsx)(s7.BK,{src:s.account.avatar_url})}),(0,t.jsx)("span",{className:"font-medium",children:s.account.login})]}),(0,t.jsx)(eZ.d,{disabled:n,onCheckedChange:e=>{e?i(s):r(s)},checked:l})]})},as=e=>{let{setStep:s,installations:a,isTransferProjectLoading:i,canManageWorkspaceGit:n,onTransfer:r}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s9.Fh,{title:"Connect Project",description:"Connect your project to your GitHub organization in a 2-way sync."}),(0,t.jsx)(eU.w,{}),(0,t.jsxs)("div",{className:"flex max-h-[40vh] flex-col gap-3 overflow-y-auto px-6 py-6",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-muted-foreground",children:"GitHub Organizations"}),a.map(e=>(0,t.jsx)(aa,{installation:e,disabled:i||!n&&!!e.suspended_at,onTransfer:r,canManageWorkspaceGit:n,isLoading:i},e.account.login))]}),(0,t.jsx)(eU.w,{}),(0,t.jsx)(s9.p8,{children:(0,t.jsx)(L.$,{disabled:i,variant:"secondary",onClick:()=>s("organizations"),size:"sm",children:"Back"})})]})},aa=e=>{let{installation:s,disabled:a,onTransfer:i,canManageWorkspaceGit:r,isLoading:l}=e,[o,c]=(0,n.useState)(!1),d=l&&o;return(0,t.jsxs)("div",{className:"flex w-full items-center justify-start gap-2",children:[(0,t.jsx)(s7.eu,{className:"h-7 w-7 border",children:(0,t.jsx)(s7.BK,{src:s.account.avatar_url})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"truncate font-medium",children:s.account.login}),s.suspended_at&&(0,t.jsxs)(ei.m_,{children:[(0,t.jsx)(ei.k$,{asChild:!0,children:(0,t.jsx)("div",{className:"",children:(0,t.jsx)(ep.E,{className:"inline",variant:"destructive",children:"Suspended"})})}),(0,t.jsx)(ei.ZI,{children:r?(0,t.jsx)("p",{children:"This account is suspended. Reconnect to continue."}):(0,t.jsx)("p",{children:"This account is suspended. Talk to your workspace owner to reconnect."})})]})]}),(0,t.jsx)(L.$,{onClick:()=>{if(s.suspended_at)return void window.open(s.html_url,"_blank");i(s),c(!0)},disabled:a,className:"ml-auto",size:"sm",variant:s.suspended_at?"outline":"default",loading:d,children:s.suspended_at?"Reconnect":d?"Connecting":"Connect"})]},s.account.login)},at=e=>{let{isTransferProjectLoading:s,installations:a,canManageWorkspaceGit:i,onTransfer:r,showConnectDialog:l,setShowConnectDialog:o,workspace:c}=e,{installations:d}=sY(c.id),[u,m]=(0,n.useState)("organizations");return(0,t.jsxs)(D.lG,{open:l,onOpenChange:e=>{e||m("organizations"),o(e)},children:[(0,t.jsx)(D.zM,{asChild:!0,className:"hidden",children:(0,t.jsx)(L.$,{size:"sm",children:"Connect Project"})}),(0,t.jsx)(s9.Lg,{children:"organizations"===u?(0,t.jsx)(s8,{setStep:m,installations:null!=a?a:[],workspaceInstallations:null!=d?d:[],workspace:c}):(0,t.jsx)(as,{setStep:m,installations:null!=d?d:[],isTransferProjectLoading:s,canManageWorkspaceGit:i,onTransfer:r})})]})};var ai=a(39055);let an=e=>{let{isTransferProjectLoading:s,workspaceInstallations:a,onTransfer:i,canManageWorkspaceGit:r,setShowConnectDialog:l}=e,o=(0,sa.A)("md"),c=(0,e0.R)(),[d,u]=(0,n.useState)(!1),m=(null==a?void 0:a.length)===0,{disabled:p,disabledReason:x}=(0,n.useMemo)(()=>c?{disabled:!0,disabledReason:"Cannot transfer project while there is an active operation in progress."}:!r&&m?{disabled:!0,disabledReason:"Ask a workspace admin to add GitHub Organizations."}:{disabled:!1,disabledReason:null},[c,r,m]);return(0,t.jsxs)(eo.rI,{open:d,onOpenChange:e=>{m?l(!0):u(e)},children:[(0,t.jsx)(eY.Q,{showTooltip:p,tooltipContent:x,children:(0,t.jsx)(eo.ty,{asChild:!0,children:(0,t.jsx)(L.$,{disabled:p,className:"justify-start",size:"sm",loading:s,children:s?"Connecting":(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(O.gu,{name:"GitHub",className:"h-4 w-4"}),"Connect Project"]})})})}),(0,t.jsxs)(eo.SQ,{className:"min-w-[200px]",align:o?"start":"end",children:[(0,t.jsx)(eo.lp,{className:"text-xs font-medium text-muted-foreground",children:"GitHub Organizations"}),null==a?void 0:a.map(e=>(0,t.jsx)(ar,{installation:e,disabled:s||!r&&!!e.suspended_at,onTransfer:i,canManageWorkspaceGit:r},e.account.login)),(0,t.jsx)(eY.Q,{showTooltip:!r,tooltipContent:"Only workspace admins can add organizations.",side:"left",instant:!0,children:(0,t.jsxs)(eo._2,{disabled:!r,onClick:()=>l(!0),children:[(0,t.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded-full border bg-background",children:(0,t.jsx)(F.A,{name:"plus_small",size:"small"})}),m?"Add Organization":"Manage Organizations",(0,t.jsx)(ai.x,{badge:"admin",className:"flex md:hidden"})]})})]})]})},ar=e=>{let{installation:s,disabled:a,onTransfer:i,canManageWorkspaceGit:n}=e;return(0,t.jsx)(eY.Q,{showTooltip:!!s.suspended_at,tooltipContent:n?"This account is suspended. Click to reconnect.":"This account is suspended. Talk to your workspace owner to reconnect.",side:"left",children:(0,t.jsxs)(eo._2,{className:"flex w-full items-center justify-start gap-2",onClick:()=>{if(s.suspended_at)return void window.open(s.html_url,"_blank");i(s)},disabled:a,children:[(0,t.jsx)(s7.eu,{className:"h-6 w-6 border",children:(0,t.jsx)(s7.BK,{src:s.account.avatar_url})}),(0,t.jsx)("p",{className:"truncate text-sm font-medium",children:s.account.login}),s.suspended_at&&(0,t.jsx)(ep.E,{className:"inline",variant:"destructive",children:"Suspended"})]},s.account.login)})};var al=a(6279);let ao=e=>{var s;let{canManageWorkspaceGit:a,workspace:i,showConnectDialog:r,setShowConnectDialog:l}=e,[o,c]=(0,n.useState)(!1),[d,u]=(0,n.useState)(null),{transferProject:m,isTransferProjectLoading:p}=(e=>{let s=(0,al.B)(),{mutate:a,isPending:i}=(0,C.n)({mutationFn:async e=>{let a={new_owner:{id:e.account.id,name:e.account.login,type:e.target_type}},t=(0,v.P)();return await t.post("/projects/".concat(s,"/github/transfer"),a)},onSuccess:async(s,a)=>{j.toast.success("A GitHub Repository is now under your account ".concat(a.account.login),{description:s.new_repo_url,action:(0,t.jsx)(L.$,{size:"sm",asChild:!0,children:(0,t.jsx)("a",{target:"_blank",href:s.new_repo_url,children:"View"})}),duration:2e4}),null==e||e()},onError:e=>{(0,_.Ni)(e)}});return{transferProject:a,isTransferProjectLoading:i}})(()=>{l(!1)}),x=e=>{u(e),c(!0)},{installations:h}=(0,sV.O)({enabled:null!=a&&a}),{installations:g}=sY(i.id);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(an,{isTransferProjectLoading:p,workspaceInstallations:null!=g?g:[],onTransfer:x,canManageWorkspaceGit:a,setShowConnectDialog:l}),(0,t.jsx)(at,{installations:h,isTransferProjectLoading:p,canManageWorkspaceGit:a,onTransfer:x,setShowConnectDialog:l,showConnectDialog:r,workspace:i}),(0,t.jsx)(D.lG,{open:o,onOpenChange:c,children:(0,t.jsxs)(D.Cf,{size:"lg",className:"max-w-md",children:[(0,t.jsxs)(D.c7,{children:[(0,t.jsx)(D.L3,{children:"Confirm transfer to set up 2-way sync"}),(0,t.jsxs)(D.rr,{children:["You're moving the only instance of this project to your GitHub organization",(null==d||null==(s=d.account)?void 0:s.login)?(0,t.jsxs)("span",{className:"font-medium",children:[" (",d.account.login,")"]}):"",". This means the project will now live in your GitHub, and must remain there to keep syncing with Lovable.",(0,t.jsx)("br",{}),"You can continue editing your project in Lovable as long as access to the GitHub repository remains.",(0,t.jsx)("br",{}),(0,t.jsx)("br",{}),"You can later disconnect the project from GitHub within Lovable in the project settings."]})]}),(0,t.jsxs)(D.Es,{children:[(0,t.jsx)(L.$,{variant:"outline",onClick:()=>{c(!1),u(null)},disabled:p,children:"Cancel"}),(0,t.jsx)(L.$,{variant:"destructive",onClick:()=>{d&&m(d,{onSuccess:()=>{c(!1),u(null)}})},loading:p,children:"Transfer anyway"})]})]})})]})};var ac=a(26119);let ad=e=>{let{projectId:s,disabled:a}=e,[i,r]=(0,n.useState)(!1),l=()=>r(!1),o=(0,ac.h)(),c=async()=>{try{await o.mutateAsync(s),j.toast.success("GitHub disconnected",{description:"Your project has been disconnected from GitHub successfully."}),l()}catch(e){j.toast.error("Failed to disconnect GitHub",{description:"An error occurred while disconnecting GitHub. Please try again."})}};return(0,t.jsxs)(D.lG,{open:i,onOpenChange:r,children:[(0,t.jsx)(D.zM,{asChild:!0,children:(0,t.jsx)(L.$,{variant:"outline",size:"sm",disabled:a,children:"Disconnect"})}),(0,t.jsxs)(D.Cf,{size:"sm",children:[(0,t.jsxs)(D.c7,{children:[(0,t.jsx)(D.L3,{children:"Disconnect GitHub"}),(0,t.jsx)(D.rr,{children:"This stops syncing with GitHub but won't delete your repository."})]}),(0,t.jsxs)("div",{className:"space-y-3 text-sm text-muted-foreground",children:[(0,t.jsx)("p",{className:"font-medium text-foreground",children:"What happens when you disconnect:"}),(0,t.jsxs)("ul",{className:"list-disc space-y-1 pl-5",children:[(0,t.jsx)("li",{children:"The bidirectional sync between Lovable and GitHub stops"}),(0,t.jsx)("li",{children:"Your GitHub repository remains intact with all its history and files"}),(0,t.jsx)("li",{children:"Your code is stored exclusively within Lovable"})]}),(0,t.jsx)("p",{className:"font-medium text-foreground",children:"If you reconnect later:"}),(0,t.jsxs)("ul",{className:"list-disc space-y-1 pl-5",children:[(0,t.jsx)("li",{children:"A new GitHub repository is created with your latest code"}),(0,t.jsx)("li",{children:"Your original repository remains on GitHub but isn't linked to Lovable"})]})]}),(0,t.jsxs)(D.Es,{children:[(0,t.jsx)(L.$,{variant:"outline",onClick:l,children:"Cancel"}),(0,t.jsx)(L.$,{variant:"destructive",onClick:c,loading:o.isPending,children:"Disconnect"})]})]})]})};var au=a(76279);let am=e=>{let{githubRepoName:s,workspace:a,canManageWorkspaceGit:i,showConnectDialog:n,setShowConnectDialog:r,projectId:l}=e;return s?(0,t.jsx)(eE.m,{label:"Project",description:"Connect your project to your GitHub organization in a 2-way sync.",justify:"end",customBadge:(0,t.jsx)(au.Q,{status:"connected"}),children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(L.$,{asChild:!0,variant:"outline",size:"sm",children:(0,t.jsxs)(x(),{href:"https://github.com/".concat(s),target:"_blank",rel:"noopener noreferrer",children:["View on GitHub",(0,t.jsx)(F.A,{size:"small",name:"arrow_up_right",className:"ml-auto"})]})}),i&&(0,t.jsx)(ad,{projectId:l})]})}):(0,t.jsx)(eE.m,{label:"Connect Project",description:"Connect your project to your GitHub organization in a 2-way sync.",justify:"end",customBadge:(0,t.jsx)(au.Q,{status:"not-connected"}),children:(0,t.jsx)(ao,{canManageWorkspaceGit:i,workspace:a,showConnectDialog:n,setShowConnectDialog:r})})},ap=e=>{let{workspace:s,isInsideEditor:a}=e,{permitted:i}=(0,o.J)(ev.eZ.ManageWorkspaceGit),[r,l]=(0,n.useState)(!1);return(0,t.jsxs)(ee.Pt,{value:"github",title:"GitHub",description:"Sync your project 2-way with GitHub to collaborate at source.",docsLink:"https://docs.lovable.dev/integrations/git-integration",children:[a&&(0,t.jsx)(ah,{workspace:s,showConnectDialog:r,setShowConnectDialog:l,canManageWorkspaceGit:i}),(0,t.jsx)(ax,{setShowConnectDialog:l,isInsideEditor:a,canManageWorkspaceGit:i})]})},ax=e=>{var s,a;let{setShowConnectDialog:i,isInsideEditor:n,canManageWorkspaceGit:r}=e,{hasValidAccessToken:l,isLoading:o}=(0,sV.O)({enabled:null!=r&&r}),{userData:c}=(0,d.ur)();return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(sQ,{isLoading:o||!c,hasAccessToken:!!(null==c||null==(s=c.github)?void 0:s.new_encrypted_access_token),githubUsername:null==c||null==(a=c.github)?void 0:a.username,hasValidAccessToken:null!=l&&l,onGithubConnected:()=>{n&&i(!0)},canManageWorkspaceGit:r})})};function ah(e){var s,a,i,n;let{workspace:r,showConnectDialog:l,setShowConnectDialog:o,canManageWorkspaceGit:c}=e,u=(0,eA.Iw)(e=>e.project),{installations:m}=sY(r.id),{userData:p}=(0,d.ur)(),x=null==(s=(0,sm.l)().features)?void 0:s.git_branch_switching;if(!u)return null;let h=(0,sK.oX)(u),j=(null==p||null==(a=p.github)?void 0:a.new_encrypted_access_token)!==null&&(null==p||null==(i=p.github)?void 0:i.new_encrypted_access_token)!==void 0;return(0,t.jsxs)(t.Fragment,{children:[(j||m&&(null==m?void 0:m.length)>0)&&(0,t.jsx)(am,{workspace:r,canManageWorkspaceGit:c,githubRepoName:h&&(null==u?void 0:u.github_repo_name)&&(null==(n=u.github_owner)?void 0:n.name)?"".concat(u.github_owner.name,"/").concat(u.github_repo_name):void 0,showConnectDialog:l,setShowConnectDialog:o,projectId:u.id}),h&&(0,t.jsx)(s6,{project:u}),h&&x&&(0,t.jsx)(s1,{mainBranch:u.main_branch||"main",projectId:u.id})]})}var aj=a(21572),ag=a(49352),af=a(84068),av=a(82782);let ay=aj.Ay.string().min(1,"Server name is required").max(255,"Server name must be less than 255 characters").regex(/^[a-zA-Z0-9_.,;: -]+$/,{message:"Server name can only contain letters, numbers, spaces, and punctuation."}),ab=e=>{let{workspace:s,open:a,onOpenChange:i,title:r,description:l,urlPlaceholder:o,connectorId:c=af.S,displayName:d}=e,{setSubTab:u}=(0,av.l)(),[m,p]=(0,n.useState)(""),[x,h]=(0,n.useState)(""),[g,f]=(0,n.useState)(""),[y,b]=(0,n.useState)(!1),[N,w]=(0,n.useState)(""),k=(0,ed.jE)(),_=c!==af.S,S=_?g.trim():m.trim()&&g.trim(),{handleConnect:E}=(0,ag.jj)(s.id,{testConnection:!0}),P=(0,C.n)({mutationFn:async()=>{let e=(0,v.P)();return N.trim()?void await e.post("/workspaces/".concat(s.id,"/integrations/mcp"),{name:_?d:m,url:g,token:N,connector_id:c}):await E({serverUrl:g,connectorId:c,displayName:_?d:m})},onSuccess:async e=>{await Promise.all([k.invalidateQueries({queryKey:["integrations","mcp","connectors",s.id]}),k.invalidateQueries({queryKey:eW.workspaceKeys.connections(s.id)}),k.invalidateQueries({queryKey:[...eW.workspaceKeys.detail(s.id),"integrations"]})]),j.toast.success("MCP server added successfully"),(null==e?void 0:e.integrationId)&&u("mcp-server",_?c:e.integrationId),i(!1),p(""),f(""),w(""),b(!1)},onError:e=>{var s,a;let t=(null==(a=e.response)||null==(s=a.data)?void 0:s.error)||e.message||"Failed to add MCP server";j.toast.error(t)}}),I=()=>{i(!1),P.reset(),setTimeout(()=>{p(""),f(""),w(""),b(!1),h("")},200)};return(0,t.jsx)(D.lG,{open:a,onOpenChange:I,children:(0,t.jsx)(D.Cf,{className:"sm:max-w-[525px]",children:(0,t.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),_){if(!g.trim())return void j.toast.error("Please enter a server URL")}else{if(!m.trim()||!g.trim())return void j.toast.error("Please fill in all fields");let e=ay.safeParse(m);if(!e.success)return void h(e.error.errors[0].message);h("")}P.mutate()},children:[(0,t.jsxs)(D.c7,{children:[(0,t.jsx)(D.L3,{children:r||"Add MCP Server"}),(0,t.jsx)(D.rr,{children:l||"Connect to a remote MCP server to extend Lovable Agent's capabilities."})]}),(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[!_&&(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(V.Label,{htmlFor:"display_name",children:"Server Name"}),(0,t.jsx)(T.p,{id:"display_name",placeholder:"My MCP Server",value:m,onChange:e=>p(e.target.value),required:!0,type:"text"}),x&&(0,t.jsx)("div",{className:"text-xs text-destructive-primary",children:x})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(V.Label,{htmlFor:"url",children:"Server URL"}),(0,t.jsx)(T.p,{id:"url",type:"url",name:"mcp-server-url",placeholder:o||"https://mcp.example.com",value:g,onChange:e=>f(e.target.value),required:!0,"data-1p-ignore":!0})]}),!_&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(L.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>b(!y),className:"flex items-center gap-1 text-sm text-muted-foreground hover:text-foreground",children:[(0,t.jsx)(F.A,{name:y?"chevron_up":"chevron_down",className:"h-4 w-4"}),"Advanced Settings"]}),y&&(0,t.jsx)("div",{className:"grid gap-2 pl-6",children:(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(V.Label,{htmlFor:"manual-token",children:"Bearer Token (Optional)"}),(0,t.jsx)(T.p,{id:"manual-token",name:"manual-token",type:"password",placeholder:"Enter Bearer token or API key",value:N,onChange:e=>w(e.target.value),autoComplete:"new-password","data-1p-ignore":!0}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Some MCP servers use API keys as Bearer tokens instead of OAuth. If your server requires a token, enter it here."})]})})]})]}),(0,t.jsxs)(D.Es,{children:[(0,t.jsx)(L.$,{type:"button",variant:"outline",onClick:I,children:"Cancel"}),(0,t.jsx)(L.$,{type:"submit",loading:P.isPending,disabled:!S,children:P.isPending?"Adding...":"Add Server"})]})]})})})};var aN=a(12138);let aw=[{id:"lovable-cloud",alias:"supabase",displayName:"Lovable Cloud",shortDescription:"Launch your full-stack app instantly",description:"Create and connect a Cloud project to add backend features (database, auth, storage).",icon:"cloud",creator:{name:"Lovable",url:"https://lovable.dev"},documentation_url:"https://docs.lovable.dev/features/cloud",tools:[{name:"enable",displayName:"Cloud",description:"Enable to use Cloud features.",defaultPreference:"ask",isPrimary:!0},{name:"read-query",displayName:"Read database",description:"Allow Lovable to read your database.",defaultPreference:"never_ask"},{name:"analytics-query",displayName:"Read analytics",description:"Query logs to investigate issues and behavior.",defaultPreference:"never_ask"},{name:"linter",displayName:"Run security checks",description:"Run automated security checks on your database. Not a full audit.",defaultPreference:"never_ask"},{name:"migration",displayName:"Modify database",description:"Make schema and policy changes via SQL migrations. Updates generated types.",defaultPreference:"ask"},{name:"insert",displayName:"Add data",description:"Add data to your database tables.",defaultPreference:"ask"},{name:"project-info",displayName:"Read project info",description:"Read project configuration and environment details.",defaultPreference:"never_ask"},{name:"configure-auth",displayName:"Configure auth",description:"Allow Lovable to configure authentication settings (e.g., signup policies).",defaultPreference:"never_ask"},{name:"edge-function-logs",displayName:"Read backend logs",description:"Read logs from backend services.",defaultPreference:"never_ask"}]},{id:"supabase",displayName:"Supabase",shortDescription:"Launch your full-stack app instantly",description:"Create and connect a supabase project to add backend features (database, auth, storage).",logo:"Supabase",creator:{name:"Lovable",url:"https://lovable.dev"},documentation_url:"https://docs.lovable.dev/integrations/supabase",tools:[]},{id:"ai_gateway",displayName:"Lovable AI",shortDescription:"Unlock powerful AI features",description:"Enable to use AI models without needing to provide an API key and centralized billing.",icon:"ai",creator:{name:"Lovable",url:"https://lovable.dev"},documentation_url:"https://docs.lovable.dev/features/ai",tools:[{name:"enable_ai_gateway",displayName:"AI",description:"Enable to use Lovable AI features.",defaultPreference:"never_ask",isPrimary:!0}]},{id:"shopify",displayName:"Shopify",shortDescription:"Build an eCommerce store",description:"Create a Shopify store to sell physical products online.",logo:"ShopifyLogomark",creator:{name:"Lovable",url:"https://lovable.dev"},documentation_url:"https://docs.lovable.dev/integrations/shopify",tools:[{name:"enable_shopify",displayName:"Shopify",description:"Enable to use Shopify features.",defaultPreference:"ask",isPrimary:!0},{name:"manually_set_shopify_credentials",displayName:"Connect your Shopify store",description:"Connect to an existing Shopify store using your Admin API credentials.",defaultPreference:"ask"},{name:"claim_shopify_store",displayName:"Claim your store",description:"Claim your development store and start the 30-day Shopify free trial.",defaultPreference:"ask"},{name:"create_shopify_product",displayName:"Create product",description:"Add new products to your Shopify store with variants and images.",defaultPreference:"ask"},{name:"update_shopify_product",displayName:"Update product",description:"Modify existing product details, options, or images in your store.",defaultPreference:"ask"},{name:"delete_shopify_product",displayName:"Delete product",description:"Remove a product from your Shopify store.",defaultPreference:"ask"},{name:"create_product_variant",displayName:"Add product variant",description:"Create new variants for products (e.g., sizes, colors).",defaultPreference:"ask"},{name:"update_product_variant",displayName:"Update product variant",description:"Modify variant details like price, SKU, sizes, or colors.",defaultPreference:"ask"},{name:"delete_product_variant",displayName:"Delete product variant",description:"Remove a variant from an existing product.",defaultPreference:"ask"},{name:"create_discount_code",displayName:"Create discount code",description:"Generate discount codes for your store.",defaultPreference:"ask"},{name:"update_discount_code",displayName:"Update discount code",description:"Modify existing discount codes.",defaultPreference:"ask"},{name:"delete_discount_code",displayName:"Delete discount code",description:"Remove a discount code from your store.",defaultPreference:"ask"},{name:"create_price_rule",displayName:"Create price rule",description:"Set up pricing rules for discounts and promotions.",defaultPreference:"ask"},{name:"update_price_rule",displayName:"Update price rule",description:"Modify existing price rules and discount settings.",defaultPreference:"ask"},{name:"delete_price_rule",displayName:"Delete price rule",description:"Remove a price rule from your store.",defaultPreference:"ask"}]},{id:"stripe",displayName:"Stripe",shortDescription:"Set up payments",description:"Set up payments to your store.",logo:"Stripe",creator:{name:"Lovable",url:"https://lovable.dev"},documentation_url:"https://docs.lovable.dev/integrations/stripe",tools:[{name:"enable_stripe",displayName:"Stripe",description:"Enable to use Stripe features.",defaultPreference:"ask",isPrimary:!0},{name:"search_stripe_documentation",displayName:"Search Stripe documentation",description:"Search the Stripe documentation for the given question and language.",defaultPreference:"ask"},{name:"get_stripe_account_info",displayName:"Get Stripe account information",description:"Get the account info for the logged in Stripe account.",defaultPreference:"ask"},{name:"create_customer",displayName:"Create customer",description:"Create a customer in Stripe.",defaultPreference:"ask"},{name:"list_customers",displayName:"List customers",description:"Fetch a list of Customers from Stripe.",defaultPreference:"ask"},{name:"create_product",displayName:"Create product",description:"Create a product in Stripe.",defaultPreference:"ask"},{name:"list_products",displayName:"List products",description:"Fetch a list of Products from Stripe.",defaultPreference:"ask"},{name:"create_price",displayName:"Create price",description:"Create a price in Stripe. If a product has not already been specified, a product should be created first.",defaultPreference:"ask"},{name:"list_prices",displayName:"List prices",description:"Fetch a list of Prices from Stripe.",defaultPreference:"ask"},{name:"create_payment_link",displayName:"Create payment link",description:"Create a payment link in Stripe.",defaultPreference:"ask"},{name:"create_invoice",displayName:"Create invoice",description:"Create an invoice in Stripe.",defaultPreference:"ask"},{name:"list_invoices",displayName:"List invoices",description:"Fetch a list of Invoices from Stripe.",defaultPreference:"ask"},{name:"create_invoice_item",displayName:"Create invoice item",description:"Create an invoice item in Stripe.",defaultPreference:"ask"},{name:"finalize_invoice",displayName:"Finalize invoice",description:"Finalize an invoice in Stripe.",defaultPreference:"ask"},{name:"retrieve_balance",displayName:"Retrieve balance",description:"Retrieve the balance from Stripe.",defaultPreference:"ask"},{name:"create_refund",displayName:"Create refund",description:"Refund a payment intent in Stripe.",defaultPreference:"ask"},{name:"list_payment_intents",displayName:"List payment intents",description:"List payment intents in Stripe.",defaultPreference:"ask"},{name:"list_subscriptions",displayName:"List subscriptions",description:"List all subscriptions in Stripe.",defaultPreference:"ask"},{name:"cancel_subscription",displayName:"Cancel subscription",description:"Cancel a subscription in Stripe.",defaultPreference:"ask"},{name:"update_subscription",displayName:"Update subscription",description:"Update a subscription in Stripe.",defaultPreference:"ask"},{name:"list_coupons",displayName:"List coupons",description:"List coupons in Stripe.",defaultPreference:"ask"},{name:"create_coupon",displayName:"Create coupon",description:"Create a coupon in Stripe.",defaultPreference:"ask"},{name:"update_dispute",displayName:"Update dispute",description:"Update a dispute in Stripe.",defaultPreference:"ask"},{name:"list_disputes",displayName:"List disputes",description:"List disputes in Stripe.",defaultPreference:"ask"},{name:"search_stripe_resources",displayName:"Search Stripe resources",description:"Search Stripe resources.",defaultPreference:"ask"},{name:"fetch_stripe_resources",displayName:"Fetch Stripe resources",description:"Fetch Stripe resources.",defaultPreference:"ask"}]}],ak=e=>{let{integrationName:s,toolName:a,toolDisplayName:i,toolDescription:r,defaultPreference:l,groupDisabled:o,disabledMessage:c,isPrimary:d}=e,{approvalPreference:u,isLoading:m,setApprovalPreference:p}=(0,aN.I)({tool:{name:a,integration:s,defaultPreference:l}}),x=(0,n.useCallback)(async e=>{p(e)},[p]);return(0,t.jsxs)("div",{className:(0,eI.cn)("flex items-center justify-between gap-4"),children:[i&&r&&(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col gap-0",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("h3",{className:(0,eI.cn)("text-sm font-medium",d&&"text-lg"),children:i})}),(0,t.jsx)("p",{className:(0,eI.cn)("text-xs leading-relaxed text-muted-foreground",d&&"text-sm"),children:r})]}),(0,t.jsx)("div",{children:(0,t.jsx)(eY.Q,{tooltipContent:c,showTooltip:!!c,children:(0,t.jsxs)(eD.l6,{value:u,onValueChange:x,disabled:m||o,children:[(0,t.jsx)(eD.bq,{className:(0,eI.cn)("w-[130px] justify-start bg-background",o&&"opacity-50"),children:(0,t.jsx)(eD.yv,{})}),(0,t.jsxs)(eD.gC,{align:"end",className:"w-48",children:[(0,t.jsx)(eD.eb,{value:"ask",children:"Ask each time"}),(0,t.jsx)(eD.eb,{value:"never_ask",children:"Always allow"}),(0,t.jsx)(eD.eb,{value:"disable",children:"Never allow"})]})]})})})]})},aC=()=>{let{activeIntegrationId:e}=(0,av.l)(),s=aw.find(s=>s.id===e),a=(null==s?void 0:s.alias)||(null==s?void 0:s.id),i=null==s?void 0:s.tools.find(e=>e.isPrimary),n=null==s?void 0:s.tools.filter(e=>!e.isPrimary),r="".concat(null==s?void 0:s.displayName," is disabled for this workspace by an admin. Contact your workspace admin to enable this feature."),{approvalPreference:l}=(0,aN.I)({tool:{integration:a,name:null==i?void 0:i.name}}),o="disable"===l;return s?(0,t.jsxs)("div",{className:"mx-auto min-w-[350px] space-y-8 md:min-w-[450px] lg:w-[600px]",children:[(0,t.jsx)("header",{className:"flex flex-col flex-wrap justify-between gap-4 sm:flex-nowrap md:flex-row md:items-center",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"h-12 w-12 rounded-md bg-moon-100 p-2 dark:bg-moon-50 dark:text-moon-900",children:[s.icon&&(0,t.jsx)(F.A,{name:s.icon,className:"h-full w-full"}),s.logo&&(0,t.jsx)(O.gu,{name:s.logo,className:"h-full w-full"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-lg font-medium",children:s.displayName}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:s.shortDescription})]})]})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h2",{className:"text-lg font-medium",children:"Overview"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:s.description})]}),(n&&n.length>0||i)&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"mb-4 flex items-end justify-between gap-2",children:(0,t.jsx)("h2",{className:"text-lg font-medium",children:"User preferences"})}),(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[i&&(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(ak,{integrationName:a,toolName:i.name,toolDisplayName:i.displayName,toolDescription:i.description,defaultPreference:i.defaultPreference,isPrimary:!0})}),null==n?void 0:n.map(e=>(0,t.jsx)("div",{className:"flex flex-col gap-2",children:(0,t.jsx)(ak,{integrationName:a,toolName:e.name,toolDisplayName:e.displayName,toolDescription:e.description,defaultPreference:e.defaultPreference,groupDisabled:o,disabledMessage:o?r:void 0})},e.name))]})]}),(0,t.jsxs)("footer",{className:"space-y-2",children:[(0,t.jsx)("h2",{className:"text-lg font-medium",children:"Details"}),(0,t.jsxs)("div",{className:"flex gap-8 text-sm",children:[(0,t.jsxs)("div",{className:"flex shrink-0 flex-col gap-0",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Created by"}),(0,t.jsxs)(x(),{href:s.creator.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 font-[500]",children:[s.creator.name,(0,t.jsx)(F.A,{name:"arrow_up_right",size:"small"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-0",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Docs"}),(0,t.jsxs)(x(),{href:s.documentation_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 break-all font-[500]",children:[s.documentation_url,(0,t.jsx)(F.A,{name:"arrow_up_right",size:"small"})]})]})]})]})]}):null};var a_=a(92034);let aS=()=>{let{project_id:e}=(0,i.useParams)(),{store:s}=(0,a_.O)(),[a,r]=(0,n.useState)(""),[l,o]=(0,n.useState)(!1),[c,d]=(0,n.useState)(!1),u=t=>{let i=t||a;if(!i.trim())return;o(!0);let n=i.trim().toLowerCase(),l=i.trim(),{projectWorkspaceId:c,currentWorkspaceId:d}=s.getState();h.Ay.capture("mcp_custom_integration_request",{integration_name:n,raw_input:l,project_id:e,workspace_id:c||d});try{let e=localStorage.getItem("mcp_custom_requests"),s=[...e?JSON.parse(e):[],l];localStorage.setItem("mcp_custom_requests",JSON.stringify(s))}catch(e){console.error("Failed to update localStorage",e)}r(""),o(!1),j.toast.success("Request submitted!",{description:"Thank you for your interest! We've recorded your request and will evaluate adding this integration."})};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"",children:[(0,t.jsx)("h3",{className:"mb-2 text-lg font-medium",children:"Missing an integration?"}),(0,t.jsx)("p",{className:"mb-4 text-sm text-muted-foreground",children:"Request new integrations or support the ones you care about."}),(0,t.jsx)(L.$,{variant:"secondary",onClick:()=>d(!0),className:"bg-muted text-sm text-secondary-foreground hover:bg-muted",children:"Request"})]}),(0,t.jsx)(D.lG,{open:c,onOpenChange:d,children:(0,t.jsxs)(D.Cf,{size:"sm",children:[(0,t.jsxs)(D.c7,{children:[(0,t.jsx)(D.L3,{children:"Request an integration"}),(0,t.jsx)(D.rr,{children:"Tell us what integration you'd like to see added to Lovable."})]}),(0,t.jsx)("div",{className:"py-4",children:(0,t.jsx)(T.p,{placeholder:"e.g. Slack, Stripe, Figma...",value:a,onChange:e=>r(e.target.value),onKeyDown:e=>{"Enter"===e.key&&a.trim()&&(u(a),d(!1),r(""))},disabled:l,autoFocus:!0})}),(0,t.jsxs)(D.Es,{children:[(0,t.jsx)(L.$,{variant:"outline",onClick:()=>{d(!1),r("")},children:"Cancel"}),(0,t.jsx)(L.$,{onClick:()=>{a.trim()&&(u(a),d(!1),r(""))},disabled:!a.trim()||l,children:"Submit"})]})]})})]})},aE=e=>{let{icon:s,title:a,description:i,onClick:n,badge:r,button:l,buttonText:o="Manage",className:c}=e;return(0,t.jsxs)("div",{className:(0,eI.cn)("flex items-center justify-between gap-4 rounded-lg bg-secondary p-4 transition-all duration-200 ease-in-out",c),onClick:n,role:"button",tabIndex:0,children:[(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 items-center gap-4",children:[s,(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"font-medium",children:a}),r]}),(0,t.jsx)("p",{className:"line-clamp-2 text-xs text-muted-foreground",children:i})]})]}),null!=l?l:(0,t.jsx)(L.$,{variant:"muted",size:"sm",onClick:e=>{e.stopPropagation(),n()},children:o})]})},aP=e=>{let{workspace:s}=e,{setSubTab:a}=(0,av.l)(),{approvalPreference:i}=(0,aN.I)({tool:{name:"enable_shopify",integration:"shopify",defaultPreference:"ask"}}),n=null==s?void 0:s.experimental_features,r=(null==n?void 0:n.shopify)===!1,l="disable"!==i&&!r;return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("header",{className:"flex items-center justify-between gap-2",children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Connectors"}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Connect with trusted platforms through Lovable-built partner integrations."})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[(0,t.jsx)(aE,{icon:(0,t.jsx)("div",{className:"rounded-md bg-moon-50 p-2 dark:text-moon-900",children:(0,t.jsx)(O.gu,{name:"Stripe",className:"h-4 w-4"})}),title:"Stripe",description:"Set up payments",onClick:()=>{a("connectors","stripe")}}),(0,t.jsx)(aE,{icon:(0,t.jsx)("div",{className:"rounded-md bg-moon-50 p-2 dark:text-moon-900",children:(0,t.jsx)(O.gu,{name:"ShopifyLogomark",className:"h-4 w-4"})}),title:"Shopify",description:"Build an eCommerce store",onClick:()=>{a("connectors","shopify")},buttonText:l?"Manage":"Set up",badge:l?null:(0,t.jsx)(ep.E,{variant:"outline",children:"Disabled"})})]})]})};var aI=a(64482),aA=a(8904);let aL=e=>{let{workspace:s}=e,{setSubTab:a}=(0,av.l)(),i=(0,aI.f)(),n=(0,eA.mb)(e=>e.project),r=s.experimental_features,{supabaseIntegrationData:l}=(0,aA.U)(null==n?void 0:n.id),o=!!(null==l?void 0:l.supabase_project_id)&&(null==l?void 0:l.is_managed_by_lovable),{approvalPreference:c}=(0,aN.I)({tool:{name:"enable",integration:"supabase"}}),d=(null==r?void 0:r.lovable_cloud)===!1,u="disable"!==c&&!d,{approvalPreference:m}=(0,aN.I)({tool:{name:"enable_ai_gateway",integration:"ai_gateway",defaultPreference:"never_ask"}}),p=(null==r?void 0:r.lovable_ai)===!1,x="disable"!==m&&!p;return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("header",{className:"flex items-center justify-between gap-2",children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Lovable managed"}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Start using built-in features the Lovable Agent can access instantly."})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[(0,t.jsx)(aE,{icon:(0,t.jsx)("div",{className:"rounded-md bg-moon-50 p-2 dark:text-moon-900",children:(0,t.jsx)(F.I,{name:"cloud"})}),title:"Lovable Cloud",description:"Launch your full-stack app instantly",onClick:()=>{a("connectors","lovable-cloud")},badge:o||i&&u?null:(0,t.jsx)(ep.E,{variant:"outline",children:"Disabled"}),buttonText:o||i&&u?"Manage":"Set up"}),(0,t.jsx)(aE,{icon:(0,t.jsx)("div",{className:"rounded-md bg-moon-50 p-2 dark:text-moon-900",children:(0,t.jsx)(F.I,{name:"ai"})}),title:"Lovable AI",description:"Unlock powerful AI features",onClick:()=>{a("connectors","ai_gateway")},badge:x?null:(0,t.jsx)(ep.E,{variant:"outline",children:"Disabled"}),buttonText:x?"Manage":"Set up"})]})]})};var aD=a(36062),az=a(66328);let aF=e=>{let{workspace:s}=e,a=(0,ed.jE)(),{connectors:i,refetch:r,isLoading:l}=(0,aD.X)({workspaceId:s.id,includeDisabled:!0}),[c,d]=n.useState(null),{permitted:u}=(0,o.J)(ev.eZ.ManageWorkspaceIntegrations),m=(0,C.n)({mutationFn:async e=>{let{connectorId:a,enable:t}=e;d(a);let i=(0,v.P)();await i.post("/workspaces/".concat(s.id,"/connectors/").concat(a,"/").concat(t?"enable":"disable"))},onSuccess:async(e,t)=>{let{enable:i}=t;j.toast.success("Connector ".concat(i?"enabled":"disabled"," successfully")),await new Promise(e=>setTimeout(e,300)),await Promise.all([a.invalidateQueries({queryKey:["integrations","mcp","connectors",s.id]}),a.invalidateQueries({queryKey:[...eW.workspaceKeys.detail(s.id),"integrations"]})]),await r(),d(null)},onError:e=>{j.toast.error(e instanceof Error?e.message:"Failed to update connector"),d(null)}}),p=(0,n.useMemo)(()=>[...i].sort((e,s)=>e.connector_id===af.S?1:s.connector_id===af.S?-1:e.display_name.localeCompare(s.display_name)),[i]);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-medium",children:"Configure MCP servers"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Control which MCP servers are visible and available to the users of your workspace."})]})}),u?(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"rounded-lg border",children:[(0,t.jsxs)("div",{className:"grid grid-cols-[1fr_180px] gap-4 border-b bg-muted/30 px-4 py-3 text-sm font-medium text-muted-foreground",children:[(0,t.jsx)("div",{children:"Apps"}),(0,t.jsx)("div",{children:"Workspace access"})]}),l?(0,t.jsx)(t.Fragment,{children:Array.from({length:5}).map((e,s)=>(0,t.jsxs)("div",{className:"grid grid-cols-[1fr_180px] items-center gap-4 border-b px-4 py-4 last:border-b-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(ez.E,{className:"h-10 w-10 rounded-lg"}),(0,t.jsx)(ez.E,{className:"h-5 w-32"})]}),(0,t.jsx)(ez.E,{className:"h-9 w-full"})]},s))}):p.map(e=>(0,t.jsxs)("div",{className:"grid grid-cols-[1fr_180px] items-center gap-4 border-b px-4 py-4 last:border-b-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(az.G,{size:"md",connector:e}),(0,t.jsx)("div",{className:"min-w-0",children:(0,t.jsx)("p",{className:"font-medium",children:e.display_name})})]}),(0,t.jsx)("div",{children:(0,t.jsxs)(eD.l6,{value:e.is_enabled_for_workspace?"enabled":"disabled",onValueChange:s=>{m.mutate({connectorId:e.id,enable:"enabled"===s})},disabled:null!==c,children:[(0,t.jsx)(eD.wQ,{className:"h-9 w-full",children:(0,t.jsx)(eD.yv,{})}),(0,t.jsxs)(eD.gC,{children:[(0,t.jsx)(eD.eb,{value:"enabled",children:"Enabled"}),(0,t.jsx)(eD.eb,{value:"disabled",children:"Disabled"})]})]})})]},e.id))]})}):(0,t.jsxs)("div",{className:"rounded-lg border border-dashed p-12 text-center",children:[(0,t.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-muted",children:(0,t.jsx)(F.A,{name:"lock"})}),(0,t.jsx)("h3",{className:"mt-4 text-base font-medium",children:"Permission required"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"You don't have permission to manage MCP servers for this workspace."})]})]})};var aT=a(26214),aO=a(58914);let aM=()=>(0,t.jsxs)("div",{className:"mt-4 rounded-lg border border-dashed p-12 text-center",children:[(0,t.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-muted",children:(0,t.jsx)(F.I,{name:"info_circle"})}),(0,t.jsx)("h3",{className:"mt-4 text-base font-medium",children:"MCP servers are disabled for this workspace"}),(0,t.jsx)(e7.E,{permission:ev.eZ.EditWorkspaceSettings,plans:[sl.lV,so.VL.ENTERPRISE],fallback:(0,t.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Contact your workspace administrator to enable MCP servers."}),children:(0,t.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Enable MCP servers in Privacy & Security settings."})})]}),aR=e=>{var s;let{workspace:a,onOpenCustom:i}=e,n=(0,ed.jE)(),{activeIntegrationId:r,setSubTab:l}=(0,av.l)(),{handleConnect:o,isConnecting:c}=(0,ag.jj)(a.id),d=(0,aT.D)(),{connectorMap:u,isLoading:m,refetch:p}=(0,aD.X)({workspaceId:a.id}),h=u.get(r),g=(0,C.n)({...sc.y.deleteConnection({workspaceId:a.id}),onSuccess:()=>Promise.all([n.invalidateQueries({queryKey:["integrations","mcp","connectors",a.id]}),n.invalidateQueries({queryKey:eW.workspaceKeys.connections(a.id)}),n.invalidateQueries({queryKey:[...eW.workspaceKeys.detail(a.id),"integrations"]})]).then(()=>{j.toast.success("MCP server removed successfully"),(null==h?void 0:h.connector_id)===af.S&&l(null,null)}).catch(e=>{y.logging.warn("Failed to remove connection",{error:e})}),onError:()=>{j.toast.error("Failed to remove connection")}});if(m)return(0,t.jsx)("div",{className:"grid gap-4 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2",children:(0,t.jsx)(ez.E,{className:"h-[74px] rounded-lg"})});if(!(0,aO.i)(a))return(0,t.jsx)(aM,{});if(!h)return(0,t.jsx)("div",{children:"MCP not found"});let f=h.display_name;return(0,t.jsxs)("div",{className:"mx-auto space-y-8 lg:w-[600px]",children:[(0,t.jsxs)("header",{className:"flex flex-col flex-wrap justify-between gap-4 md:flex-row md:items-center",children:[(0,t.jsxs)("div",{className:"flex shrink-0 items-center gap-4",children:[(0,t.jsx)(az.G,{size:"lg",connector:h}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-lg font-medium",children:f}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:h.summary||"Custom MCP server"})]})]}),(0,t.jsx)("div",{children:h.is_connected?(0,t.jsx)(L.$,{variant:"destructive",size:"sm",onClick:()=>{d(E.qE.MCP.DISCONNECT_CLICKED,{connectorId:null==h?void 0:h.connector_id}),g.mutate(h.integration_id)},loading:g.isPending,disabled:g.isPending,children:"Disconnect"}):(0,t.jsx)(L.$,{variant:"default",size:"sm",loading:c,onClick:()=>{if(h&&h.launched){if(d(E.qE.MCP.CONNECT_CLICKED,{connectorId:h.connector_id}),h.requires_custom_url){let e=h.display_name||"Custom Server";i({title:"Connect ".concat(e),description:"Enter your ".concat(e," server details to connect."),urlPlaceholder:h.url_placeholder||"https://your-server.com",connectorId:h.connector_id,displayName:e});return}"server_url"in h&&o({serverUrl:h.server_url,connectorId:h.id}).then(async()=>{d(E.qE.MCP.CONNECT_SUCCESS,{connectorId:h.connector_id}),await p()}).catch(e=>{e instanceof ag.Fz?d(E.qE.MCP.CONNECT_FAILED,{connectorId:h.connector_id,error_category:e.category}):d(E.qE.MCP.CONNECT_FAILED,{connectorId:h.connector_id,error_category:"unknown"}),j.toast.error("Failed to connect to MCP server")})}},children:"Connect"})})]}),h.description&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h2",{className:"text-lg font-medium",children:"Overview"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:h.description})]}),h.tools&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h2",{className:"text-lg font-medium",children:"Tools"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:h.tools.map(e=>(0,t.jsx)(ep.E,{variant:"secondary",className:"text-xs text-muted-foreground",children:e.name},e.name))})]}),(null==(s=h.creator)?void 0:s.url)&&(0,t.jsxs)("footer",{className:"space-y-2",children:[(0,t.jsx)("h2",{className:"text-lg font-medium",children:"Details"}),(0,t.jsxs)("div",{className:"flex gap-8 text-sm",children:[(0,t.jsxs)("div",{className:"flex shrink-0 flex-col gap-0",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Created by"}),(0,t.jsxs)(x(),{href:h.creator.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 font-[500]",children:[h.creator.name,(0,t.jsx)(F.A,{name:"arrow_up_right",size:"small"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-0",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Docs"}),(0,t.jsxs)(x(),{href:h.documentation_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 font-[500]",children:[h.documentation_url,(0,t.jsx)(F.A,{name:"arrow_up_right",size:"small"})]})]})]})]}),h.connector_id===af.S&&(0,t.jsxs)("footer",{className:"space-y-2",children:[(0,t.jsx)("h2",{className:"text-lg font-medium",children:"Details"}),(0,t.jsx)("div",{className:"flex items-center gap-8 text-sm",children:(0,t.jsxs)("div",{className:"flex flex-col gap-0",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Custom URL"}),(0,t.jsxs)(x(),{href:h.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 break-all font-[500]",children:[h.url,(0,t.jsx)(F.A,{name:"arrow_up_right",size:"small"})]})]})})]})]})},aU=e=>{let{workspace:s}=e,[a,i]=(0,n.useState)(!1);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(aE,{icon:(0,t.jsx)("div",{className:"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-white",children:(0,t.jsx)(eb.default,{src:"/img/connectors/mcp.png",alt:"MCP",width:20,height:20,className:"object-contain"})}),title:"New MCP server",description:"Add custom MCP server",className:"opacity-70 hover:opacity-100 focus:opacity-100",onClick:()=>i(!0),button:(0,t.jsx)(L.$,{variant:"muted",size:"sm",onClick:()=>i(!0),className:"flex-shrink-0 rounded-md",children:"Add"})}),(0,t.jsx)(ab,{workspace:s,open:a,onOpenChange:i})]})},a$=e=>{let{connector:s}=e,{setSubTab:a}=(0,av.l)(),i=(0,aT.D)(),n=()=>{s.launched&&(i(E.qE.MCP.CARD_CONNECT_CLICKED,{connectorId:s.connector_id}),a("mcp-server",s.id))};return(0,t.jsx)(aE,{icon:(0,t.jsx)(az.G,{size:"md",connector:s,className:"bg-moon-50"}),title:s.display_name,description:s.summary,onClick:n,className:"opacity-70 hover:opacity-100 focus:opacity-100",button:(0,t.jsx)(L.$,{variant:"muted",size:"sm",onClick:n,disabled:!s.launched,className:(0,eI.cn)("flex-shrink-0 rounded-md",!s.launched&&"cursor-not-allowed"),children:s.launched?"Set up":"Soon"})})},aq=e=>{let{connector:s}=e,{setSubTab:a}=(0,av.l)(),i=(0,aT.D)(),n=s.display_name;return(0,t.jsx)(aE,{icon:(0,t.jsx)(az.G,{size:"md",connector:s,className:"bg-moon-50"}),title:n,description:s.summary||"Custom MCP server",onClick:()=>{s.launched&&(i(E.qE.MCP.CARD_MANAGE_CLICKED,{connectorId:s.connector_id}),a("mcp-server",s.id))},badge:(0,t.jsx)(ep.E,{variant:"success",children:"Enabled"})})},aB=e=>{let{workspace:s}=e,{connectorsByStatus:a,customEnabled:i,isLoading:n}=(0,aD.X)({workspaceId:s.id}),{connected:r,available:l}=a;return n?(0,t.jsx)("div",{className:"grid gap-4 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2",children:[...Array(6)].map((e,s)=>(0,t.jsx)(ez.E,{className:"h-[74px] rounded-lg"},s))}):0===l.length&&0===r.length?(0,t.jsx)("div",{children:"No MCP servers found"}):(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[r.map(e=>(0,t.jsx)(aq,{connector:e},e.id)),l.map(e=>(0,t.jsx)(a$,{connector:e},e.id)),i&&(0,t.jsx)(aU,{workspace:s})]})},aW=e=>{let{workspace:s}=e,a=(0,aO.i)(s),{setSubTab:i}=(0,av.l)();return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("header",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Your MCP servers"}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Bring in context and tools from your apps. Connections are personal and work across all workspace projects."," ",(0,t.jsx)("a",{href:"https://docs.lovable.dev/integrations/mcp-servers",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"Read MCP docs"})]})]}),a&&(0,t.jsx)(e7.E,{plans:[sl.lV,so.VL.ENTERPRISE],permission:ev.eZ.EditWorkspaceSettings,children:(0,t.jsx)("div",{className:"shrink-0",children:(0,t.jsxs)(L.$,{variant:"secondary",size:"sm",onClick:()=>i("manage-mcp-servers",null),children:[(0,t.jsx)(F.A,{name:"cog"}),"Manage servers"]})})})]}),(0,t.jsx)("div",{className:"mt-2",children:a?(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(aB,{workspace:s})}):(0,t.jsx)(aM,{})})]})},aG=e=>{let{workspace:s}=e,{subTab:a,setSubTab:i}=(0,av.l)(),{activeTab:r}=(0,c.t)(),[l,o]=(0,n.useState)(!1),[d,u]=(0,n.useState)(null);return(0,n.useEffect)(()=>{"integrations"===r&&i(null,null)},[r]),(0,t.jsxs)(ee.Pt,{value:"integrations",title:a?void 0:"Integrations",children:[a&&(0,t.jsx)("div",{className:"-ml-2",children:(0,t.jsxs)("button",{onClick:()=>i(null,null),className:"flex items-center gap-1 text-sm text-muted-foreground hover:text-foreground",children:[(0,t.jsx)(F.A,{name:"chevron_left"}),"Integrations"]})}),"mcp-server"===a?(0,t.jsx)(aR,{workspace:s,onOpenCustom:e=>{u(e),o(!0)}}):"manage-mcp-servers"===a?(0,t.jsx)(aF,{workspace:s}):"connectors"===a?(0,t.jsx)(aC,{}):null===a?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsx)(aL,{workspace:s}),(0,t.jsx)(aP,{workspace:s}),(0,t.jsx)(aW,{workspace:s}),(0,t.jsx)(aS,{})]})}):(0,t.jsx)(t.Fragment,{children:"404 not found"}),(0,t.jsx)(ab,{workspace:s,open:l,onOpenChange:o,title:null==d?void 0:d.title,description:null==d?void 0:d.description,urlPlaceholder:null==d?void 0:d.urlPlaceholder,connectorId:null==d?void 0:d.connectorId,displayName:null==d?void 0:d.displayName})]})},aK=e=>{let{project:s}=e,[a,i]=(0,n.useState)([]),[r,l]=(0,n.useState)(!1),o=(0,e0.R)(),[c,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)(null),[p,x]=(0,n.useState)({}),[h,g]=(0,n.useState)(""),[f,y]=(0,n.useState)(""),b=(0,n.useCallback)(async()=>{if(null==s?void 0:s.id){l(!0);try{let e=(0,v.P)(),a=(await e.get("/projects/".concat(s.id,"/integrations/memory"))||[]).sort((e,s)=>new Date(s.updated_at).getTime()-new Date(e.updated_at).getTime());i(a)}catch(e){console.error("Failed to load memories:",e),j.toast.error("Failed to load memories")}finally{l(!1)}}},[null==s?void 0:s.id]);(0,n.useEffect)(()=>{(null==s?void 0:s.id)&&b()},[null==s?void 0:s.id,b]);let N=async e=>{if(null==s?void 0:s.id)try{let a=(0,v.P)();await a.post("/projects/".concat(s.id,"/integrations/memory"),e);let t=e.sort((e,s)=>new Date(s.updated_at).getTime()-new Date(e.updated_at).getTime());i(t),j.toast.success("Memories updated successfully")}catch(e){throw console.error("Failed to save memories:",e),j.toast.error("Failed to save memories"),e}},w=async()=>{if(!h||!f)return void j.toast.error("Path and content are required");if(a.some(e=>e.path===h))return void j.toast.error("A memory with this path already exists");let e={path:h,content:f,updated_at:new Date().toISOString()};try{await N([...a,e]),g(""),y("")}catch(e){}},k=e=>{x({[e.path]:{path:e.path,content:e.content,originalPath:e.path,originalContent:e.content}})},C=async e=>{let s=p[e];if(s){if(s.path!==e&&a.some(e=>e.path===s.path))return void j.toast.error("A memory with this path already exists");try{let t=a.map(a=>a.path===e?{path:s.path,content:s.content,updated_at:new Date().toISOString()}:a);await N(t);let i={...p};delete i[e],x(i)}catch(e){}}},_=async()=>{if(u)try{let e=a.filter(e=>e.path!==u);await N(e),m(null),d(!1)}catch(e){}};return(0,t.jsx)(ei.Bc,{children:(0,t.jsx)(ee.Pt,{value:"memory",title:"Memory",description:"Manage memory files that help Lovable remember important context about your project.",children:(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsxs)("div",{className:"flex w-full flex-col gap-0",children:[(0,t.jsx)(T.p,{placeholder:"Untitled Memory",value:h,onChange:e=>g(e.target.value),disabled:o,className:"h-10 rounded-b-none border-border font-medium placeholder:text-foreground/50 focus-visible:ring-0 focus-visible:ring-offset-0"}),(0,t.jsx)(eP.T,{placeholder:"Remember that...",className:"min-h-40 resize-none rounded-b-lg rounded-t-none border border-t-0 border-border bg-background p-3 font-mono text-[13px] placeholder:text-foreground/50 focus-visible:ring-0 focus-visible:ring-offset-0",value:f,onChange:e=>y(e.target.value),disabled:o})]}),(0,t.jsxs)(ei.m_,{children:[(0,t.jsx)(ei.k$,{asChild:!0,children:(0,t.jsx)("span",{className:"cursor-not-allowed",children:(0,t.jsx)(L.$,{size:"icon-sm",variant:"ghost",disabled:o||!h||!f,onClick:w,children:(0,t.jsx)(F.A,{name:"plus",size:"default"})})})}),(0,t.jsx)(ei.ZI,{children:o?"Wait for Lovable to finish working":"Add a title and content to save the memory"})]})]}),r?(0,t.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,t.jsx)(F.A,{name:"progress_activity",className:"h-6 w-6 animate-spin"}),(0,t.jsx)("span",{className:"ml-2",children:"Loading memories..."})]}):(0,t.jsx)(t.Fragment,{children:a.map(e=>{var s,a;let i=p[e.path],n=null!=(s=null==i?void 0:i.path)?s:e.path,r=null!=(a=null==i?void 0:i.content)?a:e.content;return(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsxs)("div",{className:"flex w-full flex-col gap-0",children:[(0,t.jsx)(T.p,{value:n,onChange:i?s=>x({...p,[e.path]:{...p[e.path],path:s.target.value}}):void 0,className:"h-10 rounded-b-none border-border font-medium placeholder:text-foreground/50 focus-visible:ring-0 focus-visible:ring-offset-0 ".concat(i?"":"cursor-text"),disabled:o,readOnly:!i,onClick:()=>!o&&!i&&k(e)}),(0,t.jsx)(eP.T,{value:r,onChange:i?s=>x({...p,[e.path]:{...p[e.path],content:s.target.value}}):void 0,className:"min-h-40 resize-none rounded-b-lg rounded-t-none border border-t-0 border-border bg-background p-3 font-mono text-[13px] placeholder:text-foreground/50 focus-visible:ring-0 focus-visible:ring-offset-0 ".concat(i?"":"cursor-text"),disabled:o,readOnly:!i,onClick:()=>!o&&!i&&k(e)})]}),i&&(e=>{let s=p[e];return!!s&&(s.path!==s.originalPath||s.content!==s.originalContent)})(e.path)?(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsxs)(ei.m_,{children:[(0,t.jsx)(ei.k$,{asChild:!0,children:(0,t.jsx)(L.$,{variant:"ghost",size:"icon-sm",onClick:()=>C(e.path),disabled:o,children:(0,t.jsx)(F.A,{name:"check",size:"default"})})}),(0,t.jsx)(ei.ZI,{children:o?"Wait for Lovable to finish working":"Save changes"})]}),(0,t.jsxs)(ei.m_,{children:[(0,t.jsx)(ei.k$,{asChild:!0,children:(0,t.jsx)(L.$,{variant:"ghost",size:"icon-sm",onClick:()=>(e=>{let s={...p};delete s[e],x(s)})(e.path),disabled:o,children:(0,t.jsx)(F.A,{name:"x",size:"default"})})}),(0,t.jsx)(ei.ZI,{children:o?"Wait for Lovable to finish working":"Discard changes"})]})]}):(0,t.jsxs)(ei.m_,{children:[(0,t.jsx)(ei.k$,{asChild:!0,children:(0,t.jsx)(L.$,{variant:"ghost",size:"icon-sm",onClick:()=>{m(e.path),d(!0)},disabled:o,children:(0,t.jsx)(F.A,{name:"trash",size:"default"})})}),(0,t.jsx)(ei.ZI,{children:o?"Can't delete memories while Lovable is working":"Delete memory"})]})]},e.path)})}),(0,t.jsx)(D.lG,{open:c,onOpenChange:d,children:(0,t.jsxs)(D.Cf,{children:[(0,t.jsxs)(D.c7,{children:[(0,t.jsx)(D.L3,{children:"Delete Memory"}),(0,t.jsxs)(D.rr,{children:['Are you sure you want to delete "',u,'"? This action cannot be undone.']})]}),(0,t.jsxs)(D.Es,{children:[(0,t.jsx)(L.$,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),(0,t.jsx)(L.$,{variant:"destructive",onClick:_,children:"Delete"})]})]})})]})})})};var aV=a(54437),aY=a(77214);let aZ=e=>{let{isConnectedToSupabase:s}=e,[a,i]=(0,aY.V)("supabase-explainer",{defaultValue:!0}),[r,l]=(0,n.useState)(!1);return s||!a?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"rounded-md border border-border/50 bg-muted/20 p-4",children:(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex w-full items-center gap-2",children:[(0,t.jsx)(F.A,{name:"info_circle",size:"small",className:"text-muted-foreground"}),(0,t.jsx)("h3",{className:"text-sm font-medium",children:"What is Supabase?"}),(0,t.jsx)(L.$,{variant:"ghost",className:"ml-auto hover:bg-transparent",size:"icon-sm",onClick:()=>i(!1),children:(0,t.jsx)(F.A,{name:"x",size:"small",className:"text-muted-foreground"})})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Supabase is a complete platform for building apps with user authentication, data storage, and other backend capabilities. Connecting it to your Lovable project will enable you to build more advanced apps and support things such as AI features and payments."}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-3 pt-2",children:[(0,t.jsxs)("a",{href:"https://docs.lovable.dev/integrations/supabase",target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1.5 rounded-md bg-primary/10 px-3 py-1.5 text-sm font-medium text-primary transition-colors hover:bg-primary/20",children:[(0,t.jsx)(F.A,{name:"menu_book",size:"small"}),"See docs"]}),(0,t.jsxs)("button",{onClick:()=>l(!0),className:"inline-flex items-center gap-1.5 rounded-md bg-primary/10 px-3 py-1.5 text-sm font-medium text-primary transition-colors hover:bg-primary/20",children:[(0,t.jsx)(F.A,{name:"play",size:"small"}),"Watch tutorial"]})]})]})}),(0,t.jsx)(D.lG,{open:r,onOpenChange:l,children:(0,t.jsx)(D.Cf,{className:"max-w-4xl p-0",children:(0,t.jsx)("div",{className:"aspect-video w-full",children:(0,t.jsx)("iframe",{src:"https://www.youtube.com/embed/eVHg4wipRrU",title:"Supabase Tutorial",className:"h-full w-full rounded-lg",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})})})]})};var aQ=a(52426),aH=a(57180);let aJ=e=>{let{projectId:s}=e,a=(0,aQ.wV)(e=>e.isSendChatMessageMutationPending);return(0,t.jsx)(eE.m,{label:"Disconnect Project",description:"Remove the Supabase project from this Lovable project.",justify:"end",children:(0,t.jsx)(aH.s,{projectId:s,disabled:a})})};var aX=a(28545);let a0=e=>{var s,a;let{workspace:i,canManageWorkspaceIntegrations:n,setShowConnectDialog:r}=e,l=(0,eA.Iw)(e=>e.project),o=null==l?void 0:l.supabase_project_config,c=!!(null==l?void 0:l.is_supabase_enabled),d=(0,aV.G)({workspaceId:i.id}),u=null==o?void 0:o.supabase_project_id,m=null==l?void 0:l.id,p=(0,C.n)({mutationFn:()=>(0,v.P)().post("/projects/".concat(m,"/supabase/disconnect")),onSuccess:()=>{(0,j.toast)("Supabase disconnected",{description:"You can connect to a new Supabase project later."})},onError:e=>{j.toast.error("Error",{description:e.message})}}),x=null==(s=d.supabaseOrganizations)?void 0:s.find(e=>e.id===(null==o?void 0:o.supabase_organization_id));if(!l)return null;if(c)return(0,t.jsx)("div",{className:"text-sm",children:"Unfortunately, your project is not able to use Supabase."});let h=d.noOrganizations;return d.isLoading?(0,t.jsx)(sX.I,{text:"Loading Supabase..."}):(0,t.jsxs)(t.Fragment,{children:[!x&&!!(null==o?void 0:o.supabase_organization_id)&&(0,t.jsxs)(et.Fc,{variant:"destructive",children:[(0,t.jsx)(et.XL,{children:"Problem with your Supabase connection"}),(0,t.jsxs)(et.TN,{children:[(0,t.jsxs)("p",{children:["This project is connected to Supabase organization"," ",(0,t.jsx)("span",{className:"rounded-md bg-muted px-1 py-0.5 font-mono font-medium text-muted-foreground",children:null==o?void 0:o.supabase_organization_id}),", but this workspace is not connected to that organization. Disconnect the project or add the organization again."]}),(0,t.jsx)("div",{className:"mt-4 flex",children:(0,t.jsx)(L.$,{variant:"destructive",onClick:()=>p.mutate(),disabled:p.isPending,size:"sm",children:"Disconnect"})})]})]}),(0,t.jsx)(aZ,{isConnectedToSupabase:!d.noOrganizations}),!h&&(0,t.jsx)(aX.X,{workspaceId:i.id,supabaseOrganizations:null!=(a=d.supabaseOrganizations)?a:[],supabaseConfig:null!=o?o:null,setShowConnectDialog:r,canManageWorkspaceIntegrations:n}),u&&(0,t.jsx)(aJ,{projectId:null==l?void 0:l.id})]})};var a1=a(6579);let a2=e=>{var s;let{workspace:a,canManageWorkspaceIntegrations:i,setShowConnectDialog:n}=e,{isLoading:r,noOrganizations:l}=(0,aV.G)({workspaceId:a.id}),{handleConnect:o,isConnecting:c}=(0,a1.UO)(null!=(s=null==a?void 0:a.id)?s:"");return(0,t.jsx)(eE.m,{label:"Organizations",description:"Connected Supabase organizations will be accessible to all members in this workspace.",justify:"end",badges:["admin"],children:r?(0,t.jsx)(ez.E,{className:"h-7 w-40"}):l?(0,t.jsxs)(L.$,{disabled:c||!i,onClick:()=>o(),size:"sm",loading:c,children:[(0,t.jsx)(O.gu,{name:"Supabase",className:"h-4 w-4"}),"Connect Supabase"]}):(0,t.jsx)(L.$,{disabled:c||!i,onClick:()=>n(!0),size:"sm",variant:"outline",children:"Manage Connected Organizations"})})},a4=e=>{let{workspace:s,canManageWorkspaceIntegrations:a,isInsideEditor:i,showConnectDialog:n,setShowConnectDialog:r}=e;return(0,t.jsx)(a2,{workspace:s,canManageWorkspaceIntegrations:a,isInsideEditor:i,showConnectDialog:n,setShowConnectDialog:r})};var a5=a(98693),a3=a(74196);let a6=e=>{let{workspace:s,project:a,isInsideEditor:i}=e,{permitted:r}=(0,o.J)(ev.eZ.ManageWorkspaceIntegrations),[l,c]=(0,n.useState)(!1),d=(0,aI.H)(a),u=(0,n.useCallback)(()=>{i&&c(!0)},[i]);return(0,aV.f)({workspaceId:s.id,onConnectSuccess:u}),(0,t.jsx)(ee.Pt,{value:"supabase",title:"Supabase",description:"Integrate user authentication, data storage, and backend capabilities.",docsLink:"https://docs.lovable.dev/integrations/supabase",children:(0,t.jsxs)(t.Fragment,{children:[a&&!d&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(a0,{workspace:s,canManageWorkspaceIntegrations:r,setShowConnectDialog:c})}),a?(0,t.jsx)(a5.A,{workspace:s,showConnectDialog:l,setShowConnectDialog:c,showConnectStep:!d}):(0,t.jsx)(a3.J,{workspace:s,showConnectDialog:l,setShowConnectDialog:c,canManageWorkspaceIntegrations:r,showConnectStep:!1}),(0,t.jsx)(a4,{workspace:s,canManageWorkspaceIntegrations:r,isInsideEditor:i,showConnectDialog:l,setShowConnectDialog:c})]})})};var a9=a(3201),a7=a(73726),a8=a(41621);let te=e=>{let{workspace:s,domain:a,setDomain:i,verified:n,verificationError:r,isVerifying:l,onVerify:o,onCancel:c,onContinue:d}=e;return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(V.Label,{htmlFor:"domain",children:"Domain"}),(0,t.jsx)(T.p,{id:"domain",value:a,onChange:e=>i(e.target.value),placeholder:"yourdomain.com",disabled:n,className:"mt-1"})]}),!n&&(0,t.jsxs)(es.Zp,{className:"gap-4",children:[(0,t.jsxs)(es.aR,{children:[(0,t.jsxs)(es.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(F.A,{name:"info",size:"small"})," Domain Verification Required"]}),(0,t.jsx)(es.BT,{children:"To verify your domain, add the following TXT record to your DNS provider:"})]}),(0,t.jsxs)(es.Wu,{children:[(0,t.jsxs)("div",{className:"mt-2 flex gap-2 rounded bg-muted p-2 font-mono text-sm text-foreground",children:[(0,t.jsx)("div",{children:"TXT"}),(0,t.jsx)("div",{children:"@"}),(0,t.jsxs)("div",{className:"break-all",children:["lovable_verification=",s.id]})]}),(0,t.jsx)("p",{className:"mt-2 text-xs",children:"DNS changes may take a few minutes to propagate."})]})]}),r&&(0,t.jsxs)(et.Fc,{variant:"warning",children:[(0,t.jsx)(F.A,{name:"info",size:"small"}),(0,t.jsx)(et.XL,{children:"Verification Failed"}),(0,t.jsx)(et.TN,{children:r})]}),n&&(0,t.jsxs)(et.Fc,{variant:"success",children:[(0,t.jsx)(F.A,{name:"check"}),(0,t.jsx)(et.XL,{children:"Domain Verified!"}),(0,t.jsx)(et.TN,{children:"Your domain has been successfully verified."})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)(L.$,{variant:"outline",onClick:c,children:"Cancel"}),(0,t.jsxs)("div",{className:"space-x-2",children:[!n&&(0,t.jsx)(L.$,{onClick:o,disabled:l||!a,loading:l,children:l?"Verifying...":"Verify Domain"}),n&&(0,t.jsx)(L.$,{onClick:d,children:"Continue"})]})]})]})},ts=e=>{let{form:s,onSubmit:a,onTestIssuer:i,isTestingIssuer:r,onBack:l,showTestButton:o=!0,submitButtonText:c="Configure Provider",submitButtonDisabled:d=!1,domain:u="",verifiedDomains:m=[]}=e,{register:p,handleSubmit:x,formState:{errors:h,isSubmitting:j},watch:g,setValue:f}=s,[v,y]=(0,n.useState)(!1),[b,N]=(0,n.useState)(!1),w=g("issuer"),k=g("clientId"),C=g("clientSecret"),_=g("displayName"),S=g("slug"),E=!!(w&&k&&C&&_&&S);return(0,n.useEffect)(()=>{v||_||f("displayName",(0,a8.DU)(u,m,"OIDC Provider"))},[u,m,_,v,f]),(0,n.useEffect)(()=>{_&&!b&&f("slug",(0,a8.z9)(_))},[_,b,f]),(0,t.jsxs)("form",{className:"space-y-4",onSubmit:x(a),noValidate:!0,children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h3",{className:"text-xl font-medium",children:"Configure OIDC Provider"}),(0,t.jsx)("p",{className:"text-sm",children:"Copy these values from your identity provider's OAuth/OIDC application settings."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(V.Label,{htmlFor:"issuer",children:"OIDC Issuer URL / Discovery Endpoint*"}),(0,t.jsx)(T.p,{id:"issuer",...p("issuer",{required:"Issuer URL is required",pattern:{value:/^https:\/\/.+/,message:"URL must start with https://"},validate:e=>{try{return new URL(e),!0}catch(e){return"Please enter a valid URL."}}}),placeholder:"https://idp.example.com",className:"mt-1"}),h.issuer&&(0,t.jsx)("p",{className:"mt-1 text-xs text-destructive-foreground",children:h.issuer.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(V.Label,{htmlFor:"clientId",children:"OAuth Client ID / Application ID*"}),(0,t.jsx)(T.p,{id:"clientId",...p("clientId",{required:"Client ID is required"}),placeholder:"1234567890.apps.provider.com",className:"mt-1"}),h.clientId&&(0,t.jsx)("p",{className:"mt-1 text-xs text-destructive-foreground",children:h.clientId.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(V.Label,{htmlFor:"clientSecret",children:"OAuth Client Secret*"}),(0,t.jsx)(T.p,{id:"clientSecret",type:"password",...p("clientSecret",{required:"Client Secret is required"}),placeholder:"Enter your client secret",className:"mt-1"}),h.clientSecret&&(0,t.jsx)("p",{className:"mt-1 text-xs text-destructive-foreground",children:h.clientSecret.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(V.Label,{htmlFor:"displayName",children:"Display Name*"}),(0,t.jsx)(T.p,{id:"displayName",...p("displayName",{required:"Display name is required"}),placeholder:"e.g., Acme Corp SSO",className:"mt-1",onChange:e=>{f("displayName",e.target.value),y(!0)}}),h.displayName&&(0,t.jsx)("p",{className:"mt-1 text-xs text-destructive-foreground",children:h.displayName.message}),(0,t.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:"This name will be shown to users during authentication."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(V.Label,{htmlFor:"slug",children:"URL subdomain*"}),(0,t.jsx)(T.p,{id:"slug",...p("slug",{required:"URL subdomain is required",validate:e=>(0,a8.Ac)(e)||"URL subdomain must contain only lowercase letters, numbers, and hyphens, and cannot start or end with a hyphen"}),placeholder:"e.g., acme-corp",className:"mt-1",onChange:e=>{f("slug",e.target.value.toLowerCase()),N(!0)}}),h.slug&&(0,t.jsx)("p",{className:"mt-1 text-xs text-destructive-foreground",children:h.slug.message}),(0,t.jsxs)("div",{className:"mt-1 rounded-md bg-muted p-2 text-xs",children:[(0,t.jsxs)("code",{className:"text-xs",children:[(0,a8.xz)(),S||"[slug]"]}),(0,t.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:"Users can use this URL to sign in directly with SSO."})]})]}),(0,t.jsxs)("div",{className:"flex justify-between gap-2",children:[(0,t.jsxs)(L.$,{variant:"outline",onClick:l,type:"button",children:[(0,t.jsx)(F.A,{name:"arrow_left",weight:"medium",size:"small"}),"Back"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[o&&(0,t.jsxs)(ei.m_,{children:[(0,t.jsx)(ei.k$,{asChild:!0,children:(0,t.jsx)("span",{children:(0,t.jsxs)(L.$,{type:"button",variant:"secondary",onClick:i,disabled:!E||r,loading:r,children:[(0,t.jsx)(F.A,{name:"flask_conical",size:"small"}),r?"Testing...":"Test Configuration"]})})}),!E&&(0,t.jsx)(ei.ZI,{children:"Please fill in all required fields (Issuer, Client ID, and Client Secret)"})]}),(0,t.jsxs)(L.$,{type:"submit",disabled:j||d,variant:d?"outline":"default",children:[d&&!j&&(0,t.jsx)(F.A,{name:"lock",size:"small"}),c]})]})]})]})},ta=e=>{let{authRedirectUrl:s,onNext:a,onBack:i}=e,[r,l]=(0,n.useState)(1),o=async(e,s)=>{await navigator.clipboard.writeText(e),j.toast.success("".concat(s," copied to clipboard"))};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsx)("h3",{className:"text-xl font-medium",children:"Set up OIDC in your identity provider before proceeding."})}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:[1,2,3].map(e=>(0,t.jsx)("div",{className:"h-2 flex-1 rounded-full ".concat(e<=r?"bg-primary":"bg-muted")},e))}),1===r&&(0,t.jsxs)(es.Zp,{children:[(0,t.jsx)(es.aR,{children:(0,t.jsx)(es.ZB,{className:"text-base",children:"Create New Application"})}),(0,t.jsx)(es.Wu,{className:"space-y-3",children:(0,t.jsxs)("div",{className:"space-y-3 rounded-md border p-3",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Create a new application with these settings:"}),(0,t.jsxs)("div",{className:"grid max-w-md grid-cols-[auto,1fr] gap-x-4 gap-y-2",children:[(0,t.jsx)("span",{className:"text-sm",children:"Application Type"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(ep.E,{variant:"secondary",className:"text-sm",children:"Web Application"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"or"}),(0,t.jsx)(ep.E,{variant:"secondary",className:"text-sm",children:"Server-side Application"})]}),(0,t.jsx)("span",{className:"text-sm",children:"Grant Type"}),(0,t.jsx)(ep.E,{variant:"secondary",className:"w-fit text-sm",children:"Authorization Code"}),(0,t.jsx)("span",{className:"text-sm",children:"Token Method"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ep.E,{variant:"secondary",className:"text-sm",children:"POST"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"(if configurable)"})]})]})]})})]}),2===r&&(0,t.jsxs)(es.Zp,{children:[(0,t.jsx)(es.aR,{children:(0,t.jsx)(es.ZB,{className:"text-base",children:"Add Redirect URI"})}),(0,t.jsx)(es.Wu,{className:"space-y-3",children:(0,t.jsxs)("div",{className:"space-y-2 rounded-md border p-3",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Copy this URL to your application's redirect/callback settings:"}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2 rounded-md bg-muted/50 p-2",children:[(0,t.jsx)("code",{className:"text-sm",children:s}),(0,t.jsx)(L.$,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>o(s,"Redirect URI"),children:(0,t.jsx)(F.A,{name:"copy",size:"small"})})]}),(0,t.jsx)("p",{className:"text-xs",children:"The URL must match exactly, including the protocol (https://)."})]})})]}),3===r&&(0,t.jsxs)(es.Zp,{children:[(0,t.jsx)(es.aR,{children:(0,t.jsx)(es.ZB,{className:"text-base",children:"Enable OAuth Scopes"})}),(0,t.jsxs)(es.Wu,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"space-y-3 rounded-md border p-3",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Enable these OAuth scopes:"}),(0,t.jsxs)("div",{className:"grid max-w-xs grid-cols-[auto,1fr] gap-x-4 gap-y-2",children:[(0,t.jsx)("code",{className:"text-sm font-medium",children:"openid"}),(0,t.jsx)(ep.E,{variant:"default",className:"w-fit text-xs",children:"Required"}),(0,t.jsx)("code",{className:"text-sm font-medium",children:"email"}),(0,t.jsx)(ep.E,{variant:"default",className:"w-fit text-xs",children:"Required"}),(0,t.jsx)("code",{className:"text-sm font-medium",children:"profile"}),(0,t.jsx)(ep.E,{variant:"outline",className:"w-fit text-xs",children:"Recommended"})]})]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,t.jsx)("strong",{children:"Note:"})," The profile scope enables user names and profile pictures to display correctly."]})]})]}),(0,t.jsxs)("div",{className:"flex justify-between pt-4",children:[(0,t.jsxs)(L.$,{variant:"outline",onClick:()=>{r>1?l(r-1):i()},children:[(0,t.jsx)(F.A,{name:"arrow_left",weight:"medium",size:"small"}),"Back"]}),(0,t.jsxs)(L.$,{onClick:()=>{r<3?l(r+1):a()},children:[r<3?"Next":"I've Configured My IdP",(0,t.jsx)(F.A,{name:"arrow_up_right",size:"small"})]})]})]})},tt=e=>{let{onSelectType:s,onBack:a}=e;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h3",{className:"text-xl font-medium",children:"Choose SSO Protocol"}),(0,t.jsx)("p",{className:"text-sm",children:"Select the Single Sign-On protocol that your identity provider supports."}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Both protocols are supported by Okta, Entra ID, Google Workspace, Auth0, Keycloak, and all modern identity providers."})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)(es.Zp,{className:"relative cursor-pointer border-2 transition-all hover:border-primary/50 hover:bg-accent/50",children:[(0,t.jsx)("div",{className:"absolute right-3 top-3",children:(0,t.jsx)(ep.E,{variant:"default",className:"text-sm font-medium",children:"Recommended"})}),(0,t.jsx)(es.aR,{className:"pb-3",children:(0,t.jsxs)(es.ZB,{className:"flex items-center gap-2 text-base",children:[(0,t.jsx)("div",{className:"rounded-md bg-blue-100 p-2 dark:bg-blue-900/20",children:(0,t.jsx)(F.A,{name:"shield",className:"text-blue-600 dark:text-blue-400"})}),"OpenID Connect (OIDC)"]})}),(0,t.jsxs)(es.Wu,{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-sm",children:"Modern OAuth 2.0-based protocol with built-in identity layer."}),(0,t.jsxs)(L.$,{className:"w-full",onClick:()=>s("oidc"),children:["Configure OIDC",(0,t.jsx)(F.A,{name:"arrow_up_right",size:"small"})]})]})]}),(0,t.jsxs)(es.Zp,{className:"cursor-pointer border-2 transition-all hover:border-primary/50 hover:bg-accent/50",children:[(0,t.jsx)(es.aR,{className:"pb-3",children:(0,t.jsxs)(es.ZB,{className:"flex items-center gap-2 text-base",children:[(0,t.jsx)("div",{className:"rounded-md bg-orange-100 p-2 dark:bg-orange-900/20",children:(0,t.jsx)(F.A,{name:"shield",className:"text-orange-600 dark:text-orange-400"})}),"SAML 2.0"]})}),(0,t.jsxs)(es.Wu,{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-sm",children:"XML-based protocol for single sign-on."}),(0,t.jsxs)(L.$,{variant:"outline",className:"w-full",onClick:()=>s("saml"),children:["Configure SAML",(0,t.jsx)(F.A,{name:"arrow_up_right",size:"small"})]})]})]})]}),(0,t.jsx)("div",{className:"flex justify-start pt-4",children:(0,t.jsxs)(L.$,{variant:"outline",onClick:a,children:[(0,t.jsx)(F.A,{name:"arrow_left",weight:"medium",size:"small"}),"Back"]})})]})},ti=e=>{let{form:s,onSubmit:a,onBack:i,authRedirectUrl:r,domain:l="",verifiedDomains:o=[]}=e,{register:c,handleSubmit:d,formState:{errors:u,isSubmitting:m},watch:p,setValue:x}=s,[h,j]=(0,n.useState)(!1),[g,f]=(0,n.useState)(!1),v=p("displayName"),y=p("slug");return(0,n.useEffect)(()=>{h||v||x("displayName",(0,a8.DU)(l,o,"SAML Provider"))},[l,o,v,h,x]),(0,n.useEffect)(()=>{v&&!g&&x("slug",(0,a8.z9)(v))},[v,g,x]),(0,t.jsxs)("form",{className:"space-y-4",onSubmit:d(a),noValidate:!0,children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h3",{className:"text-xl font-medium",children:"Configure SAML Provider"}),(0,t.jsx)("p",{className:"text-sm",children:"Copy these values from your identity provider's SAML application settings."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(V.Label,{htmlFor:"signOnUrl",children:"SAML SSO Sign-on URL (from your IdP)*"}),(0,t.jsx)(T.p,{id:"signOnUrl",...c("signOnUrl",{required:"SSO Sign-on URL is required",pattern:{value:/^https:\/\/.+/,message:"URL must start with https://"},validate:e=>{try{return new URL(e),!0}catch(e){return"Please enter a valid URL."}}}),placeholder:"https://idp.example.com/saml/sso",className:"mt-1"}),u.signOnUrl&&(0,t.jsx)("p",{className:"mt-1 text-xs text-destructive-foreground",children:u.signOnUrl.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(V.Label,{htmlFor:"entityId",children:"Identity Provider Entity ID / Issuer*"}),(0,t.jsx)(T.p,{id:"entityId",...c("entityId",{required:"Identity Provider Entity ID is required"}),placeholder:"https://idp.example.com/metadata or urn:example:saml:idp",className:"mt-1"}),u.entityId&&(0,t.jsx)("p",{className:"mt-1 text-xs text-destructive-foreground",children:u.entityId.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(V.Label,{htmlFor:"x509Certificate",children:"X.509 Signing Certificate (public key)*"}),(0,t.jsx)(eP.T,{id:"x509Certificate",...c("x509Certificate",{required:"X.509 Certificate is required",validate:e=>{let s=e.trim();return!!s.includes("BEGIN CERTIFICATE")&&!!s.includes("END CERTIFICATE")||"Please provide a valid X.509 certificate in PEM format"}}),placeholder:"-----BEGIN CERTIFICATE-----\nMIIDEzCCAfugAwIBAgIQKiw9f...\n-----END CERTIFICATE-----",className:"mt-1 h-32 font-mono text-xs",rows:8}),u.x509Certificate&&(0,t.jsx)("p",{className:"mt-1 text-xs text-destructive-foreground",children:u.x509Certificate.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(V.Label,{htmlFor:"displayName",children:"Display Name*"}),(0,t.jsx)(T.p,{id:"displayName",...c("displayName",{required:"Display name is required"}),placeholder:"e.g., Acme Corp SSO",className:"mt-1",onChange:e=>{x("displayName",e.target.value),j(!0)}}),u.displayName&&(0,t.jsx)("p",{className:"mt-1 text-xs text-destructive-foreground",children:u.displayName.message}),(0,t.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:"This name will be shown to users during authentication."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(V.Label,{htmlFor:"slug",children:"URL subdomain*"}),(0,t.jsx)(T.p,{id:"slug",...c("slug",{required:"URL subdomain is required",validate:e=>(0,a8.Ac)(e)||"URL subdomain must contain only lowercase letters, numbers, and hyphens, and cannot start or end with a hyphen"}),placeholder:"e.g., acme-corp",className:"mt-1",onChange:e=>{x("slug",e.target.value.toLowerCase()),f(!0)}}),u.slug&&(0,t.jsx)("p",{className:"mt-1 text-xs text-destructive-foreground",children:u.slug.message}),(0,t.jsxs)("div",{className:"mt-1 rounded-md bg-muted p-2 text-xs",children:[(0,t.jsxs)("code",{className:"text-xs",children:[(0,a8.xz)(),y||"[slug]"]}),(0,t.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:"Users can use this URL to sign in directly with SSO."})]})]}),(0,t.jsxs)("div",{className:"flex justify-between gap-2",children:[(0,t.jsxs)(L.$,{variant:"outline",onClick:i,type:"button",children:[(0,t.jsx)(F.A,{name:"arrow_left",weight:"medium",size:"small"}),"Back"]}),(0,t.jsx)(L.$,{type:"submit",disabled:m,loading:m,children:m?"Configuring...":"Configure SAML Provider"})]})]})},tn=e=>{let{authRedirectUrl:s,onNext:a,onBack:i}=e,[r,l]=(0,n.useState)(1),o=async(e,s)=>{await navigator.clipboard.writeText(e),j.toast.success("".concat(s," copied to clipboard"))};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsx)("h3",{className:"text-xl font-medium",children:"Set up SAML in your identity provider."})}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:[1,2,3].map(e=>(0,t.jsx)("div",{className:"h-2 flex-1 rounded-full ".concat(e<=r?"bg-primary":"bg-muted")},e))}),1===r&&(0,t.jsxs)(es.Zp,{children:[(0,t.jsx)(es.aR,{children:(0,t.jsx)(es.ZB,{className:"text-base",children:"Configure Service Provider Settings"})}),(0,t.jsxs)(es.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("span",{className:"text-sm font-medium",children:"ACS URL (Assertion Consumer Service):"})}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2 rounded-md border bg-muted/50 p-2",children:[(0,t.jsx)("code",{className:"text-sm",children:s}),(0,t.jsx)(L.$,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>o(s,"ACS URL"),children:(0,t.jsx)(F.A,{name:"copy",size:"small"})})]}),(0,t.jsx)("p",{className:"text-xs",children:"Also known as: Reply URL, SSO URL, or Recipient URL"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("span",{className:"text-sm font-medium",children:"SP Entity ID / Audience URI:"})}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2 rounded-md border bg-muted/50 p-2",children:[(0,t.jsx)("code",{className:"text-sm",children:s}),(0,t.jsx)(L.$,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>o(s,"Entity ID"),children:(0,t.jsx)(F.A,{name:"copy",size:"small"})})]}),(0,t.jsx)("p",{className:"text-xs",children:"Also known as: Audience, Identifier, or SP Entity ID"})]}),(0,t.jsxs)("p",{className:"text-xs",children:[(0,t.jsx)("strong",{children:"Note:"})," Both ACS URL and Entity ID use the same value for Lovable."]})]})]}),2===r&&(0,t.jsxs)(es.Zp,{children:[(0,t.jsx)(es.aR,{children:(0,t.jsx)(es.ZB,{className:"text-base",children:"Configure Attribute Mappings"})}),(0,t.jsxs)(es.Wu,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"space-y-3 rounded-md border p-3",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Add these attributes in your SAML application:"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm",children:"Email"}),(0,t.jsx)(ep.E,{variant:"default",className:"text-xs",children:"Required"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,t.jsx)("span",{children:"Already handled via Name ID - ensure format is set to"}),(0,t.jsx)(ep.E,{variant:"secondary",className:"font-mono text-sm",children:"EmailAddress"})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ep.E,{variant:"secondary",className:"font-mono text-sm",children:"displayName"}),(0,t.jsx)(ep.E,{variant:"outline",className:"text-xs",children:"Recommended"})]}),(0,t.jsx)("p",{className:"text-xs",children:"Map to user's full name (e.g., user.displayName)"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ep.E,{variant:"secondary",className:"font-mono text-sm",children:"photoURL"}),(0,t.jsx)(ep.E,{variant:"outline",className:"text-xs",children:"Recommended"})]}),(0,t.jsx)("p",{className:"text-xs",children:"Map to user's profile picture URL"})]})]})]}),(0,t.jsxs)("p",{className:"text-xs",children:[(0,t.jsx)("strong",{children:"Note:"})," Use exact attribute names as shown above for proper integration."]})]})]}),3===r&&(0,t.jsxs)(es.Zp,{children:[(0,t.jsx)(es.aR,{children:(0,t.jsx)(es.ZB,{className:"text-base",children:"Protocol Settings"})}),(0,t.jsx)(es.Wu,{className:"space-y-3",children:(0,t.jsxs)("div",{className:"space-y-3 rounded-md border p-3",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Use these standard settings:"}),(0,t.jsxs)("div",{className:"grid max-w-sm grid-cols-[auto,1fr] gap-x-4 gap-y-2",children:[(0,t.jsx)("span",{className:"text-sm",children:"Name ID Format"}),(0,t.jsx)(ep.E,{variant:"secondary",className:"w-fit font-mono text-sm",children:"EmailAddress"}),(0,t.jsx)("span",{className:"text-sm",children:"Signature Algorithm"}),(0,t.jsx)(ep.E,{variant:"secondary",className:"w-fit font-mono text-sm",children:"RSA-SHA256"}),(0,t.jsx)("span",{className:"text-sm",children:"SAML Binding"}),(0,t.jsx)(ep.E,{variant:"secondary",className:"w-fit font-mono text-sm",children:"HTTP-POST"}),(0,t.jsx)("span",{className:"text-sm",children:"Response Signed"}),(0,t.jsx)(ep.E,{variant:"secondary",className:"w-fit text-xs",children:"Yes"})]}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(0,t.jsx)("strong",{children:"Note:"})," For Name ID Format, if asked for details use:"," ",(0,t.jsx)("code",{className:"text-xs",children:"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress"})]})]})})]}),(0,t.jsxs)("div",{className:"flex justify-between pt-4",children:[(0,t.jsxs)(L.$,{variant:"outline",onClick:()=>{r>1?l(r-1):i()},children:[(0,t.jsx)(F.A,{name:"arrow_left",weight:"medium",size:"small"}),"Back"]}),(0,t.jsxs)(L.$,{onClick:()=>{r<3?l(r+1):a()},children:[r<3?"Next":"I've Configured My IdP",(0,t.jsx)(F.A,{name:"arrow_up_right",size:"small"})]})]})]})},tr=e=>{let{validationResult:s,verifiedDomains:a,providerType:i,displayName:n,onConfirm:r,onBack:l,isConfirming:o}=e,c="saml"===i||(null==s?void 0:s.auth_flow_ready)&&(null==s?void 0:s.client_secret_validation_status)==="validated"&&(null==s?void 0:s.required_scopes_available)!==!1&&(null==s?void 0:s.required_claims_available)!==!1,d="saml"!==i&&((null==s?void 0:s.required_scopes_available)===!1||(null==s?void 0:s.required_claims_available)===!1);return(0,t.jsxs)("div",{className:"space-y-6",children:[(s||"saml"===i)&&(0,t.jsxs)(et.Fc,{variant:c?"default":d?"destructive":"warning",children:[(0,t.jsx)(F.A,{name:c?"check_circle":d?"error":"info",size:"small"}),(0,t.jsx)(et.TN,{children:"saml"===i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("strong",{children:"SAML Configuration Ready:"})," SAML authentication will be validated on first user login. Ensure your identity provider is properly configured with the provided ACS URL and Entity ID."]}):c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("strong",{children:"OIDC Configuration Validated:"})," Your OIDC configuration has been successfully tested and verified."]}):(0,t.jsx)(t.Fragment,{children:(null==s?void 0:s.auth_flow_ready)?(null==s?void 0:s.client_secret_validation_status)==="invalid"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("strong",{children:"Invalid Client Secret:"})," The client secret appears to be invalid. Please verify it's correct before proceeding."]}):(null==s?void 0:s.required_scopes_available)===!1?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("strong",{children:"Missing Required Scopes:"})," Your provider doesn't support the required 'openid' and 'email' scopes. Authentication will not work without these scopes."]}):(null==s?void 0:s.required_claims_available)===!1?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("strong",{children:"Missing Required Claims:"})," Your provider doesn't support the required 'email' claim. Users won't be able to sign in without this claim."]}):(null==s?void 0:s.client_secret_validation_status)==="unavailable"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("strong",{children:"Configuration Ready:"})," Your configuration looks good! Your provider doesn't support pre-validation of the client secret (this is common). The credentials will be verified on first login. If you're confident your client secret is correct, you can proceed."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("strong",{children:"Configuration Notice:"})," Some aspects of the configuration couldn't be validated. If you believe your configuration is correct, you can proceed."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("strong",{children:"Configuration Issue:"})," The authorization flow couldn't be verified. Please ensure your Client ID and Redirect URI are correctly configured in your IdP."]})})})]}),(0,t.jsxs)(es.Zp,{children:[(0,t.jsx)(es.aR,{children:(0,t.jsxs)(es.ZB,{className:"flex items-center text-sm",children:[(0,t.jsx)(F.A,{name:"lock"}),"SSO Enforcement (Optional)"]})}),(0,t.jsxs)(es.Wu,{className:"space-y-1",children:[(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["After configuration is complete, you'll be able to ",(0,t.jsx)("strong",{children:"enforce SSO"})," as the only authentication method for this workspace."]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"When SSO enforcement is enabled:"}),(0,t.jsxs)("ul",{className:"ml-2 list-inside list-disc space-y-1 text-sm text-muted-foreground",children:[(0,t.jsx)("li",{children:"Email/password and other login methods will be disabled for this workspace"}),(0,t.jsx)("li",{children:"Users can link their existing Lovable accounts by signing in with SSO"})]})]})]}),(0,t.jsxs)(es.Zp,{children:[(0,t.jsx)(es.aR,{children:(0,t.jsxs)(es.ZB,{className:"flex items-center text-sm",children:[(0,t.jsx)(F.A,{name:"person_plus"}),"Automatic User Provisioning (JIT)"]})}),(0,t.jsxs)(es.Wu,{className:"space-y-1",children:[(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(0,t.jsx)("strong",{children:"Just-In-Time provisioning is enabled by default."})," Users authenticating via SSO with verified domain emails will be automatically added to this workspace on their first login. The default role can be configured after SSO setup is complete. Users with other domains will require manual invitation."]}),a.length>0&&(0,t.jsxs)("div",{className:"rounded bg-muted p-2 text-xs",children:[(0,t.jsx)("span",{className:"font-medium",children:"Auto-provision for: "}),a.map(e=>(0,t.jsxs)(ep.E,{variant:"secondary",className:"ml-1 text-xs",children:["@",e]},e))]})]})]}),(0,t.jsxs)("div",{className:"flex justify-between pt-1",children:[(0,t.jsx)(L.$,{variant:"outline",onClick:l,disabled:o,children:"Back"}),(0,t.jsx)(L.$,{onClick:r,disabled:o,loading:o,children:o?"Configuring...":"Confirm & Enable SSO"})]})]})},tl=e=>{let{validationResult:s,authRedirectUrl:a,isLocalhost:i}=e;return s.auth_flow_ready||!s.message?null:(0,t.jsxs)(et.Fc,{variant:"warning",children:[(0,t.jsx)(F.A,{name:"info_circle",size:"small"}),(0,t.jsx)(et.XL,{className:"text-sm",children:(()=>{switch(s.auth_flow_error_type){case"redirect_uri":return"Client ID or Redirect URI Issue";case"client_id":return"Client ID Not Recognized";case"client_secret":return"Invalid Client Secret";case"access_denied":return"Access Denied";case"invalid_request":return"Invalid Request";default:return"Configuration Issue"}})()}),(0,t.jsxs)(et.TN,{className:"space-y-2 text-sm",children:[(0,t.jsx)("div",{children:(()=>{switch(s.auth_flow_error_type){case"redirect_uri":return"The identity provider rejected the request. This typically means either the Client ID is incorrect or the Redirect URI is not configured in your IdP.";case"client_id":return"The Client ID wasn't recognized by the identity provider. Please verify it matches your IdP application.";case"client_secret":return"The client secret validation failed. Please check your credentials.";case"access_denied":return"The requested scopes were denied by the identity provider.";case"invalid_request":return"Missing required parameters in the authorization request.";default:return"Authorization check failed: ".concat(s.message)}})()}),"redirect_uri"===s.auth_flow_error_type&&(0,t.jsxs)("div",{className:"mt-2 space-y-2 rounded bg-background p-2",children:[(0,t.jsx)("div",{className:"font-medium",children:"Check these two settings in your IdP:"}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("div",{className:"text-xs font-medium",children:"1. Client ID"}),(0,t.jsx)("div",{className:"ml-3 text-sm",children:"Verify that the Client ID exactly matches what's configured in your IdP application."})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("div",{className:"text-sm font-medium",children:"2. Redirect URI"}),(0,t.jsx)("code",{className:"ml-3 block break-all rounded bg-muted p-1 text-xs",children:a}),(0,t.jsx)("div",{className:"ml-3 text-sm",children:"Make sure this exact URI is added to your IdP's allowed redirect/callback URIs."})]}),(0,t.jsx)("div",{className:"mt-2 space-y-1 text-sm",children:i?(0,t.jsx)("div",{children:"âš ï¸ You're testing locally. Make sure your IdP is configured for the development redirect URI."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"font-medium",children:"Quick fix steps:"}),(0,t.jsxs)("ol",{className:"ml-4 list-decimal",children:[(0,t.jsx)("li",{children:"Double-check your Client ID is copied correctly"}),(0,t.jsx)("li",{children:"Go to your IdP application settings"}),(0,t.jsx)("li",{children:"Find the redirect/callback URI section"}),(0,t.jsx)("li",{children:"Add the exact URI shown above if missing"}),(0,t.jsx)("li",{children:"Save and test again"})]})]})})]})]})]})},to=e=>{let{validationResult:s}=e,{authorization_endpoint:a,token_endpoint:i,userinfo_endpoint:n,client_secret_validation_status:r,auth_flow_ready:l,auth_flow_error_type:o,supported_scopes:c,supported_claims:d,required_scopes_available:u,required_claims_available:m,warnings:p}=s,x="unavailable"===r,h=l&&"validated"===r&&!1!==u&&!1!==m;return(0,t.jsxs)(es.Zp,{className:"ring-2 ring-primary/20 duration-300 animate-in fade-in-0",children:[(0,t.jsx)(es.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(es.ZB,{className:"text-sm",children:"Test Results"}),l?"invalid"===r?(0,t.jsx)(ep.E,{variant:"destructive",className:"text-sm",children:"Invalid Secret"}):!1===u?(0,t.jsx)(ep.E,{variant:"destructive",className:"text-sm",children:"Missing Required Scopes"}):!1===m?(0,t.jsx)(ep.E,{variant:"destructive",className:"text-sm",children:"Missing Required Claims"}):"validated"===r?(0,t.jsx)(ep.E,{variant:"affirmative",className:"text-sm",children:"Fully Validated"}):x?(0,t.jsx)(ep.E,{variant:"secondary",className:"text-sm",children:"Ready to Configure"}):(0,t.jsx)(ep.E,{variant:"affirmative",className:"text-sm",children:"Discovery OK"}):"redirect_uri"===o?(0,t.jsx)(ep.E,{variant:"warning",className:"text-sm",children:"Config Mismatch"}):"client_id"===o?(0,t.jsx)(ep.E,{variant:"destructive",className:"text-sm",children:"Invalid Client ID"}):(0,t.jsx)(ep.E,{variant:"destructive",className:"text-sm",children:"Not Ready"})]})}),(0,t.jsxs)(es.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Discovery Endpoints"}),(0,t.jsxs)("div",{className:"space-y-1",children:[a&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(F.A,{name:"check",size:"small",className:"text-green-500"}),(0,t.jsx)("span",{className:"text-sm",children:"Authorization endpoint found"})]}),i&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(F.A,{name:"check",size:"small",className:"text-green-500"}),(0,t.jsx)("span",{className:"text-sm",children:"Token endpoint found"})]}),n&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(F.A,{name:"check",size:"small",className:"text-green-500"}),(0,t.jsx)("span",{className:"text-sm",children:"UserInfo endpoint found"})]})]})]}),r&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Client Credentials"}),(0,t.jsxs)("div",{className:"space-y-1",children:["validated"===r&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(F.A,{name:"check",size:"small",className:"text-green-500"}),(0,t.jsx)("span",{className:"text-sm",children:"Client secret validated"})]}),"invalid"===r&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(F.A,{name:"x",size:"small",className:"text-red-500"}),(0,t.jsx)("span",{className:"text-sm",children:"Invalid client secret"})]}),"unavailable"===r&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(F.A,{name:"info_circle",size:"small",className:"text-blue-500"}),(0,t.jsx)("span",{className:"text-sm",children:"Provider doesn't support pre-validation (common) - will validate on first login"})]})]})]}),c&&c.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:h?"Validated Scopes":x||l&&"invalid"!==r?"Provider Capabilities":"Provider Capabilities (Not Yet Accessible)"}),!h&&(0,t.jsxs)(et.Fc,{variant:"warning",className:"text-sm",children:[(0,t.jsx)(F.A,{name:"info_circle",size:"small"}),(0,t.jsx)(et.TN,{children:x?"Your provider advertises these capabilities. Since many providers don't support client credential validation, actual access will be confirmed on first login.":l||"redirect_uri"!==o?l||"client_id"!==o?"invalid"===r&&!1!==l?"These capabilities cannot be accessed with an invalid client secret.":l?"Configuration validation in progress.":"These capabilities are not yet accessible due to configuration issues.":"These capabilities cannot be accessed with an invalid Client ID.":"These capabilities will be accessible once the redirect URI or Client ID is correctly configured in your IdP."})]}),(0,t.jsxs)("div",{className:h?"":"opacity-50",children:[(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:c.map(e=>(0,t.jsx)(ep.E,{variant:h?"secondary":"outline",className:"text-xs",children:e},e))}),!1===u&&(0,t.jsx)(et.Fc,{variant:"destructive",className:"mt-2",children:(0,t.jsx)(et.TN,{className:"text-sm",children:"âš ï¸ Required scopes (openid, email) are not available. Authentication will not work."})})]})]}),d&&d.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:h?"Validated Claims":x||l&&"invalid"!==r?"Provider Claims":"Provider Claims (Not Yet Accessible)"}),(0,t.jsxs)("div",{className:h?"":"opacity-50",children:[(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:["email","name","picture","sub"].map(e=>{let s=d.includes(e)||"name"===e&&(d.includes("given_name")||d.includes("family_name")||d.includes("preferred_username")),a="email"===e;return(0,t.jsxs)(ep.E,{variant:h?s?"affirmative":a?"destructive":"secondary":"outline",className:"text-xs",children:[e,a&&" (required)",h&&(s?" âœ“":" âœ—")]},e)})}),!1===m&&(0,t.jsx)(et.Fc,{variant:"destructive",className:"mt-2",children:(0,t.jsx)(et.TN,{className:"text-sm",children:"âš ï¸ The 'email' claim is not available. This is required for users to sign in. Authentication will fail."})})]})]}),p&&p.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-warning-foreground",children:"Warnings"}),(0,t.jsx)("ul",{className:"list-inside list-disc space-y-1",children:p.map((e,s)=>(0,t.jsx)("li",{className:"text-sm text-muted-foreground",children:e},s))})]})]})]})},tc=(e,s,a)=>{let t={duration:td,dismissible:!0,...a};return j.toast[e](s,t)},td=8e3,tu=e=>{let{workspace:s,onSuccess:a,onCancel:i,initialData:r,domainOnly:l=!1,verifiedDomains:o=[]}=e,[c,d]=(0,n.useState)(!l&&o.length>0?"provider_type":"domain"),[u,m]=(0,n.useState)((null==r?void 0:r.domain)||""),[p,x]=(0,n.useState)(!1),[h,j]=(0,n.useState)(""),[g,f]=(0,n.useState)(null),[y,b]=(0,n.useState)(""),[N,w]=(0,n.useState)(!1),[k,_]=(0,n.useState)(null),[S,E]=(0,n.useState)(!1),P=(0,I.mN)({defaultValues:{clientId:(null==r?void 0:r.clientId)||"",clientSecret:(null==r?void 0:r.clientSecret)||"",issuer:(null==r?void 0:r.issuer)||"",displayName:"",slug:""},mode:"onBlur"}),A=(0,I.mN)({defaultValues:{signOnUrl:"",x509Certificate:"",entityId:"",displayName:"",slug:""},mode:"onBlur"}),D=(0,n.useMemo)(()=>"localhost"===window.location.hostname?"https://gpt-engineer-dev.firebaseapp.com/__/auth/handler":"https://auth.lovable.dev/__/auth/handler",[]),z="localhost"===window.location.hostname,T=(0,n.useRef)(null),O=P.watch("clientId"),M=P.watch("clientSecret"),R=P.watch("issuer");(0,n.useEffect)(()=>{"oidc"===g&&(E(!1),_(null))},[O,M,R,g]);let{mutateAsync:U,isPending:$}=(0,C.n)({mutationFn:async()=>{let e=(0,v.P)();return await e.post("/workspaces/".concat(s.id,"/identity/verify-domain"),{domain:u}),x(!0),j(""),!0},onError:e=>{let s=e instanceof Error?e.message:"Domain verification failed";j(s),tc("error","Verification failed",{description:s})}}),{mutateAsync:q,isPending:B}=(0,C.n)({mutationFn:async e=>{let a=(0,v.P)();return await a.post("/workspaces/".concat(s.id,"/identity/add-sso-provider"),{type:"oidc",oidc:{clientId:e.clientId,clientSecret:e.clientSecret,issuer:e.issuer},displayName:e.displayName,slug:e.slug}),!0},onSuccess:()=>{tc("success","SSO provider configured successfully!"),d("complete"),null==a||a()},onError:e=>{tc("error","Failed to configure SSO provider",{description:e instanceof Error?e.message:"Unknown error occurred"})}}),{mutateAsync:W,isPending:G}=(0,C.n)({mutationFn:async e=>{let a=(0,v.P)();return await a.post("/workspaces/".concat(s.id,"/identity/add-sso-provider"),{type:"saml",saml:{signOnUrl:e.signOnUrl.trim(),x509Certificate:e.x509Certificate.trim(),entityId:e.entityId.trim()},displayName:e.displayName.trim(),slug:e.slug.trim()}),!0},onSuccess:()=>{tc("success","SAML provider configured successfully!"),d("complete"),null==a||a()},onError:e=>{tc("error","Failed to configure SAML provider",{description:e instanceof Error?e.message:"Unknown error occurred"})}}),K=async()=>{w(!0);let e=P.getValues();try{let a=(0,v.P)(),t=await a.post("/workspaces/".concat(s.id,"/identity/validate-sso-provider"),{type:"oidc",issuer:e.issuer.trim(),clientId:e.clientId.trim(),clientSecret:e.clientSecret.trim(),redirectUri:D,scope:"openid email profile"});if(_(t),E(!0),setTimeout(()=>{var e;null==(e=T.current)||e.scrollIntoView({behavior:"smooth",block:"start"})},100),t.discovery_ok)if(t.auth_flow_ready)"invalid"===t.client_secret_validation_status?tc("error","Invalid client secret",{description:"The client secret validation failed. Please check your credentials."}):"validated"===t.client_secret_validation_status?tc("success","Configuration validated successfully!",{description:"Client credentials are valid and authorization flow is ready."}):tc("success","Configuration is partially validated.",{description:"Your provider doesn't support pre-validation of the client secret, which is normal. It will be validated on first login."});else switch(t.auth_flow_error_type){case"redirect_uri":tc("warning","Configuration mismatch detected",{description:z?"You're testing locally - ensure your IdP includes the development redirect URI":"The redirect URI needs to be added to your identity provider's application settings."});break;case"client_id":tc("error","Client ID not recognized",{description:t.message||"The Client ID may not be valid or recognized by the provider."});break;case"client_secret":tc("error","Invalid client secret",{description:"The client secret validation failed. Please check your credentials."});break;default:tc("error","Authorization flow error",{description:t.message||"The authorization flow is not working properly."})}else tc("error","OIDC discovery failed",{description:t.message})}catch(e){tc("error","Issuer verification failed",{description:e instanceof Error?e.message:"Unknown error occurred"})}finally{w(!1)}},V=()=>{"provider_type"===c?0===o.length||l?d("domain"):null==i||i():"oidc_preparation"===c||"saml_preparation"===c?d("provider_type"):"oidc"===c?d("oidc_preparation"):"saml"===c?d("saml_preparation"):"confirmation"===c&&g&&d(g)},Y=async e=>{b(e.displayName),d("confirmation")},Z=async e=>{b(e.displayName),d("confirmation")},Q=async()=>{if(g){if("oidc"===g){let e=P.getValues();await q(e)}else if("saml"===g){let e=A.getValues();await W(e)}}};return"confirmation"===c?(0,t.jsx)(tr,{validationResult:k,verifiedDomains:o,providerType:g,displayName:y,onConfirm:Q,onBack:V,isConfirming:B||G}):"complete"===c?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-affirmative/10",children:(0,t.jsx)(F.A,{name:"check",className:"h-8 w-8 text-affirmative"})}),(0,t.jsx)("h3",{className:"text-lg font-medium",children:l?"Domain Verified!":"SSO Provider Configured!"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:l?"Your domain has been successfully verified.":"Your SSO provider has been successfully configured."})]}),!l&&(0,t.jsxs)(es.Zp,{children:[(0,t.jsx)(es.aR,{children:(0,t.jsx)(es.ZB,{className:"text-sm",children:"Configuration Summary"})}),(0,t.jsxs)(es.Wu,{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Provider Type:"}),(0,t.jsx)(ep.E,{variant:"outline",children:"OIDC"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Status:"}),(0,t.jsx)(ep.E,{variant:"default",className:"bg-green-100 text-green-800",children:"Active"})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(L.$,{variant:"outline",onClick:null!=i?i:()=>{},children:"Close"}),!l&&(0,t.jsx)(L.$,{onClick:()=>d("domain"),children:"Add Another Provider"})]})]}):(0,t.jsxs)("div",{className:"space-y-6",children:["domain"===c&&(0,t.jsx)(te,{workspace:s,domain:u,setDomain:m,verified:p,verificationError:h,isVerifying:$,onVerify:()=>U().then(()=>{}),onCancel:null!=i?i:()=>{},onContinue:()=>{"domain"===c&&p&&(l?(d("complete"),null==a||a()):d("provider_type"))}}),"provider_type"===c&&(0,t.jsx)(tt,{onSelectType:e=>{f(e),d("oidc"===e?"oidc_preparation":"saml_preparation")},onBack:V}),"oidc_preparation"===c&&(0,t.jsx)(ta,{authRedirectUrl:D,onNext:()=>d("oidc"),onBack:V}),"oidc"===c&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(ts,{form:P,onSubmit:Y,onTestIssuer:K,isTestingIssuer:N,onBack:V,showTestButton:!0,submitButtonText:S?"Configure Provider":"Test Required First",submitButtonDisabled:!S||(null==k?void 0:k.client_secret_validation_status)==="invalid"&&(null==k?void 0:k.auth_flow_ready)!==!1,domain:u,verifiedDomains:o}),k&&(0,t.jsxs)("div",{ref:T,className:"scroll-mt-4 space-y-4 duration-500 animate-in fade-in slide-in-from-bottom-2",children:[(0,t.jsx)(tl,{validationResult:k,authRedirectUrl:D,isLocalhost:z}),(0,t.jsx)(to,{validationResult:k}),k.auth_flow_ready&&"invalid"!==k.client_secret_validation_status&&(0,t.jsxs)(es.Zp,{children:[(0,t.jsx)(es.aR,{children:(0,t.jsx)(es.ZB,{className:"text-sm",children:"Common Setup Issues"})}),(0,t.jsx)(es.Wu,{className:"text-xs text-muted-foreground",children:(0,t.jsxs)("ul",{className:"list-inside list-disc space-y-2",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Redirect URI mismatch:"})," Make sure the exact redirect URI is added to your IdP"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Client secret expired:"})," Some providers rotate secrets periodically"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Missing scopes:"})," Ensure your app has permission for openid and email scopes (required), plus profile scope (optional for user display names)"]})]})})]})]})]}),"saml_preparation"===c&&(0,t.jsx)(tn,{authRedirectUrl:D,onNext:()=>d("saml"),onBack:V}),"saml"===c&&(0,t.jsx)(ti,{form:A,authRedirectUrl:D,onSubmit:Z,onBack:V,domain:u,verifiedDomains:o})]})},tm=[{value:1440,label:"24 hours"},{value:2880,label:"48 hours"},{value:10080,label:"7 days"}],tp=e=>{let{workspace:s}=e,[a,i]=(0,n.useState)([{type:"list",title:"Identity & Access"}]),[r,l]=(0,n.useState)(null),[o,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(!!s.enforce_sso),[m,p]=(0,n.useState)(!1),x=(0,ed.jE)(),h=(0,v.P)(),{data:g=[],isLoading:f,error:y}=(0,eF.I)({queryKey:["sso-providers",s.id],queryFn:async()=>await h.get("/workspaces/".concat(s.id,"/identity/sso-providers")),permission:ev.eZ.ManageWorkspaceIdentity}),{data:b=[],isLoading:N,error:w}=(0,eF.I)({queryKey:["verified-domains",s.id],queryFn:async()=>(await h.get("/workspaces/".concat(s.id,"/identity/verified-domains"))).domains,permission:ev.eZ.ManageWorkspaceIdentity}),k=g.some(e=>Date.now()-new Date(e.created_at).getTime()<216e5),_=(0,C.n)({mutationFn:async e=>{await h.delete("/workspaces/".concat(s.id,"/identity/sso-providers/").concat(e))},onSuccess:()=>{x.invalidateQueries({queryKey:["sso-providers",s.id]}),x.invalidateQueries({queryKey:["workspaces",s.id]}),u(!1),l(null),j.toast.success("SSO provider deleted successfully")},onError:e=>{l(null),j.toast.error(e.message||"Failed to delete SSO provider")}}),S=(0,C.n)({mutationFn:async e=>{await h.delete("/workspaces/".concat(s.id,"/identity/verified-domains/").concat(e))},onSuccess:()=>{var e;x.invalidateQueries({queryKey:["verified-domains",s.id]}),x.invalidateQueries({queryKey:["workspaces",s.id]}),d&&(null!=(e=null==b?void 0:b.length)?e:0)<=1&&u(!1),c(null),j.toast.success("Domain deleted successfully")},onError:e=>{j.toast.error(e.message||"Failed to delete domain"),c(null)}}),E=(0,C.n)({mutationFn:async e=>{let{providerId:a,role:t}=e;t&&await h.patch("/workspaces/".concat(s.id,"/identity/sso-providers/").concat(a),{default_jit_role:t})},onSuccess:()=>{x.invalidateQueries({queryKey:["sso-providers",s.id]}),j.toast.success("Default JIT role updated successfully")},onError:e=>{j.toast.error(e.message||"Failed to update default JIT role")}}),P=(0,C.n)({mutationFn:async e=>await h.put("/user/workspaces/".concat(s.id),{enforce_sso:e}),onSuccess:e=>{u(!!e.enforce_sso),x.invalidateQueries({queryKey:["sso-providers",s.id]}),x.invalidateQueries({queryKey:["workspaces",s.id]}),j.toast.success("Updated",{description:"Enforce SSO updated"})},onError:e=>{j.toast.error(e.message||"Failed to update Enforce SSO"),u(!!s.enforce_sso)}}),I=(0,C.n)({mutationFn:async e=>await h.put("/user/workspaces/".concat(s.id),{sso_session_duration:e}),onSuccess:()=>{x.invalidateQueries({queryKey:["workspaces",s.id]}),j.toast.success("SSO session duration updated successfully")},onError:e=>{j.toast.error(e.message||"Failed to update SSO session duration")}}),A=a[a.length-1],D=()=>{if(!W)return void B();l(null),c(null),i(e=>[...e,{type:"add-provider",title:"Add SSO Provider"}])},z=()=>{if(!W)return void B();l(null),c(null),i(e=>[...e,{type:"add-domain",title:"Add Verified Domain"}])},T=()=>{l(null),c(null),i(e=>e.slice(0,-1))},O=()=>{l(null),c(null),i([{type:"list",title:"Identity & Access"}])},M=()=>{r&&_.mutate(r)},R=()=>{o&&S.mutate(o)},U=()=>{p(!1),u(!0),P.mutate(!0)},$=e=>{var s,a;if(!W)return void B();if(e&&(null!=(s=null==g?void 0:g.length)?s:0)===0)return void j.toast.error("Add an SSO provider before enabling Enforce SSO");if(e&&(null!=(a=null==b?void 0:b.length)?a:0)===0)return void j.toast.error("Add a verified domain before enabling Enforce SSO");if(e&&k)return void j.toast.error("Wait 6 hours after adding the SSO provider and thoroughly test the SSO login before enabling Enforce SSO");if(e){u(!0),p(!0);return}u(!1),P.mutate(!1)},q=(0,X.BK)(),B=()=>{q(X.KU.BIZ_SSO)},{isBizOrEnterprisePlan:W}=(0,eg.cb)(null==s?void 0:s.plan);return y?(0,t.jsx)(ee.Pt,{value:"identity",title:"Identity",description:"Manage your workspace identity and SSO.",children:(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsx)(es.Zp,{children:(0,t.jsx)(es.Wu,{className:"p-6",children:(0,t.jsxs)("div",{className:"text-center text-destructive-primary",children:["Error loading SSO providers: ",y.message]})})})})}):(0,t.jsxs)(ee.Pt,{value:"identity",title:"Identity",description:"Manage your workspace identity and SSO.",customBadge:(0,t.jsx)(ew.M,{workspace:s,requiredPlanCategory:"biz"}),children:[a.length<=1?null:(0,t.jsx)("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:a.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[s>0&&(0,t.jsx)(F.A,{name:"chevron_right",size:"small"}),s===a.length-1?(0,t.jsx)("span",{className:"font-medium text-foreground",children:e.title}):(0,t.jsx)("button",{onClick:()=>i(e=>e.slice(0,s+1)),className:"transition-colors hover:text-foreground",children:e.title})]},s))}),"list"===A.type&&(()=>{var e,a;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("h2",{className:"text-base font-medium",children:"SSO Providers"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Configure single sign-on providers for your workspace"})]}),(0,t.jsx)(eY.Q,{showTooltip:g.length>0,tooltipContent:"Only one SSO provider can be configured at a time. Delete the existing provider to add a new one.",children:(0,t.jsxs)(L.$,{onClick:D,variant:"secondary",disabled:g.length>0,children:[(0,t.jsx)(F.A,{name:"plus",size:"small"}),"Add Provider",g.length>0&&(0,t.jsx)(F.A,{name:"info",size:"small"})]})})]}),f?(0,t.jsxs)("div",{className:"py-8 text-center",children:[(0,t.jsx)(F.A,{name:"shield",size:"large",className:"mx-auto text-muted-foreground"}),(0,t.jsx)("h3",{className:"mt-2 text-base",children:"Loading SSO providers..."})]}):0===g.length?(0,t.jsxs)("div",{className:"py-8 text-center",children:[(0,t.jsx)(F.A,{name:"shield",size:"large",className:"mx-auto text-muted-foreground"}),(0,t.jsx)("h3",{className:"mt-2 text-base font-medium",children:"No SSO providers configured"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Get started by adding your first SSO provider to enable single sign-on for your workspace."})]}):(0,t.jsx)("div",{className:"flex flex-col gap-4",children:g.map(e=>{let s=(0,a8.xz)()+e.workspace_slug;return(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3 rounded-lg border p-4",children:[(0,t.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-muted",children:(e=>{switch(e){case"oidc":return(0,t.jsx)(F.A,{name:"shield"});case"saml":return(0,t.jsx)(F.A,{name:"key"});default:return(0,t.jsx)(F.A,{name:"cog"})}})(e.type)}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h4",{className:"font-medium",children:e.provider_id}),(0,t.jsx)(ep.E,{variant:"affirmative",children:"Active"})]}),(0,t.jsx)(L.$,{type:"button",variant:"ghost",size:"sm",className:"hover:bg-destructive hover:text-destructive-foreground",onClick:s=>{s.stopPropagation(),l(e.id)},children:"Delete"})]}),(0,t.jsxs)("div",{className:"mt-3 flex flex-wrap items-start gap-x-12 gap-y-4 text-sm",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,t.jsx)("div",{className:"text-muted-foreground",children:"Added"}),(0,t.jsx)("div",{children:new Date(e.created_at).toLocaleDateString()})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,t.jsx)("div",{className:"text-muted-foreground",children:"Login URL"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"",children:s}),(0,t.jsx)(en.i,{text:s})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:["JIT Default Role",(0,t.jsx)(a7.V,{name:"info_circle",delay:0,tooltipContentClassName:"max-w-xs",className:"text-muted-foreground",children:"This role will be automatically assigned to users who join through SSO for the first time"})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)(eD.l6,{value:e.default_jit_role||"member",disabled:!e.id||E.isPending,onValueChange:s=>{if(!e.id)return void j.toast.error("Cannot update role: Provider ID is missing");E.mutate({providerId:e.id,role:s})},children:[(0,t.jsx)(eD.wQ,{className:"h-5 w-[110px]",children:(0,t.jsxs)(eD.yv,{placeholder:"Select role",children:["viewer"===e.default_jit_role&&"Viewer","admin"===e.default_jit_role&&"Admin",(!e.default_jit_role||"member"===e.default_jit_role)&&"Editor"]})}),(0,t.jsxs)(eD.gC,{align:"start",alignOffset:-12,className:"w-32",children:[(0,t.jsx)(eD.eb,{value:"viewer",children:"Viewer"}),(0,t.jsx)(eD.eb,{value:"member",children:"Editor"}),(0,t.jsx)(eD.eb,{value:"admin",children:"Admin"})]})]})})]})]})]})]},e.id)})})]}),(0,t.jsx)(eU.w,{}),(0,t.jsx)(sR.A,{open:!!r,onOpenChange:e=>{e||l(null)},icon:"trash",title:"Delete SSO Provider",description:(0,t.jsx)(t.Fragment,{children:"Are you sure you want to delete this SSO provider? This action cannot be undone and will disable SSO authentication for this provider."}),confirmText:_.isPending?"Deleting...":"Delete",confirmVariant:"destructive",isLoading:_.isPending,onConfirm:M}),(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("h2",{className:"text-base font-medium",children:"Verified Domains"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Domains that are verified for SSO authentication"})]}),(0,t.jsxs)(L.$,{onClick:z,variant:"secondary",children:[(0,t.jsx)(F.A,{name:"plus",size:"small"}),"Add Domain"]})]}),N?(0,t.jsxs)("div",{className:"py-8 text-center",children:[(0,t.jsx)(F.A,{name:"link",size:"large",className:"mx-auto text-muted-foreground"}),(0,t.jsx)("h3",{className:"mt-2 text-base",children:"Loading verified domains..."})]}):w?(0,t.jsxs)("div",{className:"py-8 text-center",children:[(0,t.jsx)(F.A,{name:"error",size:"large",className:"mx-auto text-destructive"}),(0,t.jsx)("h3",{className:"mt-2 text-base text-destructive",children:"Error loading verified domains"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:w.message})]}):0===b.length?(0,t.jsxs)("div",{className:"py-8 text-center",children:[(0,t.jsx)(F.A,{name:"link",size:"large",className:"mx-auto text-muted-foreground"}),(0,t.jsx)("h3",{className:"mt-2 text-base",children:"No verified domains"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Add a verified domain to enable SSO authentication for your workspace."})]}):(0,t.jsx)("div",{className:"flex flex-col gap-4",children:b.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between rounded-lg border p-4 transition-colors hover:bg-muted/50",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-muted",children:(0,t.jsx)(F.A,{name:"link"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium leading-tight",children:e}),(0,t.jsx)("div",{className:"mt-1 flex items-center space-x-2",children:(0,t.jsx)(ep.E,{variant:"affirmative",children:"Verified"})})]})]}),(0,t.jsx)("div",{className:"flex items-center space-x-2",children:(0,t.jsx)(L.$,{variant:"ghost",size:"sm",className:"hover:bg-destructive-foreground/10 hover:text-destructive-foreground",onClick:()=>{c(e)},children:"Delete"})})]},e))})]}),(0,t.jsx)(sR.A,{open:!!o,onOpenChange:e=>{e||c(null)},icon:"trash",title:"Delete Verified Domain",description:(0,t.jsx)(t.Fragment,{children:"Are you sure you want to delete this verified domain? This action will disable SSO authentication for this domain."}),confirmText:S.isPending?"Deleting...":"Delete",confirmVariant:"destructive",isLoading:S.isPending,onConfirm:R}),(0,t.jsx)(eU.w,{}),(0,t.jsx)(eE.m,{label:"Enforce SSO",description:"Require all workspace members to use SSO for authentication. External collaborators and invite links will be disabled.",customBadge:k?(0,t.jsx)("span",{className:"text-sm text-yellow-600",children:"Wait 6 hours and test SSO login before enforcing SSO"}):null,justify:"end",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[g.length>0&&(0,t.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:["Session Duration",(0,t.jsx)(a7.V,{delay:0,name:"info_circle",className:"text-muted-foreground",children:"How long users stay signed in before being required to re-authenticate via SSO"})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)(eD.l6,{value:(null==(e=s.sso_session_duration)?void 0:e.toString())||"2880",disabled:I.isPending||!W,onValueChange:e=>{if(!W)return void B();I.mutate(parseInt(e))},children:[(0,t.jsx)(eD.wQ,{className:"h-5 w-[110px]",children:(0,t.jsx)(eD.yv,{children:(()=>{let e=s.sso_session_duration||2880,a=tm.find(s=>s.value===e);return(null==a?void 0:a.label)||"".concat(Math.round(e/1440)," days")})()})}),(0,t.jsx)(eD.gC,{align:"start",alignOffset:-12,className:"w-32",children:tm.map(e=>(0,t.jsx)(eD.eb,{value:e.value.toString(),children:e.label},e.value))})]})})]}),(0,t.jsx)(eZ.d,{checked:d,disabled:P.isPending,onCheckedChange:$})]})}),(0,t.jsx)(sR.A,{open:m,onOpenChange:e=>{e||(p(!1),u(!1))},icon:"shield",title:"Enable Enforce SSO",description:(0,t.jsxs)(t.Fragment,{children:["Make sure you have configured and tested your SSO provider properly. Turning this on will:",(0,t.jsxs)("ul",{className:"mt-2 list-inside list-disc space-y-1",children:[(0,t.jsx)("li",{children:"Require all members to sign in via SSO"}),(0,t.jsx)("li",{children:"Disable email/password authentication"}),(0,t.jsx)("li",{children:"Block external collaborators (non-workspace members)"}),(0,t.jsx)("li",{children:"Disable public invite links"})]})]}),confirmText:"Turn on",isLoading:P.isPending,onConfirm:U}),g.length>0&&(0,t.jsx)(eE.m,{label:"Just-in-Time Provisioning",description:"Automatically creates user accounts and adds them to company workspace when they sign in via SSO",justify:"end",children:(0,t.jsx)("div",{className:"flex items-center gap-4",children:(0,t.jsx)(eZ.d,{checked:!!(null==(a=g[0])?void 0:a.jit),disabled:!0})})})]})})(),"add-provider"===A.type&&(0,t.jsx)(tu,{workspace:s,onSuccess:()=>{x.invalidateQueries({queryKey:["sso-providers",s.id]}),O()},onCancel:T,verifiedDomains:b}),"add-domain"===A.type&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 border-b pb-4",children:[(0,t.jsx)("h2",{className:"text-base font-medium",children:"Add Verified Domain"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Add a new domain for SSO authentication"})]}),(0,t.jsx)(tu,{workspace:s,onSuccess:()=>{x.invalidateQueries({queryKey:["verified-domains",s.id]}),O()},onCancel:T,domainOnly:!0})]})]})};var tx=a(81818),th=a(92386),tj=a(69427),tg=a(57185),tf=a(35762);let tv=A.Ik({dataOptOut:A.zM().optional(),preventEditorInvite:A.zM().optional(),defaultProjectVisibility:A.k5(["public","private","draft"]).optional(),defaultProjectPublishVisibility:A.fc(tf.B).optional().nullable(),mcpEnabled:A.zM().optional(),externalPublishPermissionLevel:A.fc(tf.C).optional().nullable()}),ty=e=>{var s,a,i,n,r;let{workspace:l,membership:c}=e,{EditWorkspaceSettings:d,EditExternalPublishPermissionLevel:u,EditDefaultProjectPublishVisibility:m,EditDataOptOut:p,EditRestrictWorkspaceInvitations:x,FeatureEditDefaultProjectPublishVisibility:h,FeatureEditExternalPublishPermissionLevel:g,FeatureDataOptOut:f,FeatureToggleEditorCanInvite:y}=ev.eZ,{permitted:b}=(0,o.J)(h),{permitted:N}=(0,o.J)(g),{permitted:w}=(0,o.J)(f),{permitted:k}=(0,o.J)(y),{permitted:S}=(0,o.J)(d),{permitted:E}=(0,o.J)(m),{permitted:A}=(0,o.J)(u),{permitted:D}=(0,o.J)(p),{permitted:T}=(0,o.J)(x),{isBizOrEnterprisePlan:O}=(0,eg.cb)(l.plan),M=(0,X.BK)(),R=(0,tj.G)(l),U=S&&O,$=(0,I.mN)({defaultValues:{dataOptOut:null!=(s=l.data_opt_out)?s:void 0,preventEditorInvite:!(null==(a=l.editor_can_invite)||a),defaultProjectVisibility:R,defaultProjectPublishVisibility:O&&null!=(i=l.default_project_publish_visibility)?i:tf.B.Public,mcpEnabled:null==(n=l.mcp_enabled)||n,externalPublishPermissionLevel:null!=(r=l.external_publish_permission_level)?r:l.disable_publish?tf.C.Admin:tf.C.Editor},resolver:(0,P.u)(tv)}),{updateWorkspace:q,isUpdatingWorkspace:B}=function(e){let{form:s,workspaceId:a,quietSuccess:t=!1}=e,i=(0,ed.jE)(),{authUser:n}=(0,sp.Z2)(),{store:r}=(0,sP.k9)(),{mutate:l,isPending:o}=(0,C.n)({mutationFn:async e=>(0,v.P)().put("/user/workspaces/".concat(a),{...void 0!==e.dataOptOut&&{data_opt_out:e.dataOptOut},...void 0!==e.editor_can_invite&&{editor_can_invite:e.editor_can_invite},...void 0!==e.defaultProjectVisibility&&{default_project_visibility:e.defaultProjectVisibility},...void 0!==e.default_project_publish_visibility&&{default_project_publish_visibility:e.default_project_publish_visibility},...void 0!==e.mcp_enabled&&{mcp_enabled:e.mcp_enabled},...void 0!==e.external_publish_permission_level&&{external_publish_permission_level:e.external_publish_permission_level}}),onSuccess:e=>{var l,o,c,d,u,m;t||j.toast.success("Success",{description:"Privacy and security settings updated successfully"});let p=sc.y.detail({workspaceId:a,projectId:void 0}).queryKey;i.setQueryData(p,s=>s?{...s,workspace:e}:{workspace:e,is_member:!0,current_member:null});let x=sc.y.workspaces({userId:null==n?void 0:n.uid}).queryKey;i.setQueryData(x,s=>s?{workspaces:s.workspaces.map(s=>s.id===e.id?e:s)}:{workspaces:[e]});let h=(null!=(l=null==r?void 0:r.getState().workspaces)?l:[]).map(s=>s.id===e.id?e:s);null==r||r.setState({workspaces:h}),s.reset({dataOptOut:null!=(o=e.data_opt_out)?o:void 0,preventEditorInvite:!(null==(c=e.editor_can_invite)||c),defaultProjectVisibility:e.default_project_visibility,defaultProjectPublishVisibility:null!=(d=e.default_project_publish_visibility)?d:tf.B.Public,mcpEnabled:null==(u=e.mcp_enabled)||u,externalPublishPermissionLevel:null!=(m=e.external_publish_permission_level)?m:e.disable_publish?tf.C.Admin:tf.C.Editor})},onError:e=>{(0,_.Ni)(e),s.reset()}});return{updateWorkspace:l,isUpdatingWorkspace:o}}({form:$,workspaceId:l.id});return(0,t.jsx)(ee.Pt,{title:"Privacy & security",value:"privacy-security",description:"Manage privacy and security settings for your workspace.",children:(0,t.jsx)(z.lV,{...$,children:(0,t.jsxs)("form",{className:"flex w-full flex-col gap-6",onSubmit:$.handleSubmit(e=>{q({...e,editor_can_invite:void 0!==e.preventEditorInvite?!e.preventEditorInvite:void 0,default_project_publish_visibility:e.defaultProjectPublishVisibility,mcp_enabled:U?e.mcpEnabled:void 0,external_publish_permission_level:e.externalPublishPermissionLevel})}),children:[(0,t.jsx)(eE.m,{label:"Default project visibility",description:"Choose whether new projects start as public, private (workspace-only), or drafts.",justify:"end",mobileLayout:"horizontal",children:(0,t.jsx)(z.zB,{control:$.control,name:"defaultProjectVisibility",render:e=>{var s;let{field:a}=e;return(0,t.jsxs)(z.eI,{className:"flex w-full justify-end",children:[(0,t.jsx)(z.MJ,{children:(0,t.jsx)(th.j,{visibility:null!=(s=a.value)?s:"public",setVisibility:e=>{a.onChange(e)},workspacePlan:l.plan,workspace:l,disabled:!S,className:"md:ml-auto"})}),(0,t.jsx)(z.C5,{})]})}})}),(0,t.jsx)(eE.m,{label:"Default website access",description:"Choose if new published websites are public or only accessible to logged in workspace members.",customBadge:(0,t.jsx)(ew.M,{workspace:l,requiredPlanCategory:"biz"}),justify:"end",mobileLayout:"vertical",children:(0,t.jsx)(z.zB,{control:$.control,name:"defaultProjectPublishVisibility",render:e=>{var s;let{field:a}=e;return(0,t.jsxs)(z.eI,{className:"flex w-full justify-end",children:[(0,t.jsx)(z.MJ,{children:(0,t.jsxs)(eD.l6,{value:null!=(s=a.value)?s:tf.B.Public,onValueChange:e=>{if(e===tf.B.Private&&!b)return void M(X.KU.BIZ_WEBSITE_ACCESS);a.onChange(e)},disabled:!S||b&&!E,children:[(0,t.jsx)(eD.bq,{className:"min-w-[230px] md:max-w-fit",children:(0,t.jsx)(eD.yv,{})}),(0,t.jsx)(eD.gC,{align:"end",children:Object.entries(tg.O).map(e=>{let[s,a]=e;return(0,t.jsx)(eD.eb,{value:s,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(F.A,{name:a.icon,size:"small"}),(0,t.jsx)("span",{children:a.description}),s===tf.B.Private&&(0,t.jsx)(ew.M,{workspace:l,requiredPlanCategory:"biz"})]})},s)})})]})}),(0,t.jsx)(z.C5,{})]})}})}),(0,t.jsx)(eE.m,{label:"Who can publish externally",description:"Control who can publish and deploy projects to the web.",justify:"end",mobileLayout:"vertical",customBadge:(0,t.jsx)(ew.M,{workspace:l,requiredPlanCategory:"enterprise"}),children:(0,t.jsx)(z.zB,{control:$.control,name:"externalPublishPermissionLevel",render:e=>{var s;let{field:a}=e;return(0,t.jsxs)(z.eI,{className:"flex w-full justify-end",children:[(0,t.jsx)(z.MJ,{children:(0,t.jsxs)(eD.l6,{value:null!=(s=a.value)?s:tf.C.Editor,onValueChange:e=>{if(e!==tf.C.Editor&&!A&&!N)return void M(X.KU.ENTERPRISE_PUBLISH_PERMISSION_LEVEL);a.onChange(e)},disabled:!S,children:[(0,t.jsx)(eD.bq,{className:"min-w-[230px] md:max-w-fit",children:(0,t.jsx)(eD.yv,{})}),(0,t.jsxs)(eD.gC,{align:"end",children:[(0,t.jsx)(eD.eb,{value:tf.C.Editor,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(F.A,{name:"edit",size:"small"}),(0,t.jsx)("span",{children:"Editors and above"})]})}),(0,t.jsx)(eD.eb,{value:tf.C.Admin,disabled:N&&!A,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(F.A,{name:"shield",size:"small"}),(0,t.jsx)("span",{children:"Admins and owners"}),(0,t.jsx)(ew.M,{workspace:l,requiredPlanCategory:"enterprise"})]})}),(0,t.jsx)(eD.eb,{value:tf.C.Owner,disabled:N&&!A,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(F.A,{name:"crown",size:"small"}),(0,t.jsx)("span",{children:"Owners only"}),(0,t.jsx)(ew.M,{workspace:l,requiredPlanCategory:"enterprise"})]})})]})]})}),(0,t.jsx)(z.C5,{})]})}})}),(0,t.jsx)(e7.E,{permission:d,children:(0,t.jsx)(eE.m,{label:"Data collection opt out",description:"Opt out of data collection for this workspace.",justify:"end",mobileLayout:"horizontal",customBadge:(0,t.jsx)(ew.M,{workspace:l,requiredPlanCategory:"biz"}),children:(0,t.jsx)(z.zB,{control:$.control,name:"dataOptOut",render:e=>{var s;let{field:a}=e;return(0,t.jsx)(z.eI,{children:(0,t.jsx)(z.MJ,{children:(0,t.jsx)(eZ.d,{disabled:!S||w&&!D,checked:null!=(s=a.value)&&s,onCheckedChange:e=>{if(!w)return void M(X.KU.BIZ_DATA_OPT_OUT);a.onChange(e)}})})})}})})}),(0,t.jsx)(e7.E,{permission:d,children:(0,t.jsx)(eE.m,{label:"Restrict workspace invitations",description:"When enabled, only admins and owners can invite members to this workspace.",mobileLayout:"horizontal",justify:"end",customBadge:(0,t.jsx)(ew.M,{workspace:l,requiredPlanCategory:"enterprise"}),children:(0,t.jsx)(z.zB,{control:$.control,name:"preventEditorInvite",render:e=>{var s;let{field:a}=e;return(0,t.jsx)(eZ.d,{checked:null!=(s=a.value)&&s,disabled:!S||k&&!T,onCheckedChange:e=>{if(!k)return void M(X.KU.ENTERPRISE_RESTRICT_INVITATIONS);a.onChange(e)}})}})})}),(0,t.jsx)(eE.m,{label:"MCP servers access",description:"Enable or disable MCP servers for all workspace members.",mobileLayout:"horizontal",justify:"end",customBadge:(0,t.jsx)(ew.M,{workspace:l,requiredPlanCategory:"biz"}),className:O?"":"opacity-50",children:(0,t.jsx)(z.zB,{control:$.control,name:"mcpEnabled",render:e=>{var s;let{field:a}=e;return(0,t.jsx)(eZ.d,{checked:null==(s=a.value)||s,onCheckedChange:a.onChange,disabled:!U})}})}),$.formState.isDirty&&(0,t.jsx)(eE.E,{children:(0,t.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,t.jsx)(L.$,{variant:"secondary",type:"button",onClick:()=>{$.reset()},children:"Cancel"}),(0,t.jsx)(L.$,{variant:"affirmative",type:"submit",loading:B,children:"Update"})]})})]})})})};var tb=a(50562),tN=a(64021);let tw=e=>{let{workspace:s}=e,{openSettings:a}=(0,c.t)(),{data:i,isLoading:n}=(0,eF.I)({...sc.y.templates({workspaceId:s.id}),permission:ev.eZ.ViewWorkspaceProjects});return(0,t.jsx)(e7.E,{plans:[sl.lV,so.VL.ENTERPRISE],fallback:(0,t.jsx)(ee.Pt,{title:"Templates",value:"templates",description:"Browse and manage team templates, used to start new projects. Publish new templates from settings.",customBadge:s&&(0,t.jsx)(ew.M,{workspace:s,requiredPlanCategory:"biz"}),children:(0,t.jsxs)("div",{className:"flex h-full flex-col items-center justify-center gap-2 text-muted-foreground",children:[(0,t.jsx)(F.A,{name:"file_export",size:"large"}),(0,t.jsx)("p",{className:"text-center text-sm",children:"To start using templates, upgrade to a Business or Enterprise plan."}),(0,t.jsx)(L.$,{onClick:()=>a("billing"),variant:"twilight",className:"mt-2",children:"Upgrade"})]})}),children:(0,t.jsx)(ee.Pt,{title:"Templates",value:"templates",description:"Browse and manage team templates, used to start new projects. Publish new templates from settings.",badge:"business",children:(0,t.jsxs)("div",{className:"grid flex-1 grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:[n&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(tb.p,{mainSkeletonClassName:"h-auto"}),(0,t.jsx)(tb.p,{mainSkeletonClassName:"h-auto"}),(0,t.jsx)(tb.p,{mainSkeletonClassName:"h-auto"}),(0,t.jsx)(tb.p,{mainSkeletonClassName:"h-auto"}),(0,t.jsx)(tb.p,{mainSkeletonClassName:"h-auto"}),(0,t.jsx)(tb.p,{mainSkeletonClassName:"h-auto"})]}),!n&&(i&&i.length>0?i.map(e=>(0,t.jsx)(tN.U,{project:e,subtitleType:"created-by"},e.id)):(0,t.jsxs)("div",{className:"col-span-full flex h-full flex-col items-center justify-center gap-2 text-muted-foreground",children:[(0,t.jsx)(F.A,{name:"file_export",size:"large"}),(0,t.jsx)("p",{className:"text-center text-sm",children:"No templates found. Mark projects as templates to get started."})]}))]})})})};var tk=a(49974),tC=a(77985),t_=a(21921),tS=a(89931),tE=a(65949),tP=a(5377);let tI=n.forwardRef((e,s)=>{let{className:a,value:i,...n}=e;return(0,t.jsx)(tP.bL,{ref:s,className:(0,eI.cn)("relative h-4 w-full overflow-hidden rounded-full bg-muted-active",a),...n,children:(0,t.jsx)(tP.C1,{className:"h-full w-full flex-1 bg-brand-twilight-primary transition-all",style:{transform:"translateX(-".concat(100-(i||0),"%)")}})})});tI.displayName=tP.bL.displayName;var tA=a(33966);let tL=e=>{let{onClose:s}=e,a=(0,tA.X5)();return(0,t.jsxs)("div",{className:"flex flex-col gap-1 rounded-lg bg-warning p-4 text-warning-foreground",children:[(0,t.jsx)("div",{className:"text-base font-medium",children:"Need build credits?"}),(0,t.jsxs)("div",{className:"text-sm",children:["This top-up adds Cloud and AI balance. For build credits, visit"," ",(0,t.jsx)("button",{type:"button",onClick:()=>{s(),a({scenario:tA.Cb.PAID_MONTHLY_LIMIT})},className:"underline",children:"Plans & credits"})]})]})},tD=A.Ik({enabled:A.zM(),amount:A.au.number().min(0,"Top-up amount must be greater than or equal to 0"),monthly_limit:A.au.number().min(0,"Monthly limit must be greater than or equal to 0")}).superRefine((e,s)=>{e.enabled&&(e.monthly_limit<e.amount&&s.addIssue({code:tE.eq.custom,message:"Monthly limit must be at least $".concat(Math.round(e.amount)),path:["monthly_limit"]}),e.monthly_limit<10&&s.addIssue({code:tE.eq.custom,message:"Monthly limit must be at least $".concat(10),path:["monthly_limit"]}),e.amount<10&&s.addIssue({code:tE.eq.custom,message:"Top-up amount must be at least $".concat(10),path:["amount"]}),e.amount>1e3&&s.addIssue({code:tE.eq.custom,message:"Top-up amount cannot be higher than $".concat(1e3),path:["amount"]}),e.monthly_limit>1e4&&s.addIssue({code:tE.eq.custom,message:"Monthly limit cannot be higher than $".concat(1e4),path:["monthly_limit"]}))}),tz=e=>{let{workspaceId:s,onClose:a}=e,i=(0,ed.jE)(),r=(0,v.P)(),l=(0,I.mN)({resolver:(0,P.u)(tD),mode:"onChange",defaultValues:{enabled:!1,amount:20,monthly_limit:100}}),o=new Date,c=new Date(o.getFullYear(),o.getMonth()+1,1,0,0,0,0),d=(0,tS.JC)(c),{data:u,isLoading:m}=(0,sT.I)(sc.y.autoTopup({workspaceId:s}));(0,n.useEffect)(()=>{if(u){var e;l.reset({enabled:null!=(e=u.enabled)&&e,amount:u.amount&&u.amount>0?u.amount:20,monthly_limit:u.monthly_limit&&u.monthly_limit>0?u.monthly_limit:100})}},[u,l.reset]);let p=l.watch(),x=l.formState.defaultValues,h=(null==x?void 0:x.enabled)!==p.enabled,g=(null==x?void 0:x.amount)!==p.amount,f=(null==x?void 0:x.monthly_limit)!==p.monthly_limit,y=h||p.enabled&&(g||f),b=l.formState.isValid,N=(0,C.n)({mutationFn:async e=>await r.put("/workspaces/".concat(s,"/balance/auto-topup"),{threshold:10,amount:e.amount,monthly_limit:e.monthly_limit,enabled:e.enabled}),onSuccess:(e,t)=>{j.toast.success(e.message||"Automatic top-up settings updated successfully"),l.reset(t),a(),i.invalidateQueries({queryKey:["workspace",s,"auto-topup"]})},onError:e=>{(0,_.Ni)(e)}}),w=async e=>{await N.mutateAsync(e)};return m?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4 pt-4",children:[(0,t.jsxs)("div",{className:"flex flex-1 flex-col gap-2",children:[(0,t.jsx)(ez.E,{className:"h-5 w-40"}),(0,t.jsx)(ez.E,{className:"h-4 w-full max-w-md"})]}),(0,t.jsx)(ez.E,{className:"h-6 w-11 rounded-full"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ez.E,{className:"h-4 w-24"}),(0,t.jsx)(ez.E,{className:"h-10 w-full"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ez.E,{className:"h-4 w-32"}),(0,t.jsx)(ez.E,{className:"h-10 w-full"})]})]}),(0,t.jsx)(eU.w,{}),(0,t.jsxs)("div",{className:"rounded-lg bg-muted p-4",children:[(0,t.jsx)(ez.E,{className:"mb-2 h-5 w-20"}),(0,t.jsx)(ez.E,{className:"h-7 w-32"})]}),(0,t.jsx)(ez.E,{className:"h-20 w-full"}),(0,t.jsxs)("div",{className:"flex w-full justify-between gap-2 pt-4",children:[(0,t.jsx)(ez.E,{className:"h-10 flex-1"}),(0,t.jsx)(ez.E,{className:"h-10 flex-1"})]})]}):(0,t.jsx)(z.lV,{...l,children:(0,t.jsxs)("form",{onSubmit:l.handleSubmit(w),className:"flex min-h-[450px] flex-col",children:[(0,t.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,t.jsx)(z.zB,{control:l.control,name:"enabled",render:e=>{let{field:s}=e;return(0,t.jsx)(z.eI,{children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4 pt-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-base font-medium",children:[(0,t.jsx)(z.lR,{htmlFor:"auto-topup-enabled",className:"m-0",children:"Automatic top-up"}),(0,t.jsx)(a7.V,{name:"info",size:"small",children:"Your default payment method will be automatically charged when your balance drops below $10, provided you have not reached your monthly charge limit."})]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Automatically add funds when your balance drops below $",10,"."]})]}),(0,t.jsx)(z.MJ,{children:(0,t.jsx)(eZ.d,{id:"auto-topup-enabled",checked:s.value,onCheckedChange:e=>{s.onChange(e),l.trigger(["amount","monthly_limit"])}})})]})})}}),(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(z.zB,{control:l.control,name:"amount",render:e=>{var s,a;let{field:i,fieldState:n}=e;return(0,t.jsxs)(z.eI,{children:[(0,t.jsxs)("div",{className:"flex h-5 items-center gap-2",children:[(0,t.jsx)(z.lR,{children:"Top-up amount"}),n.error&&(0,t.jsx)(a7.V,{name:"warning",size:"small",className:"text-destructive-primary",children:n.error.message})]}),(0,t.jsx)(z.MJ,{children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-sm text-muted-foreground",children:"$"}),g&&(0,t.jsxs)("div",{className:"absolute left-6 top-1/2 flex -translate-y-1/2 items-center gap-1 whitespace-nowrap text-sm text-muted-foreground",children:[(0,t.jsx)("span",{className:"line-through opacity-60",children:null==(s=l.formState.defaultValues)?void 0:s.amount}),(0,t.jsx)("span",{children:"â†’"})]}),(0,t.jsx)(T.p,{type:"number",min:"0",step:"5",...i,value:null!=(a=i.value)?a:"",onChange:e=>{let s=""===e.target.value?0:Number(e.target.value);!isNaN(s)&&s>=0&&i.onChange(s)},className:"bg-muted text-right font-medium ".concat(g?"pl-20":"pl-6"," ").concat(n.error?"!border-destructive-primary focus:!border-destructive-primary focus-visible:!ring-destructive-primary":""),placeholder:"Custom",disabled:!p.enabled})]})})]})}}),(0,t.jsx)(z.zB,{control:l.control,name:"monthly_limit",render:e=>{var s,a;let{field:i,fieldState:n}=e;return(0,t.jsxs)(z.eI,{children:[(0,t.jsxs)("div",{className:"flex h-5 items-center gap-2",children:[(0,t.jsx)(z.lR,{children:"Monthly charge limit"}),n.error&&(0,t.jsx)(a7.V,{name:"warning",size:"small",className:"text-destructive-primary",children:n.error.message})]}),(0,t.jsx)(z.MJ,{children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-sm text-muted-foreground",children:"$"}),f&&(0,t.jsxs)("div",{className:"absolute left-6 top-1/2 flex -translate-y-1/2 items-center gap-1 whitespace-nowrap text-sm text-muted-foreground",children:[(0,t.jsx)("span",{className:"line-through opacity-60",children:null==(s=l.formState.defaultValues)?void 0:s.monthly_limit}),(0,t.jsx)("span",{children:"â†’"})]}),(0,t.jsx)(T.p,{type:"number",min:"0",step:"5",...i,value:null!=(a=i.value)?a:"",onChange:e=>{let s=""===e.target.value?0:Number(e.target.value);!isNaN(s)&&s>=0&&i.onChange(s)},className:"bg-muted text-right font-medium ".concat(f?"pl-20":"pl-6"," ").concat(n.error?"!border-destructive-primary focus:!border-destructive-primary focus-visible:!ring-destructive-primary":""),placeholder:"Custom",disabled:!p.enabled})]})})]})}})]}),u&&u.monthly_limit>0?(()=>{var e;let s=null!=(e=u.current_month_spend)?e:0,a=u.monthly_limit,i=s>=a,n=s>=.8*a;return(0,t.jsxs)("div",{className:"flex flex-col gap-2 rounded-lg border bg-muted/50 p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Charges this month"}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:["$",s," / $",a]})]}),(0,t.jsx)(tI,{value:s/a*100,className:"h-2 ".concat(i?"[&>*]:bg-destructive":n?"[&>*]:bg-warning":"[&>*]:bg-primary")}),(0,t.jsx)("div",{className:"flex flex-col gap-1",children:i?(0,t.jsxs)("p",{className:"text-xs text-destructive-primary",children:["Monthly charge limit reached. Automatic top-up will not trigger until ",d," ","or you increase your limit."]}):(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Monthly charge period resets ",d]})})]})})():(0,t.jsx)("div",{className:"flex flex-col gap-2 rounded-lg border border-dashed bg-muted/30 p-4",children:(0,t.jsx)("div",{className:"flex flex-col gap-1 text-center",children:(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Enable automatic top-up to track your monthly charges here"})})})]})]}),(0,t.jsxs)("div",{className:"mt-auto space-y-4",children:[(0,t.jsx)(tL,{onClose:a}),(0,t.jsxs)(D.Es,{className:"flex w-full justify-between gap-2",children:[(0,t.jsx)(L.$,{variant:"secondary",type:"button",className:"flex-1",onClick:a,children:"Close"}),(0,t.jsx)(L.$,{type:"submit",className:"flex-1",disabled:N.isPending||!y||!b,children:N.isPending?"Saving...":"Save"})]})]})]})})},tF=e=>{let{workspaceId:s,currentBalance:a,onClose:i}=e,[r,l]=(0,n.useState)(20),o=(0,ed.jE)(),c=(0,v.P)(),d=a+r,u=(0,C.n)({mutationFn:async e=>{let a=Math.round(100*e),t=new URL(window.location.href);return t.searchParams.set("settings","usage"),await c.post("/workspaces/".concat(s,"/balance/topup"),{amount:a,return_url:t.toString()})},onSuccess:async e=>{j.toast.success("Top-up initiated successfully. You'll be redirected to the payment page."),i(),l(20),await o.invalidateQueries({queryKey:sc.y.workspaceLovableCloudUsage({workspaceId:s}).queryKey}),e.checkout_url&&"string"==typeof e.checkout_url&&window.location.assign(e.checkout_url)},onError:e=>{(0,_.Ni)(e)}}),m=async()=>r<10?void j.toast.error("Minimum top-up amount is $".concat(10)):r>1e3?void j.toast.error("Maximum top-up amount is $".concat(1e3.toLocaleString())):void await u.mutateAsync(r);return(0,t.jsxs)("div",{className:"flex min-h-[450px] flex-col",children:[(0,t.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2 py-3",children:[(0,t.jsx)("div",{className:"text-base font-medium",children:"Top up"}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-sm text-muted-foreground",children:"$"}),(0,t.jsx)(T.p,{type:"number",min:10,max:1e3,value:r||"",onChange:e=>{let s=""===e.target.value?0:Number(e.target.value);!isNaN(s)&&s>=0&&l(s)},onBlur:e=>{let s=Number(e.target.value);s>0&&s<10?(l(10),j.toast.error("Minimum top-up amount is $".concat(10))):s>1e3&&(l(1e3),j.toast.error("Maximum top-up amount is $".concat(1e3.toLocaleString())))},className:"w-16 bg-muted pl-6 text-right font-medium sm:w-28",placeholder:"Custom"})]}),(0,t.jsx)("div",{className:"flex gap-2",children:[10,20,50].map(e=>(0,t.jsxs)(L.$,{variant:r===e?"default":"secondary",onClick:()=>l(e),className:"w-fit sm:w-16",children:["$",e]},e))})]})]}),(0,t.jsx)(eU.w,{}),(0,t.jsxs)("div",{className:"rounded-lg bg-muted p-4 text-base",children:[(0,t.jsx)("div",{className:"mb-2 text-base font-medium",children:"Summary"}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsxs)("div",{className:"mb-0.5 flex items-center justify-between text-muted-foreground",children:[(0,t.jsx)("span",{className:"",children:"Current balance"}),(0,t.jsxs)("span",{children:["$",a.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-muted-foreground",children:[(0,t.jsx)("span",{className:"",children:"Added funds"}),(0,t.jsxs)("span",{children:["$",r.toFixed(2)]})]}),(0,t.jsx)(eU.w,{}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"",children:"New balance"}),(0,t.jsxs)("span",{className:"",children:["$",d.toFixed(2)]})]})]})]})]}),(0,t.jsxs)("div",{className:"mt-auto space-y-4",children:[(0,t.jsx)(tL,{onClose:i}),(0,t.jsxs)(D.Es,{className:"flex w-full justify-between gap-2",children:[(0,t.jsx)(L.$,{variant:"secondary",className:"flex-1",onClick:i,children:"Close"}),(0,t.jsx)(L.$,{className:"flex-1",onClick:m,disabled:u.isPending||r<10||r>1e3,children:u.isPending?"Processing...":"Add $".concat(r," to balance")})]})]})]})},tT=e=>{let{open:s,onOpenChange:a,workspaceId:i,currentBalance:r}=e,[l,o]=(0,n.useState)("one-time");return(0,t.jsx)(D.lG,{open:s,onOpenChange:a,children:(0,t.jsxs)(D.Cf,{size:"md",className:"gap-3",children:[(0,t.jsxs)(D.c7,{children:[(0,t.jsx)(D.L3,{className:"text-xl leading-none",children:"Add Cloud & AI balance"}),(0,t.jsx)(D.rr,{className:"text-sm",children:"Add funds to your workspace for AI and cloud services."})]}),(0,t.jsxs)(s2.tU,{value:l,onValueChange:o,className:"w-full",children:[(0,t.jsxs)(s2.j7,{className:"grid w-full grid-cols-2 bg-muted",children:[(0,t.jsx)(s2.Xi,{value:"one-time",children:"One-time top-up"}),(0,t.jsx)(s2.Xi,{value:"auto-topup",children:"Automatic top-up"})]}),(0,t.jsx)(s2.av,{value:"one-time",className:"space-y-4",children:(0,t.jsx)(tF,{workspaceId:i,currentBalance:r,onClose:()=>a(!1)})}),(0,t.jsx)(s2.av,{value:"auto-topup",className:"space-y-4",children:(0,t.jsx)(tz,{workspaceId:i,onClose:()=>a(!1)})})]})]})})},tO=e=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}).format(e),tM=e=>{var s,a,r,l;let{workspace:o}=e,{activeTab:d}=(0,c.t)(),{createPortalSession:u,isCreatePortalSessionLoading:m}=(0,tk.et)(),{isEnterprisePlan:p,isPaidPlan:h}=(0,eg.cb)(o.plan),g=(0,t_.s)(),f=!p&&h&&g,v=async()=>{await u()},{data:y,isLoading:b,refetch:N}=(0,eF.I)({...sc.y.workspaceLovableCloudUsage({workspaceId:o.id}),permission:ev.eZ.ViewWorkspaceUsage,enabled:"usage"===d,staleTime:5e3,refetchOnMount:"always"}),[w,k]=(0,n.useState)(!1),C=(0,i.useRouter)(),_=(0,i.usePathname)(),S=(0,i.useSearchParams)();(0,n.useEffect)(()=>{let e=S.get("status"),s=S.get("checkout_session_id");if(!e||!s)return;let a=new URLSearchParams(S.toString());if(a.delete("status"),a.delete("checkout_session_id"),C.replace("".concat(_,"?").concat(a.toString())),"success"===e){let e;j.toast.success("Payment successful! Your balance is being updated...");let s=(null==y?void 0:y.available_balance)||0,a=[2e3,3e3,5e3,1e4],t=!1,i=n=>{t||n>=a.length||(e=setTimeout(async()=>{let e=await N();if(!t){if(e.data&&e.data.available_balance!==s){j.toast.success("Balance updated successfully!"),t=!0;return}i(n+1)}},a[n]))};return i(0),()=>{t=!0,e&&clearTimeout(e)}}},[S,_,C,N]),(0,n.useEffect)(()=>{if("1"===S.get("openTopUp")&&!w){k(!0);let e=new URLSearchParams(S.toString());e.delete("openTopUp"),C.replace("".concat(_,"?").concat(e.toString()))}},[S,w,_,C]);let E=(0,n.useMemo)(()=>{let e=new Date,s=new Date(Date.UTC(e.getFullYear(),e.getMonth()+1,1));return(0,tS.JC)(s)},[]),[P,I]=(0,n.useState)(0),[A,D]=(0,n.useState)([void 0]),[z,T]=(0,n.useState)(!1),[O,M]=(0,n.useState)(!1),R=A[P],{data:U,isLoading:$}=(0,eF.I)({...sc.y.lovableCloudProjectUsageBreakdown({workspaceId:o.id,limit:5,startAfter:R}),permission:ev.eZ.ViewWorkspaceUsage,enabled:"usage"===d&&(z||O),staleTime:1e4}),q=null!=(a=null==y?void 0:y.available_balance)?a:0,B=null!=(r=null==y?void 0:y.cloud_usage)?r:{free:0,used:0,billed:0},W=null!=(l=null==y?void 0:y.ai_gateway_usage)?l:{free:0,used:0,billed:0},G=Math.min(B.used,B.free),K=Math.min(W.used,W.free);return(0,t.jsx)(ee.Pt,{value:"usage",title:"Cloud & AI balance",description:(0,t.jsxs)(t.Fragment,{children:["All plans include free monthly usage. For increased Cloud and AI usage, you can top up on paid plans.",h&&(0,t.jsxs)(t.Fragment,{children:[" ",(0,t.jsx)("button",{type:"button",onClick:v,disabled:m,className:"text-primary underline hover:text-primary/80 disabled:cursor-not-allowed disabled:opacity-50",children:"See invoice history and manage payment preferences"})]})]}),docsLink:"https://docs.lovable.dev/features/cloud",children:(0,t.jsxs)("div",{className:"mx-auto flex w-full flex-col gap-6 lg:max-w-[888px]",children:[(0,t.jsx)(tC.A,{cloudFree:B.free,cloudUsed:B.used,cloudBilled:B.billed,aiFree:W.free,aiUsed:W.used,aiBilled:W.billed,balance:q,onAddFunds:()=>k(!0),isLoading:b}),(0,t.jsxs)("div",{className:"flex flex-col gap-6 lg:grid lg:grid-cols-5",children:[(0,t.jsx)(es.Zp,{className:"col-span-2 rounded-xl bg-muted p-4 shadow-sm",children:(0,t.jsxs)("div",{className:"flex h-full flex-col justify-between gap-4",children:[(0,t.jsx)("div",{className:"flex flex-col gap-3",children:(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsx)("div",{className:"flex w-full items-center justify-between gap-3",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(eb.default,{src:"/img/logo/lovable-logo-icon.svg",alt:"Lovable",width:36,height:36,className:"h-11 w-11 p-1"}),(0,t.jsxs)("div",{className:"flex flex-col leading-snug",children:[(0,t.jsx)("span",{className:"text-lg font-medium",children:"Cloud + AI"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:b?(0,t.jsx)(ez.E,{className:"h-[19.25px] w-24"}):(0,t.jsxs)(t.Fragment,{children:["Monthly included usage resets ",E]})})]})]})})})}),!p&&g&&(0,t.jsx)("div",{className:"flex items-end justify-between",children:h?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(L.$,{variant:"outline",size:"default",className:"bg-background",onClick:()=>k(!0),children:"Top up"}),(0,t.jsxs)("div",{className:"mt-1 flex flex-col gap-1 pr-1 md:items-end",children:[b?(0,t.jsx)(ez.E,{className:"ml-auto h-8 w-20"}):(0,t.jsxs)("div",{className:"text-right text-2xl font-medium tabular-nums leading-none",children:["$",tO(q)]}),(0,t.jsx)("span",{className:"text-right text-sm text-muted-foreground",children:"Top-up balance"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mt-1 flex flex-col gap-1 pr-1 md:items-end",children:(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Upgrade to top up your balance (",b?(0,t.jsx)(ez.E,{className:"inline-block h-[18px] w-4 align-middle"}):(0,t.jsxs)("span",{className:"mb-px inline-block align-middle",children:["$",tO(q)]}),")."]})}),(0,t.jsx)(L.$,{asChild:!0,size:"default",variant:"outline",className:"bg-background",children:(0,t.jsx)(x(),{href:"?settings=billing",children:"Upgrade plan"})})]})})]})}),(0,t.jsx)(es.Zp,{className:"col-span-3 rounded-xl bg-muted p-4 shadow-sm outline outline-1 outline-offset-[-1px] outline-border",children:(0,t.jsx)("div",{className:"flex h-full flex-col gap-4",children:(0,t.jsxs)("div",{className:"flex flex-col gap-4 overflow-hidden rounded-lg",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-2 px-1 text-base md:gap-3 ".concat(h?"md:grid-cols-[1fr_115px_115px]":"md:grid-cols-[1fr_115px]"),children:[(0,t.jsxs)("div",{className:"flex items-start gap-0.5 text-lg font-medium",children:[(0,t.jsx)("span",{children:"Cloud"}),(0,t.jsxs)(ei.m_,{children:[(0,t.jsx)(ei.k$,{asChild:!0,children:(0,t.jsx)("button",{type:"button",className:"mt-px rounded-full p-1 text-muted-foreground transition-colors hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","aria-label":"Cloud usage updates daily",children:(0,t.jsx)(F.A,{name:"info",size:"small"})})}),(0,t.jsx)(ei.ZI,{children:"Cloud usage updates daily. Recent Cloud usage may take a while to appear."})]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-start md:items-end",children:[(0,t.jsx)("div",{className:"text-lg font-medium tabular-nums md:text-right",children:b?(0,t.jsx)(ez.E,{className:"h-[27px] w-[80px]"}):(0,t.jsx)("span",{className:"inline-block min-w-[80px]",children:"$".concat(tO(G)," / $").concat(tO(B.free))})}),(0,t.jsx)("div",{className:"pb-px text-sm text-muted-foreground",children:"Free balance used"})]}),h&&(0,t.jsxs)("div",{className:"flex flex-col items-start md:items-end",children:[(0,t.jsx)("div",{className:"text-lg font-medium tabular-nums md:text-right",children:b?(0,t.jsx)(ez.E,{className:"h-[27px] w-[80px]"}):(0,t.jsx)("span",{className:"inline-block min-w-[80px]",children:"$".concat(tO(B.billed))})}),(0,t.jsx)("div",{className:"pb-px text-sm text-muted-foreground",children:"Top-ups used"})]})]}),(0,t.jsx)(eU.w,{}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-2 px-1 text-base md:gap-3 ".concat(h?"md:grid-cols-[1fr_115px_115px]":"md:grid-cols-[1fr_115px]"),children:[(0,t.jsxs)("div",{className:"flex items-start gap-0.5 text-lg font-medium",children:[(0,t.jsx)("span",{children:"AI"}),(0,t.jsxs)(ei.m_,{children:[(0,t.jsx)(ei.k$,{asChild:!0,children:(0,t.jsx)("button",{type:"button",className:"mt-px rounded-full p-1 text-muted-foreground transition-colors hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","aria-label":"AI usage updates continuously",children:(0,t.jsx)(F.A,{name:"info",size:"small"})})}),(0,t.jsx)(ei.ZI,{children:"AI usage updates continuously."})]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-start md:items-end",children:[(0,t.jsx)("div",{className:"text-lg font-medium tabular-nums md:text-right",children:b?(0,t.jsx)(ez.E,{className:"h-[27px] w-[80px]"}):(0,t.jsx)("span",{className:"inline-block min-w-[80px]",children:"$".concat(tO(K)," / $").concat(tO(W.free))})}),(0,t.jsx)("div",{className:"pb-px text-sm text-muted-foreground",children:"Free balance used"})]}),h&&(0,t.jsxs)("div",{className:"flex flex-col items-start md:items-end",children:[(0,t.jsx)("div",{className:"text-lg font-medium tabular-nums md:text-right",children:b?(0,t.jsx)(ez.E,{className:"h-[27px] w-[80px]"}):(0,t.jsx)("span",{className:"inline-block min-w-[80px]",children:"$".concat(tO(W.billed))})}),(0,t.jsx)("div",{className:"pb-px text-sm text-muted-foreground",children:"Top-ups used"})]})]})]})})})]}),(0,t.jsx)("div",{className:"flex flex-col gap-3",children:(0,t.jsxs)(es.Zp,{className:"flex flex-col gap-0 rounded-xl bg-muted p-2 shadow-sm transition-colors",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)(L.$,{variant:"secondary",size:"lg",onClick:e=>{e.stopPropagation(),T(!z)},onMouseEnter:()=>M(!0),onMouseLeave:()=>M(!1),className:"flex w-full items-center justify-between gap-2 px-3 shadow-none",children:[(0,t.jsx)("div",{className:"text-base font-medium",children:"Project breakdown"}),(0,t.jsx)(F.A,{name:"chevron_left",size:"default",className:(0,eI.cn)("transition-transform duration-200",z&&"-rotate-90")})]})}),z&&(0,t.jsxs)("div",{className:"flex flex-col gap-0 p-0",children:[(0,t.jsxs)("div",{className:"grid grid-cols-[1fr_120px_120px] items-center gap-2 p-3 text-sm text-muted-foreground",children:[(0,t.jsx)("div",{className:"font-medium",children:"Project"}),(0,t.jsx)("div",{className:"text-right",children:"Lovable AI Usage"}),(0,t.jsx)("div",{className:"text-right",children:"Cloud Usage"})]}),$?Array.from({length:5}).map((e,s)=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"px-3",children:(0,t.jsx)(eU.w,{className:"bg-muted-border"})}),(0,t.jsxs)("div",{className:"grid grid-cols-[1fr_120px_120px] items-center gap-2 rounded-md px-3 py-3 text-base leading-tight",children:[(0,t.jsx)(ez.E,{className:"h-5 w-32"}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)(ez.E,{className:"h-5 w-12"})}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)(ez.E,{className:"h-5 w-12"})})]},s)]})):null==U||null==(s=U.projects)?void 0:s.map(e=>{let s=e.project_display_name||e.project_name;return(0,t.jsxs)(n.Fragment,{children:[(0,t.jsx)("div",{className:"px-3",children:(0,t.jsx)(eU.w,{className:"bg-muted-border"})}),e.deleted_at?(0,t.jsxs)("div",{className:"group grid grid-cols-[1fr_120px_120px] items-center gap-2 rounded-md px-3 py-3 text-base leading-tight",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"truncate text-muted-foreground",children:s}),(0,t.jsx)(ep.E,{variant:"default",children:"Deleted"})]}),(0,t.jsxs)("div",{className:"text-right",children:["$",e.ai_gateway_usage.toFixed(2)]}),(0,t.jsxs)("div",{className:"pr-1 text-right",children:["$",e.cloud_usage.toFixed(2)]})]}):(0,t.jsxs)(x(),{href:"/projects/".concat(e.project_id),target:"_blank",rel:"noopener noreferrer",className:"group grid cursor-pointer grid-cols-[1fr_120px_120px] items-center gap-2 rounded-md px-3 py-3 text-base leading-tight transition-all duration-200 ease-in-out hover:bg-muted-active",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("span",{className:"truncate text-primary",children:s})}),(0,t.jsxs)("div",{className:"text-right",children:["$",e.ai_gateway_usage.toFixed(2)]}),(0,t.jsxs)("div",{className:"pr-1 text-right",children:["$",e.cloud_usage.toFixed(2)]})]})]},e.project_id)}),!$&&(!(null==U?void 0:U.projects)||0===U.projects.length)&&(0,t.jsx)("div",{className:"py-8 text-center text-muted-foreground",children:"No project usage data available yet"}),($||(null==U?void 0:U.projects)&&U.projects.length>0)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"px-2",children:(0,t.jsx)(eU.w,{className:"bg-muted-border"})}),(0,t.jsxs)("div",{className:"flex items-center justify-between px-3 pb-1 pt-3",children:[(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Page ",P+1]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(L.$,{variant:"secondary",size:"icon-sm",onClick:e=>{e.stopPropagation(),P>0&&I(e=>e-1)},disabled:0===P,className:"bg-background",children:(0,t.jsx)(F.A,{name:"chevron_left",size:"small"})}),(0,t.jsx)(L.$,{variant:"secondary",size:"icon-sm",onClick:e=>{e.stopPropagation(),(null==U?void 0:U.has_more)&&(null==U?void 0:U.next_id)&&(P===A.length-1&&D(e=>[...e,U.next_id]),I(e=>e+1))},disabled:!(null==U?void 0:U.has_more),className:"bg-background",children:(0,t.jsx)(F.A,{name:"chevron_right",size:"small"})})]})]})]})]})]})}),(0,t.jsxs)("div",{className:"ml-2 text-sm text-muted-foreground",children:["This is a temporary offering until the end of 2025 as we refine our pricing model."," ",(0,t.jsx)("a",{href:"https://docs.lovable.dev/features/cloud",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"Read more"})]}),f&&(0,t.jsx)(tT,{open:w,onOpenChange:k,workspaceId:o.id,currentBalance:q})]})})};var tR=a(55865);let tU=e=>{var s;let{project:a,workspace:l,membership:u}=e,{EditProject:m,ViewProject:p,ViewWorkspace:x,ViewWorkspaceUsage:h,EditWorkspaceSettings:j,ViewWorkspaceMembers:g}=ev.eZ,{permitted:f}=(0,o.J)(m),[v,y]=(0,n.useState)(!0),b=(0,eF.d)(),N=(0,su.Q)(),{activeTab:w,openSettings:k,closeSettings:C}=(0,c.t)(),_=(0,i.useSearchParams)(),S=(0,eJ.B1)();(0,n.useEffect)(()=>{null!==w?y(!0):y(!1)},[w]),(0,r.vC)("mod+.",()=>{null===w?k(a?"project":"account"):C()});let{userData:E}=(0,d.ur)(),P=(null==E||null==(s=E.attributes)?void 0:s.display_name)||"Your Account",I=null==l?void 0:l.name,A=(0,n.useCallback)(()=>{l&&b({...sc.y.workspaceLovableCloudUsage({workspaceId:l.id}),permission:h,staleTime:5e3,enabled:"usage"!==w})},[l,w,b,h]);return(0,t.jsx)(si,{open:v,onOpenChange:e=>{e?k():("billing"==w&&null==_.get("change_type")&&N.markCouldShowHint(),C())},children:(0,t.jsxs)(ee.mm,{value:w||"settings",onValueChange:e=>k(e),children:[(0,t.jsxs)(ee.WQ,{hasActiveTab:!!w&&"settings"!==w,children:[(0,t.jsxs)(e7.E,{permission:m,shouldShow:!!a,children:[(0,t.jsx)(ee.G1,{title:"Project"}),(0,t.jsxs)(ee.Jz,{value:"project","aria-label":"project-tab",children:[(0,t.jsx)(F.A,{name:"cog"}),(0,t.jsx)("p",{children:"Project Settings"})]}),(0,t.jsxs)(ee.Jz,{value:"domains","aria-label":"domains-tab",children:[(0,t.jsx)(F.A,{name:"web"}),(0,t.jsx)("p",{children:"Domains"})]}),(0,t.jsxs)(ee.Jz,{value:"knowledge","aria-label":"knowledge-tab",children:[(0,t.jsx)(F.A,{name:"books"}),(0,t.jsx)("p",{children:"Knowledge"})]}),S&&(0,t.jsxs)(ee.Jz,{value:"libraries","aria-label":"libraries-tab",children:[(0,t.jsx)(F.A,{name:"menu_book"}),(0,t.jsx)("p",{children:"Libraries"})]}),(0,t.jsxs)(ee.Jz,{value:"memory","aria-label":"memory-tab",children:[(0,t.jsx)(F.A,{name:"lightbulb"}),(0,t.jsx)("p",{children:"Memory"})]})]}),(0,t.jsxs)(e7.E,{permission:p,shouldShow:!!a&&!f,children:[(0,t.jsx)(ee.G1,{title:"Project"}),(0,t.jsxs)(ee.Jz,{value:"domains","aria-label":"domains-tab",children:[(0,t.jsx)(F.A,{name:"web"}),(0,t.jsx)("p",{children:"Domains"})]})]}),(0,t.jsxs)(e7.E,{permission:x,shouldShow:!!l,children:[(0,t.jsx)(ee.G1,{title:"Workspace"}),(0,t.jsxs)(ee.Jz,{value:"workspace",className:"-ml-0.5","aria-label":"workspace-tab",children:[(0,t.jsx)(sd.z,{className:(0,eI.cn)("h-6 w-6 !rounded-[6px] md:h-5 md:w-5"),workspace:l}),(0,t.jsx)("p",{className:"-ml-0.5 min-w-0 flex-1 truncate",children:I})]}),(0,t.jsx)(e7.E,{permission:g,children:(0,t.jsxs)(ee.Jz,{value:"people","aria-label":"people-tab",children:[(0,t.jsx)(F.A,{name:"people"}),(0,t.jsx)("p",{children:"People"})]})}),(0,t.jsx)(e7.E,{plans:[sl.lV,so.VL.ENTERPRISE],children:(0,t.jsxs)(ee.Jz,{value:"templates","aria-label":"templates-tab",children:[(0,t.jsx)(F.A,{name:"bento"}),(0,t.jsx)("p",{children:"Templates"})]})}),(0,t.jsxs)(e7.E,{permission:h,children:[(0,t.jsxs)(ee.Jz,{value:"billing","aria-label":"billing-tab",children:[(0,t.jsx)(F.A,{name:"credit_card"}),(0,t.jsx)("p",{children:"Plans & credits"})]}),(0,t.jsxs)(ee.Jz,{value:"usage",onMouseEnter:A,"aria-label":"usage-tab",children:[(0,t.jsx)(F.A,{name:"leaderboard"}),(0,t.jsx)("p",{children:"Cloud & AI balance"})]})]}),(0,t.jsx)(e7.E,{permission:x,children:(0,t.jsxs)(ee.Jz,{value:"privacy-security","aria-label":"privacy-security-tab",children:[(0,t.jsx)(F.A,{name:"lock"}),(0,t.jsx)("p",{children:"Privacy & security"})]})}),(0,t.jsx)(e7.E,{permission:j,plans:[sl.lV,so.VL.ENTERPRISE],children:(0,t.jsxs)(ee.Jz,{value:"identity","aria-label":"identity-tab",children:[(0,t.jsx)(F.A,{name:"shield"}),(0,t.jsx)("p",{children:"Identity"})]})})]}),(0,t.jsx)(ee.G1,{title:"Account"}),(0,t.jsxs)(ee.Jz,{value:"account","aria-label":"account-tab",children:[(0,t.jsx)(F.A,{name:"person_circle"}),(0,t.jsx)("p",{children:P})]}),(0,t.jsxs)(ee.Jz,{value:"labs","aria-label":"labs-tab",children:[(0,t.jsx)(F.A,{name:"flask_conical"}),(0,t.jsx)("p",{children:"Labs"})]}),(0,t.jsxs)(e7.E,{permission:x,children:[(0,t.jsx)(ee.G1,{title:"Integrations"}),(0,t.jsx)(e7.E,{shouldShow:!!l,children:(0,t.jsxs)(ee.Jz,{value:"integrations","aria-label":"integrations-tab",children:[(0,t.jsx)(F.A,{name:"connections"}),(0,t.jsx)("p",{children:"Integrations"})]})}),(0,t.jsxs)(ee.Jz,{value:"supabase","aria-label":"supabase-tab",children:[(0,t.jsx)(O.gu,{name:"Supabase",className:"h-4 w-4"}),(0,t.jsx)("p",{children:"Supabase"})]}),(0,t.jsx)(e7.E,{shouldShow:!!l||!!a,children:(0,t.jsxs)(ee.Jz,{value:"github","aria-label":"github-tab",children:[(0,t.jsx)(O.gu,{name:"GitHub",className:"h-4 w-4"}),(0,t.jsx)("p",{children:"GitHub"})]})})]})]}),(0,t.jsxs)("div",{className:(0,eI.cn)("relative h-full w-full flex-1 overflow-x-auto md:w-auto",w&&"settings"!==w?"flex":"hidden md:flex"),children:[(0,t.jsxs)(e7.E,{permission:m,shouldShow:!!a,children:[(0,t.jsx)(e9,{project:a}),(0,t.jsx)(eL,{}),S&&(0,t.jsx)(eT,{}),(0,t.jsx)(aK,{project:a})]}),(0,t.jsx)(e7.E,{permission:p,shouldShow:!!a,children:(0,t.jsx)(eS,{project:a})}),(0,t.jsxs)(e7.E,{permission:x,shouldShow:!!l,children:[(0,t.jsx)(tR.N,{workspace:l,membership:u}),(0,t.jsx)(e7.E,{permission:g,children:(0,t.jsx)(tx.$,{workspace:l})}),(0,t.jsxs)(e7.E,{permission:h,children:[(0,t.jsx)(a9.R,{workspace:l}),(0,t.jsx)(tM,{workspace:l})]}),(0,t.jsx)(e7.E,{plans:[sl.lV,so.VL.ENTERPRISE],children:(0,t.jsx)(tw,{workspace:l})}),(0,t.jsx)(ty,{workspace:l,membership:u}),(0,t.jsx)(e7.E,{permission:j,plans:[sl.lV,so.VL.ENTERPRISE],children:(0,t.jsx)(tp,{workspace:l})})]}),(0,t.jsx)(sG,{}),(0,t.jsx)(sg,{}),(0,t.jsx)(e7.E,{shouldShow:!!l,children:(0,t.jsx)(aG,{workspace:l})}),(0,t.jsxs)(e7.E,{permission:x,shouldShow:!!l,children:[(0,t.jsx)(ap,{workspace:l,isInsideEditor:!!a}),(0,t.jsx)(a6,{workspace:l,project:a,isInsideEditor:!!a})]})]})]})})},t$=()=>{let{EditProject:e,ViewWorkspace:s}=ev.eZ,a=(0,l.QY)(),{currentWorkspace:i,membership:n}=(0,l.j4)(e=>e),r=(0,eA.mb)(e=>e.project);return(0,t.jsx)(e7.E,{permission:a?e:s,children:(0,t.jsx)(tU,{project:r,workspace:null!=i?i:void 0,membership:null!=n?n:void 0})})}},49121:(e,s,a)=>{a.d(s,{M:()=>c,l:()=>d});var t=a(77145),i=a(18502),n=a(95661),r=a(6971),l=a(40702);let o=(0,n.createContext)(null);function c(e){let{children:s}=e,{authUser:a}=(0,l.Z2)(),{data:c,isLoading:d}=(0,i.I)(r.Y.experimentalFeatures({user:a})),u=(0,n.useMemo)(()=>({features:c||null,isLoading:d}),[c,d]);return(0,t.jsx)(o.Provider,{value:u,children:s})}function d(){let e=(0,n.useContext)(o);if(!e)throw Error("LabsFeaturesContext not found");return e}},49352:(e,s,a)=>{a.d(s,{AY:()=>h,Fr:()=>x,Fz:()=>j,SM:()=>u,U$:()=>m,jj:()=>g,kF:()=>p});var t=a(95661),i=a(31088),n=a(75222),r=a(54994),l=a(63851),o=a(19620),c=a(65712);let d=(e,s)=>"integrationOAuth_".concat(e,"_").concat(s),u=e=>d(e,"nonce"),m=e=>d(e,"codeVerifier"),p=e=>d(e,"clientData"),x=e=>d(e,"status"),h=n.Ik({workspaceId:n.Yj(),integrationId:n.Yj().optional(),connectorId:n.Yj().optional(),serverUrl:n.Yj(),nonce:n.Yj(),testConnection:n.zM().optional(),displayName:n.Yj().optional()});class j extends Error{constructor(e,s){super(e),this.message=e,this.category=s,this.name="IntegrationAuthError",this.category=s}}let g=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{testConnection:!0},[a,n]=(0,t.useState)(!1);return{handleConnect:(0,t.useCallback)(async a=>{n(!0);let{integrationId:t,serverUrl:l,connectorId:d,displayName:h}=a,j=t?"integration_".concat(t):"connector_".concat(d),g=x(j),N=window.location.origin,w=t?"".concat(N,"/integrations/").concat(t,"/oauth/callback"):"".concat(N,"/connectors/").concat(d,"/oauth/callback"),k=crypto.randomUUID();try{localStorage.setItem(g,JSON.stringify({status:"pending"})),localStorage.setItem(u(j),k)}catch(e){throw o.logging.error("Error storing nonce in localStorage:",{error:e}),i.toast.error("Failed to initiate OAuth flow",{description:"Try clearing browser local storage and try again."}),n(!1),Error("Failed to initiate OAuth flow",{cause:e})}try{let a=(0,c.$)(JSON.stringify({workspaceId:e,integrationId:t,connectorId:d,serverUrl:l,nonce:k,testConnection:null==s?void 0:s.testConnection,displayName:h})),i=function(){let e=new Uint8Array(32);return crypto.getRandomValues(e),btoa(String.fromCharCode.apply(null,Array.from(e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(),n=await y(i);localStorage.setItem(m(j),i);let{resource_metadata:u,auth_metadata:x}=await r.queryClient.fetchQuery({queryKey:["discover-oauth-metadata",e,l],queryFn:()=>f({workspaceId:e,serverUrl:l}),staleTime:36e5,gcTime:36e5});if(!x)throw Error("Server does not support OAuth authentication");let N=null;if(x.registration_endpoint)try{N=await v(x.registration_endpoint,w),localStorage.setItem(p(j),JSON.stringify(N))}catch(e){o.logging.warn("Dynamic client registration failed, continuing without client_id",{error:e})}let C=new URL(x.authorization_endpoint);C.searchParams.set("response_type","code"),C.searchParams.set("redirect_uri",w),C.searchParams.set("state",a),C.searchParams.set("code_challenge",n),C.searchParams.set("code_challenge_method","S256"),(null==u?void 0:u.resource)?C.searchParams.set("resource",u.resource):C.searchParams.set("resource",l),(null==N?void 0:N.clientId)&&C.searchParams.set("client_id",N.clientId);let _=window.open(C.toString(),"_blank","width=600,height=700,left=100,top=100");if(!_){window.location.href=C.toString();return}return _.focus(),new Promise((e,s)=>{let a,t,i=!1,n=!1,r=e=>{if(!e)return null;try{return JSON.parse(e)}catch(e){return o.logging.warn("Failed to parse integration OAuth status",{error:e,storageKey:j}),null}},l=()=>{window.removeEventListener("message",m),window.removeEventListener("storage",p),a&&clearInterval(a),t&&clearTimeout(t)},c=s=>{i||(i=!0,localStorage.removeItem(g),l(),e(s))},u=e=>{i||(i=!0,localStorage.removeItem(g),l(),s(e))},m=e=>{if(e.origin!==window.location.origin)return;let s=e.data;b(s)&&(s.success?c(s):u(s))},p=e=>{if(e.storageArea===window.localStorage&&e.key&&e.key===g){let s=r(e.newValue);if(s)if("completed"===s.status){let e={type:"integrationAuth",success:!0,integrationId:s.integrationId,connectorId:d};c(e)}else"error"===s.status&&u({type:"integrationAuth",success:!1,error:{message:s.error||"OAuth authentication failed",category:"unknown"}})}};window.addEventListener("message",m),window.addEventListener("storage",p);let x=r(localStorage.getItem(g));return(null==x?void 0:x.status)==="completed"?void c({type:"integrationAuth",success:!0,integrationId:x.integrationId,connectorId:d}):(null==x?void 0:x.status)==="error"?void u({type:"integrationAuth",success:!1,error:{message:x.error||"OAuth authentication failed",category:"unknown"}}):void(a=setInterval(()=>{_.closed&&!n&&(n=!0,o.logging.info("OAuth popup reported as closed - awaiting explicit user cancel or completion signal",{connectorId:d,storageKey:j}),a&&clearInterval(a))},1e3),t=setTimeout(()=>{_.closed||_.close(),u({type:"integrationAuth",success:!1,error:{message:"OAuth authentication timed out",category:"timeout"}})},3e5))})}catch(e){throw o.logging.error("Error initiating OAuth connection:",{error:e}),i.toast.error("Connection Error",{description:"An error occurred while connecting. Please try again."}),e}finally{n(!1)}},[e,null==s?void 0:s.testConnection]),isConnecting:a}};async function f(e){let{workspaceId:s,serverUrl:a}=e,t=(0,l.P)();return await t.get("/workspaces/".concat(s,"/connectors/well_known_discovery"),{params:{server_url:a}})}async function v(e,s){let a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_name:"Lovable",client_uri:"https://lovable.dev",redirect_uris:[s],grant_types:["authorization_code","refresh_token"],response_types:["code"],token_endpoint_auth_method:"none"})});if(!a.ok){let e=await a.text();throw Error("Client registration failed with status ".concat(a.status,": ").concat(e))}let t=await a.json();return{clientId:t.client_id,clientSecret:t.client_secret}}async function y(e){let s=new TextEncoder().encode(e),a=await crypto.subtle.digest("SHA-256",s);return btoa(String.fromCharCode.apply(null,Array.from(new Uint8Array(a)))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}let b=e=>"integrationAuth"===e.type},50344:(e,s,a)=>{a.d(s,{H:()=>o});var t=a(77145),i=a(61035),n=a(8711),r=a(69730),l=a(21016);let o=e=>{let{className:s,iconSize:a="default",useV2:o=!1}=e,c=(0,l.A)("md"),{theme:d,setTheme:u}=(0,i.D)();return c&&!o?null:(0,t.jsxs)(n.lv,{children:[(0,t.jsxs)(n.nV,{className:s,children:[(0,t.jsx)(r.A,{name:"contrast",size:a}),(0,t.jsx)("p",{children:"Appearance"})]}),(0,t.jsx)(n.dc,{children:(0,t.jsx)(n.M5,{children:(0,t.jsxs)(n.Hr,{value:d,onValueChange:e=>{("light"===e||"dark"===e||"system"===e)&&u(e),o&&window.dispatchEvent(new CustomEvent("restartBackgroundAnimation"))},children:[(0,t.jsx)(n.Ht,{value:"light",className:"focus:bg-muted",children:"Light"}),(0,t.jsx)(n.Ht,{value:"dark",className:"focus:bg-muted",children:"Dark"}),(0,t.jsx)(n.Ht,{value:"system",className:"focus:bg-muted",children:"System theme"})]})})})]})}},50562:(e,s,a)=>{a.d(s,{p:()=>r});var t=a(77145),i=a(47226),n=a(56024);let r=e=>{let{mainSkeletonClassName:s,backgroundColor:a}=e;return a||(a="bg-muted"),(0,t.jsxs)("div",{className:"group flex flex-col",children:[(0,t.jsx)(i.E,{className:(0,n.cn)("mb-3 aspect-video h-full w-full rounded-lg",a,s)}),(0,t.jsxs)("div",{className:"flex flex-col gap-2 py-1",children:[(0,t.jsx)(i.E,{className:(0,n.cn)("h-3.5 w-[150px]",a)}),(0,t.jsx)(i.E,{className:(0,n.cn)("h-3.5 w-[120px]",a)})]})]})}},54982:(e,s,a)=>{a.d(s,{CreateWorkspaceDialog:()=>w});var t=a(77145),i=a(95661),n=a(31088),r=a(49974),l=a(49493),o=a(52811),c=a(6397),d=a(77563),u=a(24092),m=a(56024),p=a(40488),x=a(87299),h=a(6698),j=a(40702),g=a(83220),f=a(91169),v=a(83473),y=a(63851),b=a(99989);let N={name:{title:"Create a Workspace",description:"Create a new place to make projects or collaborate with others."},plan:{title:"Select a Plan",description:"Select a plan for your new workspace."}},w=()=>{let e=(0,l.Mu)(e=>e.showCreateWorkspaceDialog),s=(0,l.Mu)(e=>e.setShowCreateWorkspaceDialog),[a,n]=(0,i.useState)("name"),{title:o,description:c}=N[a];return(0,t.jsx)(u.E,{title:o,description:c,open:e,onOpenChange:e=>{e||n("name"),s(e)},className:"plan"===a?"max-w-[600px] md:px-6":"",children:(0,t.jsx)(r.ET,{pricingScenario:"newWorkspace",children:(0,t.jsx)(k,{closeDialog:()=>{n("name"),s(!1)},step:a,setStep:n})})})},k=e=>{let{closeDialog:s,step:a,setStep:o}=e,[c,d]=(0,i.useState)(""),{createWorkspace:u,isCreatingWorkspace:m}=(e=>{let{closeDialog:s}=e,a=(0,x.jE)(),{setCurrentWorkspaceId:t}=(0,g.Dx)(),{store:i}=(0,l.k9)(),{authUser:r}=(0,j.Z2)(),{toCheckout:o}=(0,f.R)(),{mutate:c,isPending:d}=(0,h.n)({mutationFn:async e=>{let{name:s}=e;return(0,y.P)().post("/user/workspaces",{name:s})},onSuccess:async(e,l)=>{var c;let{plan:d,planType:u}=l,m=b.y.workspaces({userId:null==r?void 0:r.uid}).queryKey;a.setQueryData(m,s=>({workspaces:[...(null==s?void 0:s.workspaces)||[],e]}));let p=b.y.detail({workspaceId:e.id,projectId:void 0}).queryKey;a.setQueryData(p,{workspace:e,is_member:!0,current_member:null}),null==i||i.setState({workspaces:[...null!=(c=null==i?void 0:i.getState().workspaces)?c:[],e]}),t(e.id);try{if(!e.id)throw Error("Workspace ID is required");await o({plan:d,workspaceId:e.id,changeType:"upgrade",planType:u}),n.toast.success("Workspace created successfully",{description:e.name})}finally{s()}},onSettled:e=>{e&&(a.invalidateQueries({queryKey:b.y.workspaces({userId:null==r?void 0:r.uid}).queryKey}),a.invalidateQueries({queryKey:b.y.detail({workspaceId:e.id,projectId:void 0}).queryKey}))},onError:e=>{(0,v.Ni)(e)}});return{createWorkspace:c,isCreatingWorkspace:d}})({closeDialog:s}),p=(0,r.et)();return(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsx)(C,{step:a,workspaceName:c,setWorkspaceName:d,closeDialog:s,setStep:o}),(0,t.jsx)(_,{step:a,handleSubmit:()=>{if("name"===a)return""===c?void n.toast.error("Workspace name is required"):void o("plan");null!==p.newWorkspaceSelectedPlan&&u({name:c,plan:p.newWorkspaceSelectedPlan,planType:p.planType})},setStep:o,workspaceName:c,isCreatingWorkspace:m})]})},C=e=>{let{step:s,workspaceName:a,setWorkspaceName:i,closeDialog:n,setStep:r}=e;return(0,t.jsxs)("div",{className:(0,m.cn)("hidden flex-col gap-4","name"===s&&"flex"),children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2 px-1",children:[(0,t.jsx)(d.Label,{children:"Workspace Name"}),(0,t.jsx)(c.p,{id:"workspaceName",value:a,onChange:e=>i(e.target.value),placeholder:"Enter workspace name",required:!0})]}),(0,t.jsxs)("div",{className:"mt-2 flex w-full gap-6 px-1 pb-1",children:[(0,t.jsx)(o.$,{type:"button",className:"flex-1",variant:"secondary",onClick:n,children:"Go Back"}),(0,t.jsx)(o.$,{className:"flex-1",disabled:!a,type:"button",onClick:()=>r("plan"),children:"Continue to Plan"})]})]})},_=e=>{let{step:s,setStep:a,workspaceName:i,isCreatingWorkspace:n,handleSubmit:r}=e;return(0,t.jsxs)("div",{className:(0,m.cn)("hidden flex-col gap-4","plan"===s&&"flex"),children:[(0,t.jsxs)("div",{className:(0,m.cn)("grid grid-cols-1 gap-4 md:grid-cols-2"),children:[(0,t.jsx)(p.ZL.Pro,{}),(0,t.jsx)(p.ZL.Biz,{})]}),(0,t.jsxs)("div",{className:"sticky bottom-0 mt-2 flex w-full gap-6 border-t bg-background px-1 py-3",children:[(0,t.jsx)(o.$,{type:"button",className:"flex-1",variant:"secondary",onClick:()=>a("name"),children:"Go Back"}),(0,t.jsx)(o.$,{className:"flex-1",onClick:r,disabled:!i||n,loading:n,children:n?"Creating...":"Create Workspace"})]})]})}},55865:(e,s,a)=>{a.d(s,{N:()=>q,U:()=>B});var t=a(77145),i=a(9898),n=a(18502),r=a(87299),l=a(6698),o=a(52037),c=a(31088),d=a(75222),u=a(40702),m=a(61374),p=a(49493),x=a(57841),h=a(94123),j=a(73893),g=a(26158),f=a(52811),v=a(19695),y=a(20247),b=a(27549),N=a(69730),w=a(6397),k=a(32313),C=a(83473),_=a(63851),S=a(680),E=a(214),P=a(72632),I=a(99989),A=a(74507),L=a(13410),D=a(83220),z=a(95661),F=a(14618),T=a(65616),O=a(69850),M=a(56024);let R=["image/png","image/jpeg","image/jpg","image/webp"],U=e=>{let{workspace:s,className:a}=e,{authUser:i}=(0,u.Z2)(),n=(0,_.P)(),{upload:o}=(0,F.l)(),d=(0,r.jE)(),m=(0,z.useRef)(null),p=()=>{m.current&&(m.current.value="")},{mutateAsync:x,isPending:h}=(0,l.n)({mutationFn:async e=>{let{file:a,workspaceId:t}=e;if(!i)throw Error("You must be logged in to upload files");await o({fileName:a.name,file:a,options:{maxFileSize:10240,maxDimension:200},continueOnError:!1});let{url:r}=await (0,T.QN)({dir_name:i.uid,file_name:a.name});return await n.put("/user/workspaces/".concat(s.id),{image_url:r})},onSuccess:(e,s)=>{c.toast.success("Updated workspace avatar",{description:"Succesfully uploaded new workspace avatar"}),d.invalidateQueries({queryKey:O.workspaceKeys.all}),p()},onError:()=>{c.toast.error("Failed to update workspace avatar",{description:"Please try again"}),p()}}),j=async e=>{var a;let t=null==(a=e.target.files)?void 0:a[0];t&&await x({file:t,workspaceId:s.id})};return(0,t.jsxs)(f.$,{variant:"secondary",size:"icon-sm",className:(0,M.cn)("absolute -bottom-1 -right-2 h-5 w-5 rounded-sm border disabled:opacity-100",a),type:"button",disabled:h,onClick:()=>{var e;null==(e=m.current)||e.click()},children:[(0,t.jsx)("input",{type:"file",className:"hidden",accept:R.join(","),onChange:j,disabled:h,ref:m}),(0,t.jsx)(N.A,{name:h?"progress_activity":"pen_top_right_square",size:"xsmall",className:h?"animate-spin":""})]})},$=d.Ik({name:d.Yj().min(1,"Workspace name is required").max(100,"Workspace name must be 100 characters or less").trim(),description:d.Yj().max(500,"Description must be 500 characters or less").optional().or(d.eu("")),defaultMonthlyMemberCreditLimit:d.KC([d.ai().positive("Credit limit must be a positive number").max(1e6,"Credit limit must be less than 1,000,000"),d.ch(),d.Vx()]).optional()}),q=e=>{var s,a,r,c;let{workspace:d,membership:u}=e,{EditWorkspaceSettings:p,LeaveWorkspace:C}=A.eZ,{SetCreditLimit:z}=S.x,{data:F,isLoading:T}=(0,n.I)({...I.y.searchWorkspaceMemberships({workspaceId:d.id,params:{query:"",status:"active",roles:["owner"],limit:2}}),enabled:!!d.id&&(null==u?void 0:u.role)==="owner"}),O=null!=(s=null==F?void 0:F.total)?s:1,M=(null==u?void 0:u.role)==="owner",R=M&&(T||O<=1),{permitted:q}=(0,m.J)(p),W=(0,o.mN)({defaultValues:{name:null!=(a=d.name)?a:"",description:null!=(r=d.description)?r:"",defaultMonthlyMemberCreditLimit:null!=(c=d.default_monthly_member_credit_limit)?c:void 0},resolver:(0,i.u)($)}),{leaveWorkspace:G,isLeavingWorkspace:K}=function(){let{setCurrentWorkspaceId:e}=(0,D.Dx)(),s=(0,L.useRouter)(),{mutateAsync:a,isPending:t}=(0,l.n)({mutationFn:async e=>(0,_.P)().post("/user/workspaces/".concat(e,"/leave")),onSuccess:async()=>{e(null),s.push("/")}});return{leaveWorkspace:a,isLeavingWorkspace:t}}(),{updateWorkspace:V,isUpdatingWorkspace:Y}=B({form:W,workspaceId:d.id}),{isBizPlan:Z}=(0,P.cb)(d.plan),Q=(0,E.ZS)();return(0,t.jsx)(g.Pt,{title:"Workspace settings",value:"workspace",description:"Workspaces allow you to collaborate on projects in real time.",docsLink:"https://docs.lovable.dev/user-guides/teams",children:(0,t.jsx)(b.lV,{...W,children:(0,t.jsxs)("form",{className:"flex w-full flex-col gap-6",onSubmit:W.handleSubmit(e=>{V(e)}),children:[(0,t.jsx)(j.m,{label:"Workspace Avatar",description:"Set an avatar for your workspace.",mobileLayout:"horizontal",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(x.z,{className:"h-10 w-10",workspace:d}),(0,t.jsx)(h.E,{permission:p,children:(0,t.jsx)(U,{workspace:d})})]})}),(0,t.jsx)(j.m,{label:"Workspace Name",description:"Your full workspace name, as visible to others.",children:(0,t.jsx)(b.zB,{control:W.control,name:"name",render:e=>{var s,a;let{field:i}=e;return(0,t.jsxs)(b.eI,{className:"w-full",children:[(0,t.jsx)(b.MJ,{children:(0,t.jsx)(v.Q,{showTooltip:!q,tooltipContent:"You need to be a workspace admin to modify this field",children:(0,t.jsx)(w.p,{...i,placeholder:"Enter workspace name",disabled:!q,maxLength:100})})}),(0,t.jsxs)("div",{className:"flex justify-end text-xs text-muted-foreground",children:[null!=(a=null==(s=i.value)?void 0:s.length)?a:0," / 100 characters"]}),(0,t.jsx)(b.C5,{})]})}})}),(0,t.jsx)(j.m,{label:"Workspace Description",description:"A short description about your workspace or team.",isLast:!Q&&q&&!Z,children:(0,t.jsx)(b.zB,{control:W.control,name:"description",render:e=>{var s,a;let{field:i}=e;return(0,t.jsxs)(b.eI,{className:"w-full",children:[(0,t.jsx)(b.MJ,{children:(0,t.jsx)(v.Q,{showTooltip:!q,tooltipContent:"You need to be a workspace admin to modify this field",children:(0,t.jsx)(k.T,{rows:3,className:"border bg-background",placeholder:"Description",disabled:!q,maxLength:500,...i})})}),(0,t.jsxs)("div",{className:"flex justify-end text-xs text-muted-foreground",children:[null!=(a=null==(s=i.value)?void 0:s.length)?a:0," / 500 characters"]}),(0,t.jsx)(b.C5,{})]})}})}),(0,t.jsx)(h.E,{permission:p,featureFlags:[z],children:(0,t.jsx)(j.m,{label:"Default Monthly Member Credit Limit",description:"The default monthly credit limit for members of this workspace. Leave empty to use no limit.",children:(0,t.jsx)(b.zB,{control:W.control,name:"defaultMonthlyMemberCreditLimit",render:e=>{var s,a;let{field:i}=e;return(0,t.jsxs)(b.eI,{className:"w-full",children:[(0,t.jsx)(b.MJ,{children:(0,t.jsx)(w.p,{...i,type:"number",placeholder:"Enter default monthly member credit limit (optional)",disabled:!q,onChange:e=>{let s=e.target.value;if(""===s)i.onChange(null),W.setValue("defaultMonthlyMemberCreditLimit",null,{shouldDirty:!0});else{let e=Number(s);!isNaN(e)&&e>0&&i.onChange(e)}},onBlur:i.onBlur,name:i.name,value:null===i.value?"":null!=(a=null==(s=i.value)?void 0:s.toString())?a:""})}),(0,t.jsx)(b.C5,{})]})}})})}),(0,t.jsx)(h.E,{permission:C,children:(0,t.jsx)(j.m,{label:"Leave Workspace",description:T?"Checking ownership status...":R?"You cannot leave as you are the only owner. Please transfer ownership first.":M&&O>1?"Leave the workspace. There are other owners who will maintain access.":"Leave the workspace (you will lose all access to projects inside this workspace).",isLast:!0,justify:"end",className:R?"opacity-50":"",mobileLayout:"horizontal",children:(0,t.jsx)("div",{className:"flex items-center justify-end gap-2",children:T?(0,t.jsxs)(f.$,{variant:"destructive",type:"button",disabled:!0,children:[(0,t.jsx)(N.A,{name:"refresh",className:"mr-2 h-4 w-4 animate-spin"}),"Loading..."]}):R?(0,t.jsx)("div",{className:"cursor-not-allowed",children:(0,t.jsx)(f.$,{variant:"destructive",type:"button",disabled:!0,className:"pointer-events-none",children:"Leave Workspace"})}):(0,t.jsxs)(y.lG,{children:[(0,t.jsx)(y.zM,{asChild:!0,children:(0,t.jsx)(f.$,{variant:"destructive",type:"button",loading:K,children:"Leave Workspace"})}),(0,t.jsxs)(y.Cf,{size:"sm",children:[(0,t.jsxs)(y.c7,{children:[(0,t.jsx)(y.L3,{children:"Leave Workspace"}),(0,t.jsx)(y.rr,{children:M&&O>1?"Are you sure you want to leave this workspace? There are other owners who will maintain access.":"Are you sure you want to leave this workspace?"})]}),(0,t.jsxs)(y.Es,{children:[(0,t.jsx)(y.HM,{asChild:!0,children:(0,t.jsx)(f.$,{variant:"outline",children:"Cancel"})}),(0,t.jsx)(f.$,{variant:"destructive",type:"button",loading:K,onClick:()=>G(d.id),children:"Leave Workspace"})]})]})]})})})}),W.formState.isDirty&&(0,t.jsx)(j.E,{children:(0,t.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,t.jsx)(f.$,{variant:"secondary",type:"button",onClick:()=>{W.reset()},children:"Cancel"}),(0,t.jsx)(f.$,{variant:"affirmative",type:"submit",loading:Y,children:"Update"})]})})]})})})};function B(e){let{form:s,workspaceId:a,quietSuccess:t=!1}=e,i=(0,r.jE)(),{authUser:n}=(0,u.Z2)(),{store:o}=(0,p.k9)(),{mutate:d,isPending:m}=(0,l.n)({mutationFn:async e=>{var s;return(0,_.P)().put("/user/workspaces/".concat(a),{name:e.name,description:null!=(s=e.description)?s:"",...void 0!==e.defaultMonthlyMemberCreditLimit&&{default_monthly_member_credit_limit:null===e.defaultMonthlyMemberCreditLimit?-1:e.defaultMonthlyMemberCreditLimit}})},onSuccess:e=>{var r,l,d,u;t||c.toast.success("Success",{description:"Workspace settings updated successfully"});let m=I.y.detail({workspaceId:a,projectId:void 0}).queryKey;i.setQueryData(m,s=>s?{...s,workspace:e}:{workspace:e,projects:[],is_member:!0,current_member:null});let p=I.y.workspaces({userId:null==n?void 0:n.uid}).queryKey;i.setQueryData(p,s=>s?{workspaces:s.workspaces.map(s=>s.id===e.id?e:s)}:{workspaces:[e]});let x=(null!=(r=null==o?void 0:o.getState().workspaces)?r:[]).map(s=>s.id===e.id?e:s);null==o||o.setState({workspaces:x}),s.reset({name:null!=(l=e.name)?l:"",description:null!=(d=e.description)?d:"",defaultMonthlyMemberCreditLimit:null!=(u=e.default_monthly_member_credit_limit)?u:null})},onError:e=>{(0,C.Ni)(e)}});return{updateWorkspace:d,isUpdatingWorkspace:m}}},56239:(e,s,a)=>{a.d(s,{O:()=>l});var t=a(18502),i=a(95661),n=a(28717),r=a(26119);let l=e=>{var s,a,l,o;let{enabled:c}=e,{userData:d}=(0,n.ur)(),u=(0,t.I)(r.O.installations({enabled:c})),m=null==d||null==(s=d.github)?void 0:s.encrypted_access_token,p=(0,i.useRef)(m);return(0,i.useEffect)(()=>{p.current!==m&&(u.refetch(),p.current=m)},[m,u]),{isLoading:u.isLoading,installations:null==(a=u.data)?void 0:a.installations,hasAccessToken:null==(l=u.data)?void 0:l.has_access_token,hasValidAccessToken:null==(o=u.data)?void 0:o.has_valid_access_token}}},65712:(e,s,a)=>{function t(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function i(e){let s=e.replace(/-/g,"+").replace(/_/g,"/");for(;s.length%4;)s+="=";return atob(s)}a.d(s,{$:()=>t,Z:()=>i})},69427:(e,s,a)=>{a.d(s,{G:()=>i});var t=a(95661);let i=e=>(0,t.useMemo)(()=>{let s=null==e?void 0:e.default_project_visibility;return s||"private"},[null==e?void 0:e.default_project_visibility])},71024:(e,s,a)=>{a.d(s,{w:()=>d});var t=a(87299),i=a(6698),n=a(13410),r=a(31088),l=a(83473),o=a(63851),c=a(69850);let d=(e,s)=>{let a=(0,n.useRouter)(),d=(0,t.jE)(),{mutate:u,isPending:m}=(0,i.n)({mutationFn:async()=>(0,o.P)().put("/projects/".concat(e,"/collaborators/accept-invite")),onSuccess:e=>{let a=e.name||s;r.toast.success("Invitation accepted!",{description:'You now have access to "'.concat(a,'".')}),d.invalidateQueries({queryKey:c.gO.all})},onError:e=>{(0,l.Ni)(e)}}),{mutate:p,isPending:x}=(0,i.n)({mutationFn:async()=>{let s=(0,o.P)();await s.put("/projects/".concat(e,"/collaborators/reject-invite"))},onSuccess:()=>{r.toast.info("Invitation declined",{description:"You've declined the invitation to \"".concat(s,'".')}),d.invalidateQueries({queryKey:c.gO.all}),a.push("/")},onError:e=>{(0,l.Ni)(e)}});return{acceptInvite:u,rejectInvite:p,isAccepting:m,isRejecting:x}}},71733:(e,s,a)=>{a.d(s,{oC:()=>o,ZE:()=>c,pT:()=>m,CN:()=>u});var t=a(31088),i=a(75222),n=a(19620);let r="https://github.com/login/oauth/authorize?client_id=".concat("Iv1.365d6a195dbca85b"),l="https://github.com/apps/".concat("lovable-dev","/installations/new"),o="githubOAuthNonce",c=i.Ik({nonce:i.Yj(),workspaceId:i.Yj().optional()}),d=(e,s)=>{let a=crypto.randomUUID();try{localStorage.setItem(o,a)}catch(e){n.logging.error("Failed to set state in GitHub OAuth popup"),t.toast.error("Failed to initiate GitHub OAuth flow",{description:"Try clearing browser local storage and try again."});return}let i=(null==s?void 0:s.workspaceId)?{nonce:a,workspaceId:s.workspaceId}:{nonce:a,workspaceId:void 0},r=new URL(e);r.searchParams.set("state",btoa(JSON.stringify(i))),e=r.toString();let l=window.open(e,"_blank","width=600,height=700,left=100,top=100");if(!l)return void n.logging.error("Failed to open GitHub OAuth popup");l.focus()},u=e=>{let{githubOwner:s,workspaceId:a}=e;d((e=>(null==e?void 0:e.id)?"".concat(l,"/permissions?target_id=").concat(e.id,"&target_type=").concat(e.type):l)(s),{workspaceId:a})},m=()=>{d(r)}},72723:(e,s,a)=>{a.d(s,{Q:()=>n});var t=a(84510),i=a(90634);let n=(0,t.vt)()((0,i.Zr)((e,s)=>({hintOpen:!1,shouldHighlight:!1,lastClosedTimestamp:void 0,closeHint:()=>{e({hintOpen:!1,lastClosedTimestamp:Date.now()})},markCouldShowHint:()=>{let{lastClosedTimestamp:a}=s();(!a||Date.now()-a>864e5)&&e({shouldHighlight:!0,hintOpen:!0})},reset:()=>{e({shouldHighlight:!1,hintOpen:!1,lastClosedTimestamp:void 0})}}),{name:"referral-highlight-store"}))},83548:(e,s,a)=>{a.d(s,{O:()=>o});var t=a(77145),i=a(18502),n=a(59142),r=a(90249),l=a(6971);let o=e=>{var s;let{isInteractive:a=!1,className:o,authUser:c,userData:d,...u}=e,{data:m}=(0,i.I)({...l.Y.publicProfile({username:d.id}),enabled:!!d.id}),p=(null==m?void 0:m.avatar_url)||(null==c?void 0:c.photoURL),x=(0,r.Q)(null==d?void 0:d.id),h=(null==d||null==(s=d.attributes)?void 0:s.display_name)||(null==c?void 0:c.email)||(d.username&&d.username!==d.id?d.username:void 0);return(0,t.jsx)(n._,{name:h,isInteractive:a,photoSrc:p,userColor:x,className:o,...u})}}}]);