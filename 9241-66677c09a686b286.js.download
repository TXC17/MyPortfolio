try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{})["__faroBundleId_gptengineer-app"]="17638416719484a12ecf001"}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[312,9241],{1133:(e,t,r)=>{r.d(t,{B:()=>a});var a=function(e){return e.IMMEDIATE_RUNTIME="immediate_runtime",e.RUNTIME="runtime",e.BUILD="build",e.DEPLOY_SUPABASE_FUNCTIONS="deploy_supabase_functions",e.HTTP_CLIENT_ERROR="http_client_error",e.CORS_ERROR="cors_error",e.HTTP_SERVER_ERROR="http_server_error",e.NO_CODE_CHANGE="no_code_change",e.CODE_DIFF="code_diff",e.FILE_EDITED_WITHOUT_PERMISSION="file_edited_without_permission",e.EXCLUDED_FILE_EDITED="excluded_file_edited",e.SUPABASE_EDGE_FUNCTION_ERROR="supabase_edge_function_error",e.DEPENDENCY_INSTALL="dependency_install",e.SUPABASE_SQL_ERROR="supabase_sql_error",e.SEARCH_REPLACE_FAILED="search_replace_failed",e.SEARCH_REPLACE_MISSING_FILE="search_replace_missing_file",e.CHANGED_MISSING_FILE="changed_missing_file",e.RENAME_FAILED="rename_failed",e.DELETION_FAILED="deletion_failed",e}({})},2848:(e,t,r)=>{r.d(t,{a:()=>n,y:()=>a});let a={mobile:{name:"mobile",tooltip:"Show desktop preview",icon:"devices"},tablet:{name:"tablet",tooltip:"Show mobile preview",icon:"devices"},desktop:{name:"desktop",tooltip:"Show tablet preview",icon:"devices"}},n={STATIC:"static",LIVE:"live"}},6279:(e,t,r)=>{r.d(t,{B:()=>o,M:()=>n});var a=r(13410);let n=()=>{let e=(0,a.useParams)().project_id;return e&&"string"==typeof e?e:null},o=()=>{let e=n();if(!e)throw Error("Project ID is required and should always be set here");return e}},11070:(e,t,r)=>{r.d(t,{K:()=>v,N:()=>h});var a=r(92912),n=r(75222),o=r(63851),i=r(19620),s=r(72632),l=r(51573),c=r(69850),u=r(62548),d=r(74507),m=r(83473),g=r(39528),p=r(32736);let f=async(e,t,r)=>{try{let n=(0,o.P)();await n.post("/workspaces/".concat(e,"/campaigns/").concat(t,"/redeem/").concat(r)),a.Ay.capture(g.yx.REWARD.REDEEMED,{campaign:t,reward_code:r,workspace_id:e});return}catch(o){let n;throw i.logging.error("Failed to redeem campaign reward",{error:o,workspaceId:e,campaignName:t,rewardCode:r}),n=o instanceof Error?o:Error("Unknown error occurred while redeeming reward",{cause:o}),a.Ay.capture(g.yx.REWARD.REDEEM_FAILED,{campaign:t,reward_code:r,workspace_id:e,error_message:n.message}),n}},v={key:p.A.CLAIM_REWARD,paramsSchema:n.Ik({campaignId:n.Yj().regex(/^[a-zA-Z0-9-]+$/),rewardCode:n.Yj().regex(/^[a-zA-Z0-9-]+$/)}),execute:async(e,t)=>{let{campaignId:r,rewardCode:a}=e,{workspaces:n,selectedWorkspaceId:o}=t,i=o;return(!i&&n&&n.length>0&&(i=(e=>{if(1===e.length){let t=e[0],{isPaidPlan:r}=(0,s.cb)(t.plan);if(!r)return t.id}return null})(n)),i)?(await f(i,r,a),{redirectUrl:"/?change_type=upgrade&payment_status=success",invalidateQueries:[c.workspaceKeys.all],workspaceUpdate:{workspaceId:i,updates:{plan:l.VL.KTLO}}}):{redirectUrl:"/lp/".concat(r,"?reward_code=").concat(a)}}},h={key:p.A.REMIX_PROJECT,paramsSchema:n.Ik({projectId:n.Yj().regex(/^[a-zA-Z0-9_-]+$/),initialMessage:n.Ik({id:n.Yj(),message:n.Yj(),files:n.YO(n.Ik({file_id:n.Yj(),type:n.fc(u.g),file_name:n.Yj().optional(),mime_type:n.Yj().optional()})).optional(),selected_elements:n.YO(n.bz()).length(0),chat_only:n.zM().optional()}).optional()}),execute:async(e,t)=>{let{projectId:r}=e,{workspaces:a,selectedWorkspaceId:n}=t;try{var s;let t,l=(0,o.P)(),u=0;for(;u<3;)try{t=await l.get("/permissions?projectId=".concat(r));break}catch(e){if(++u>=3)return i.logging.error("Failed to fetch permissions after retries",{error:e,projectId:r,retries:u}),{redirectUrl:"/projects/".concat(r)};await new Promise(e=>setTimeout(e,1e3*u))}let m=t.includes(d.eZ.EditProject),g=t.includes(d.eZ.RemixProject);if(m)return{redirectUrl:"/projects/".concat(r)};if(!g)return{redirectUrl:"/"};let p=n||(null==a||null==(s=a[0])?void 0:s.id);if(!p)return i.logging.error("No workspace available for remix",{projectId:r}),{redirectUrl:"/"};let f=await l.get("/projects/".concat(r,"/details")),v=f.display_name||f.name||r,h={include_history:!1,include_custom_knowledge:!1,workspace_id:p,initial_message:e.initialMessage},w=await l.post("/projects/".concat(r,"/remix/init"),h);return localStorage.setItem("pendingRemixJob",JSON.stringify({jobId:w.job_id,projectId:r,projectName:v,timestamp:Date.now()})),{redirectUrl:"/",invalidateQueries:[c.gO.all]}}catch(e){return i.logging.error("Failed to execute remix project action",{error:e,projectId:r}),(0,m.Ni)(e),{redirectUrl:"/projects/".concat(r)}}}}},11675:(e,t,r)=>{r.d(t,{J:()=>o,p:()=>l});var a=r(75222),n=r(1133);let o=a.Ik({frame:a.Yj().optional(),id:a.Yj().optional(),loc:a.Ik({file:a.Yj().optional(),line:a.ai().optional(),column:a.ai().optional()}).optional(),message:a.Yj(),plugin:a.Yj().optional(),pluginCode:a.Yj().optional(),stack:a.Yj().optional()}).transform(e=>({...e,error_type:n.B.IMMEDIATE_RUNTIME})),i=a.Ik({body:a.Yj(),message:a.Yj(),status:a.ai(),statusText:a.Yj().optional(),url:a.Yj()}),s=a.Ik({message:a.Yj(),method:a.k5(["OPTIONS","GET","POST","PUT","DELETE","PATCH"]),origin:a.Yj().optional(),stack:a.Yj().optional(),url:a.Yj()}),l=a.KC([i,s])},14618:(e,t,r)=>{r.d(t,{l:()=>o});var a=r(95661),n=r(65616);let o=()=>({upload:(0,a.useCallback)(async e=>{let{fileName:t,file:r,options:a,continueOnError:o=!0}=e;return(0,n.QM)(t,r,a,o)},[]),download:(0,a.useCallback)(async e=>(0,n.PE)(e),[])})},27549:(e,t,r)=>{r.d(t,{C5:()=>w,MJ:()=>v,Rr:()=>h,eI:()=>p,lR:()=>f,lV:()=>c,zB:()=>d});var a=r(77145),n=r(55851),o=r(95661),i=r(52037),s=r(77563),l=r(56024);let c=i.Op,u=o.createContext({}),d=e=>{let{...t}=e;return(0,a.jsx)(u.Provider,{value:{name:t.name},children:(0,a.jsx)(i.xI,{...t})})},m=()=>{let e=o.useContext(u),t=o.useContext(g),{getFieldState:r,formState:a}=(0,i.xW)(),n=r(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:s}=t;return{id:s,name:e.name,formItemId:"".concat(s,"-form-item"),formDescriptionId:"".concat(s,"-form-item-description"),formMessageId:"".concat(s,"-form-item-message"),...n}},g=o.createContext({}),p=o.forwardRef((e,t)=>{let{className:r,...n}=e,i=o.useId();return(0,a.jsx)(g.Provider,{value:{id:i},children:(0,a.jsx)("div",{ref:t,className:(0,l.cn)("space-y-2",r),...n})})});p.displayName="FormItem";let f=o.forwardRef((e,t)=>{let{className:r,...n}=e,{error:o,formItemId:i}=m();return(0,a.jsx)(s.Label,{ref:t,className:(0,l.cn)(o&&"",r),htmlFor:i,...n})});f.displayName="FormLabel";let v=o.forwardRef((e,t)=>{let{...r}=e,{error:o,formItemId:i,formDescriptionId:s,formMessageId:l}=m();return(0,a.jsx)(n.DX,{ref:t,id:i,"aria-describedby":o?"".concat(s," ").concat(l):"".concat(s),"aria-invalid":!!o,...r})});v.displayName="FormControl";let h=o.forwardRef((e,t)=>{let{className:r,...n}=e,{formDescriptionId:o}=m();return(0,a.jsx)("p",{ref:t,id:o,className:(0,l.cn)("text-sm text-muted-foreground",r),...n})});h.displayName="FormDescription";let w=o.forwardRef((e,t)=>{let{className:r,children:n,...o}=e,{error:i,formMessageId:s}=m(),c=i?String(null==i?void 0:i.message):n;return c?(0,a.jsx)("p",{ref:t,id:s,className:(0,l.cn)("text-xs font-medium text-destructive-primary",r),...o,children:c}):null});w.displayName="FormMessage"},27912:(e,t,r)=>{r.d(t,{V:()=>i});var a=r(95661);let n=null,o=null;function i(){var e;let t=null!=(e=window.MOBILE_CLIENT_VERSION)?e:null,i=!!t;return{getBridge:(0,a.useCallback)(async()=>i?n||(o||(o=(async()=>{try{let{linkBridge:e}=await r.e(9582).then(r.bind(r,39582)),t=e({timeout:6e4});try{Reflect.set(t,"then",void 0)}catch(e){console.warn("[useNativeAppBridge] Unable to remove bridge.then",e)}return n=t,t}catch(e){return o=null,n=null,null}})()),o):null,[i]),isAvailable:i,clientVersion:t}}},30542:(e,t,r)=>{r.d(t,{O:()=>c,j:()=>u});var a=r(95661),n=r(83220),o=r(93723),i=r(82149),s=r(6279),l=r(40074);let c=e=>{let{projectId:t,projectName:r,useCacheBuster:a,sha:n,accessToken:o,useCustomScript:i,hideBadge:s}=e;if(!t&&!r)throw Error("projectId or projectName must be provided");if(t&&r)throw Error("projectId and projectName cannot both be provided");let c=l.env.NEXT_PUBLIC_PROXY_WORKER_PROTOCOL||"https",u=l.env.NEXT_PUBLIC_PROXY_WORKER_PORT?":".concat(l.env.NEXT_PUBLIC_PROXY_WORKER_PORT):"",d=n?"-".concat(n.slice(0,8)):"";try{let e=new URL("".concat(c,"://").concat(void 0!==r?"preview":"id-preview").concat(d,"--").concat(r||t,".").concat("lovable.app").concat(u));return a&&e.searchParams.set("cache",Date.now().toString()),o&&e.searchParams.set("__lovable_token",o),i&&e.searchParams.set("lov-override-script","true"),s&&e.searchParams.set("forceHideBadge","true"),e.toString()}catch(e){return window.location.href="/","/"}},u=function(){let{useCacheBuster:e,sha:t,useCustomScript:r,hideBadge:l,includeAccessToken:u=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=(0,s.B)(),m=(0,i.Iw)(e=>e.project),g=(0,n.j4)(e=>e.currentWorkspace),p=(0,o.ny)(u?d:void 0),f=null==m?void 0:m.name,v=(0,a.useMemo)(()=>{if(u&&!p.data)return null;let a=(null==g?void 0:g.disable_named_previews)||!f;if(!a&&!f)return null;try{return c({projectId:a?d:void 0,projectName:a?void 0:f,useCacheBuster:e,sha:t,accessToken:u?p.data:void 0,useCustomScript:r,hideBadge:l})}catch(e){return console.error("Error generating preview URL",e),null}},[d,f,null==g?void 0:g.disable_named_previews,e,t,l,u,p.data,r]);return{previewUrl:v,isLoading:!!u&&(p.isLoading||!v),error:u?p.error:null,project:m,projectId:d}}},32240:(e,t,r)=>{r.d(t,{AB:()=>c,J5:()=>u,Qp:()=>l,pX:()=>p,tH:()=>g,tJ:()=>m,w1:()=>d});var a=r(77145),n=r(55851),o=r(95661),i=r(69730),s=r(56024);let l=o.forwardRef((e,t)=>{let{...r}=e;return(0,a.jsx)("nav",{ref:t,"aria-label":"breadcrumb",...r})});l.displayName="Breadcrumb";let c=o.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("ol",{ref:t,className:(0,s.cn)("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2",r),...n})});c.displayName="BreadcrumbList";let u=o.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("li",{ref:t,className:(0,s.cn)("inline-flex items-center gap-1.5",r),...n})});u.displayName="BreadcrumbItem";let d=o.forwardRef((e,t)=>{let{asChild:r,className:o,...i}=e,l=r?n.DX:"a";return(0,a.jsx)(l,{ref:t,className:(0,s.cn)("transition-colors hover:text-foreground",o),...i})});d.displayName="BreadcrumbLink";let m=o.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("span",{ref:t,role:"link","aria-disabled":"true","aria-current":"page",className:(0,s.cn)("max-w-[10ch] truncate font-normal text-foreground md:max-w-[20ch]",r),...n})});m.displayName="BreadcrumbPage";let g=e=>{let{children:t,className:r,...n}=e;return(0,a.jsx)("li",{role:"presentation","aria-hidden":"true",className:(0,s.cn)("[&>svg]:h-3.5 [&>svg]:w-3.5",r),...n,children:null!=t?t:(0,a.jsx)(i.A,{name:"chevron_right"})})};g.displayName="BreadcrumbSeparator";let p=e=>{let{className:t,...r}=e;return(0,a.jsxs)("span",{role:"presentation","aria-hidden":"true",className:(0,s.cn)("flex h-9 w-9 items-center justify-center",t),...r,children:[(0,a.jsx)(i.A,{name:"ellipsis_horizontal",className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"More"})]})};p.displayName="BreadcrumbElipssis"},32313:(e,t,r)=>{r.d(t,{T:()=>i});var a=r(77145),n=r(95661),o=r(56024);let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("textarea",{className:(0,o.cn)("flex w-full rounded-md border border-input bg-muted px-2 py-2 text-sm transition-colors duration-150 ease-in-out placeholder:text-muted-foreground hover:border-ring/20 focus-visible:border-ring focus-visible:outline-none disabled:cursor-not-allowed disabled:border-input disabled:opacity-50",r),ref:t,...n})});i.displayName="Textarea"},32736:(e,t,r)=>{r.d(t,{A:()=>n,M:()=>a});var a=function(e){return e.EXISTING_USER_LOGIN="existingUserLogin",e.SIGNUP="signup",e.SEGMENTATION="segmentation",e}({}),n=function(e){return e.CLAIM_REWARD="claimReward",e.REMIX_PROJECT="remixProject",e}({})},33425:(e,t,r)=>{r.d(t,{d3:()=>c,if:()=>s,o_:()=>u,ou:()=>l});var a=r(18502),n=r(63851),o=r(19620),i=r(21227);let s=async e=>{let t=await e.getIdToken();await fetch("/api/login",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}})},l=async e=>{try{let t=(0,n.P)();return await t.post("/user/sso/join-workspaces"),o.logging.info("SSO workspace auto-join successful",e),!0}catch(t){return o.logging.error("SSO workspace auto-join failed",{error:t,...e}),!1}},c=async()=>{try{let e=(0,n.P)(),t=(0,i.D)();return(await e.post("/user/sso/check-registration",{tracking_data:t})).is_new_registration}catch(e){return o.logging.error("Failed to check SSO registration",{error:e}),!1}},u=e=>{var t,r;let o=(0,n.g)(),{data:i,isLoading:s,error:l}=(0,a.I)({queryKey:["sso-provider",e],queryFn:async()=>{let t=await o.post("/sso/check-sso-provider-id",{display_name_or_provider_id:e});return{provider:t.provider_id,displayName:t.display_name}}});return{isLoadingSSO:s,ssoError:l,ssoProviderId:null!=(t=null==i?void 0:i.provider)?t:e,ssoProviderDisplayName:null!=(r=null==i?void 0:i.displayName)?r:e}}},43831:(e,t,r)=>{r.d(t,{F:()=>g});var a=r(75698),n=r(13410),o=r(26294),i=r(95661),s=r(50514),l=r(33425),c=r(87240),u=r(6835),d=r(35418),m=r(27912);let g=e=>{let{referralCode:t}=e,[r,g]=(0,s.A)("lastUsedAuthMethod",{defaultValue:null}),[p,f]=(0,i.useState)(!1),[v,h]=(0,i.useState)(!1),w=(0,o.c3)("Auth"),_=(0,n.useRouter)(),b=(0,c.bl)(),S=(0,c.Vy)(),{signInWithGoogle:y,isNativeAuthAvailable:E,clientVersion:x}=function(){let{getBridge:e,isAvailable:t,clientVersion:r}=(0,m.V)();return{isNativeAuthAvailable:t,signInWithGoogle:(0,i.useCallback)(async()=>{var t;let r=await e();return(null==r?void 0:r.isWebViewBridgeAvailable)&&(null==(t=r.isNativeMethodAvailable)?void 0:t.call(r,"googleSignIn"))?await r.googleSignIn():null},[e]),clientVersion:r}}(),k=(0,i.useCallback)(async(e,r)=>{try{if(g(r),!e)return void(0,u.tu)({error:Error("User credential undefined - possible email conflict or account issue"),title:w("error"),description:w("errors.accountOrEmailIssue"),context:"sign-in with "+r});await (0,l.if)(e.user),_.refresh(),await (0,l.d3)()?(await b(e.user,t),S("/getting-started")):S()}catch(e){console.error(e),(0,u.tu)({error:e,title:w("error"),description:w("errors.accountOrEmailIssue"),context:"sign-in with "+r})}},[g,b,S,t,_]),I=(0,i.useCallback)(async()=>{f(!0);try{if(E){let e=await y();if(!(null==e?void 0:e.idToken))throw Error("No ID token received from native bridge");let t=a.HF.credential(e.idToken),r=await (0,a.eN)(d.auth,t);await k(r,"google")}else{let e=new a.HF;e.addScope("email");let t=await (0,a.df)(d.auth,e);await k(t,"google")}}catch(e){console.error("[handleGoogleSignIn] Error:",e),(0,u.tu)({error:e,title:w("error"),description:w("errors.googleAuthFailed"),context:"google sign-in"})}finally{f(!1)}},[k,w,E,y]),R=(0,i.useCallback)(async()=>{h(!0);try{let e=new a.Dt;e.addScope("user:email");let t=await (0,a.df)(d.auth,e);await k(t,"github")}catch(e){(0,u.tu)({error:e,title:w("error"),description:w("errors.githubAuthFailed"),context:"github sign-in"})}finally{h(!1)}},[k,w]);return{handleSsoPostAuth:k,handleGoogleSignIn:I,handleGithubSignIn:R,googleSignInLoading:p,githubSignInLoading:v,lastUsedMethod:r,clientVersion:x}}},50444:(e,t,r)=>{r.d(t,{z:()=>u});var a=r(87299),n=r(95661),o=r(28717),i=r(49493),s=r(19620),l=r(70556);let c="post-auth-action",u=()=>{let e=(0,a.jE)(),{userData:t}=(0,o.ur)(),r=(0,i.k9)(),{workspaces:u}=(0,i.Mu)(e=>({workspaces:e.workspaces})),d=(0,n.useCallback)((e,t,r)=>{try{let a={key:e,params:t,contexts:r,timestamp:Date.now()},n=l.WS.get(e);if(!n)return void s.logging.error("Unknown post-auth action",{actionKey:e,availableActions:Array.from(l.WS.keys())});let o=n.paramsSchema.safeParse(t);if(!o.success)return void s.logging.error("Invalid params for post-auth action",{actionKey:e,params:t,error:o.error});localStorage.setItem(c,JSON.stringify(a))}catch(t){s.logging.error("Failed to store post-auth action",{error:t,actionKey:e})}},[]),m=(0,n.useCallback)(async(a,n,o)=>{let i=l.WS.get(a);if(!i)return s.logging.error("Unknown post-auth action",{actionKey:a,availableActions:Array.from(l.WS.keys())}),"/";let c=i.paramsSchema.safeParse(n);if(!c.success)return s.logging.error("Invalid params for post-auth action",{actionKey:a,params:n,error:c.error}),"/";let d={userId:null==t?void 0:t.id,workspaces:u,...o},m=await i.execute(c.data,d);if(m.workspaceUpdate&&(null==r?void 0:r.store)){let e=r.store.getState().workspaces.map(e=>e.id===m.workspaceUpdate.workspaceId?{...e,...m.workspaceUpdate.updates}:e);r.store.setState({workspaces:e})}return m.invalidateQueries&&m.invalidateQueries.length>0&&setTimeout(()=>{m.invalidateQueries.forEach(t=>{e.invalidateQueries({queryKey:t})})},2e3),m.redirectUrl||"/"},[e,t,r,u]);return{storeAction:d,executeStoredAction:(0,n.useCallback)(async()=>{try{let e=localStorage.getItem(c);if(!e)return"/";let t=JSON.parse(e),r=l.th.safeParse(t);if(!r.success)return s.logging.error("Invalid stored action",{error:r.error}),localStorage.removeItem(c),"/";let a=r.data;if(a.timestamp&&Date.now()-a.timestamp>864e5)return localStorage.removeItem(c),"/";let n=await m(a.key,a.params);return localStorage.removeItem(c),n}catch(e){if(localStorage.removeItem(c),s.logging.error("Failed to execute stored action",{error:e}),e instanceof Error)throw e;throw Error("Unknown error occurred while executing stored action",{cause:e})}},[m]),executeAction:m,shouldRunAction:(0,n.useCallback)(e=>{try{let t=localStorage.getItem(c);if(!t)return!1;let r=JSON.parse(t),a=l.th.safeParse(r);if(!a.success)return localStorage.removeItem(c),!1;return a.data.contexts.includes(e)}catch(t){return s.logging.error("Failed to check if action should run",{error:t,context:e}),!1}},[])}}},52426:(e,t,r)=>{r.d(t,{U1:()=>d,py:()=>l,sK:()=>c,wV:()=>u});var a=r(77145),n=r(95661),o=r(84510),i=r(94197);let s=(0,n.createContext)(null),l=e=>{let{children:t}=e,r=(0,n.useRef)((0,o.vt)()((0,i.D)(e=>({isSendChatMessageMutationPending:!1,isBuildErrorOccurredDuringStream:!1,isSomeRevertMutationPending:!1,isApplyingTheme:!1,editIdToConfirmRestoreFor:void 0})))),l=(0,n.useCallback)(e=>{r.current.setState({isSendChatMessageMutationPending:e,isBuildErrorOccurredDuringStream:!1})},[]),c=(0,n.useCallback)(e=>{r.current.setState({isSomeRevertMutationPending:e})},[]),u=(0,n.useCallback)(e=>{r.current.setState({isBuildErrorOccurredDuringStream:e})},[]),d=(0,n.useCallback)(e=>{r.current.setState({isApplyingTheme:e})},[]),m=(0,n.useCallback)(e=>{r.current.setState({editIdToConfirmRestoreFor:e})},[]),g=(0,n.useMemo)(()=>({store:r.current,setIsSendChatMessageMutationPending:l,setIsBuildErrorOccurredDuringStream:u,setIsSomeRevertMutationPending:c,setIsApplyingTheme:d,setEditIdToConfirmRestoreFor:m}),[l,u,c,d,m]);return(0,a.jsx)(s.Provider,{value:g,children:t})};function c(){let e=(0,n.useContext)(s);if(!e)throw Error("useMessageSubmissionContext must be used within a MessageSubmissionProvider");return e}function u(e){let{store:t}=c();return t(e)}let d=()=>{let{isSendChatMessageMutationPending:e,isSomeRevertMutationPending:t}=u(e=>e);return e||t}},53103:(e,t,r)=>{r.d(t,{a:()=>n});var a=r(21016);let n=()=>(0,a.A)("md")},60935:(e,t,r)=>{r.d(t,{N:()=>i});var a=r(19620),n=r(75032);let o=(0,n.createServerReference)("400d4ed7b6d47204c0312befe59b1182e855475a31",n.callServer,void 0,n.findSourceMapURL,"handleInterceptedError");async function i(e,t,r){try{let n=await o(e);if(!n)return void a.logging.debug("skipping_reporting_error",{error:e,err_message:e.message});let i=n.error_type;await r.post("/projects/".concat(t,"/report_error"),{message:null==n?void 0:n.message,error_type:i,meta_data:n})}catch(e){a.logging.error("failed_to_report_intercepted_error",{error:e})}}},61884:(e,t,r)=>{r.d(t,{P:()=>a});let a=(0,r(84510).vt)(e=>({shouldShowReferralNotice:!1,setIsSuccessfulReferral:()=>e({shouldShowReferralNotice:!0})}))},62548:(e,t,r)=>{r.d(t,{g:()=>a});var a=function(e){return e.USER_UPLOAD="user_upload",e.IFRAME_SNAPSHOT="iframe_snapshot",e}({})},65616:(e,t,r)=>{r.d(t,{PE:()=>i,QM:()=>o,QN:()=>s});var a=r(63851),n=r(19620);let o=async function(e,t,o){var i,s;let l=!(arguments.length>3)||void 0===arguments[3]||arguments[3],c=null!=(i=null==o?void 0:o.maxFileSize)?i:3145728,u=null!=(s=null==o?void 0:o.maxDimension)?s:2e3,d=t;if(t.type.startsWith("image/"))if(["image/svg+xml","image/gif","image/x-icon","image/vnd.microsoft.icon"].includes(t.type))d=t;else{let e=new Image,a=URL.createObjectURL(t);try{if(await new Promise(t=>{e.onload=()=>{URL.revokeObjectURL(a),t()},e.onerror=()=>{URL.revokeObjectURL(a),t()},e.src=a}),t.size>c||Math.max(e.width,e.height)>u)try{let{default:e}=await r.e(4088).then(r.bind(r,94088));d=await e(t,{maxSizeMB:c/1024/1024,maxWidthOrHeight:Math.min(u,1920),useWebWorker:!0})}catch(e){if(n.logging.error("Error compressing image:",{error:e}),!l)throw e}}catch(e){n.logging.warn("Could not process image for compression, using original",{error:e}),d=t}}let m={file_name:e,content_type:d.type,status:"uploading"},g=await (0,a.P)().post("/files/generate-upload-url",m),p=await fetch(g.url,{method:"PUT",body:d,headers:{"Content-Type":d.type}});if(!p.ok){let t=Error("Upload failed with status ".concat(p.status));if(n.logging.error("File upload failed:",{fileName:e,status:p.status}),!l)throw t}},i=async e=>(0,a.P)().post("/files/generate-download-url",e),s=async e=>(0,a.P)().post("/files/generate-public-url",e)},67412:(e,t,r)=>{r.d(t,{A:()=>w});var a=r(77145),n=r(46753),o=r.n(n),i=r(13410),s=r(26294),l=r(95661),c=r(52811),u=r(20247),d=r(27458),m=r(21016),g=r(43831),p=r(56455),f=r(56024),v=r(35418),h=r(51762);let w=()=>{let e=(0,h.f)(_),t=(0,i.useRouter)(),r=(0,m.A)("md"),a=(0,l.useMemo)(()=>(0,p.t9)(),[]);return(0,l.useCallback)(async n=>{if(r){let e="".concat("login"===n?"/login":"/signup","?should-refresh-credentials=1");if(a){try{await fetch("/api/logout"),await v.auth.signOut()}catch(e){}window.location.assign(e)}else t.push(e);return}e({childProps:{type:n||"login"}})},[e,r,a,t])},_=e=>{let{type:t}=e,r=(0,i.useSearchParams)(),n=(0,s.c3)("AuthDialog"),l=(0,s.c3)("Auth"),m=r.get("referral_code"),{handleGoogleSignIn:p,handleGithubSignIn:v,googleSignInLoading:h,githubSignInLoading:w,lastUsedMethod:_}=(0,g.F)({referralCode:m});return(0,a.jsxs)(u.Cf,{className:"max-h-[90vh] overflow-y-auto bg-popover",size:"sm",children:[(0,a.jsxs)("div",{className:"flex flex-col items-start justify-start gap-4",children:[(0,a.jsx)(d.Fy,{className:"h-9 w-9"}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)(u.L3,{className:"text-3xl font-medium",children:n("title")}),(0,a.jsx)(u.rr,{className:"-mt-2 text-3xl font-medium text-muted-foreground/50",children:n("login"==t?"logInDescription":"signUpDescription")})]})]}),(0,a.jsxs)("div",{className:"mt-2 flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(c.$,{onClick:p,variant:"outline",loading:h,disabled:w,className:(0,f.cn)("relative flex w-full items-center justify-center","google"===_&&"border border-affirmative-primary shadow-none"),children:[(0,a.jsx)(d.gu,{name:"Google",className:"absolute left-4 h-4 w-4 flex-shrink-0"}),(0,a.jsx)("span",{children:l("continueWithGoogle")})]}),"google"===_&&(0,a.jsx)("div",{className:"absolute -right-2 -top-2",children:(0,a.jsx)("span",{className:"rounded-lg border border-affirmative-primary bg-affirmative px-1.5 py-0.5 text-xs text-affirmative-foreground shadow-md",children:l("lastUsed")})})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(c.$,{onClick:v,variant:"outline",loading:w,disabled:h,className:(0,f.cn)("relative flex w-full items-center justify-center","github"===_&&"border border-affirmative-primary shadow-none"),children:[(0,a.jsx)(d.gu,{name:"GitHub",className:"absolute left-4 h-4 w-4 flex-shrink-0"}),n("continueWithGitHub")]}),"github"===_&&(0,a.jsx)("div",{className:"absolute -right-2 -top-2",children:(0,a.jsx)("span",{className:"rounded-lg border border-affirmative-primary bg-affirmative px-1.5 py-0.5 text-xs text-affirmative-foreground shadow-md",children:l("lastUsed")})})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,a.jsx)("span",{className:"w-full border-t"})}),(0,a.jsx)("div",{className:"relative flex justify-center text-xs uppercase",children:(0,a.jsx)("span",{className:"bg-background px-2 text-muted-foreground",children:l("or")})})]}),(0,a.jsx)(c.$,{className:"w-full",variant:"default",id:"email-login-button",asChild:!0,children:(0,a.jsx)(o(),{href:"".concat("login"===t?"/login":"/signup"),children:n("continueWithEmail")})}),"signup"===t&&(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:l.rich("byContinuingSignup",{termsLink:e=>(0,a.jsx)(o(),{href:"/terms",className:"underline underline-offset-4 hover:text-primary",children:e}),privacyLink:e=>(0,a.jsx)(o(),{href:"/privacy",className:"underline underline-offset-4 hover:text-primary",children:e})})})]})]})}},69777:(e,t,r)=>{r.d(t,{A2:()=>a.A,MR:()=>a.M});var a=r(32736);r(70556),r(11070)},70556:(e,t,r)=>{r.d(t,{WS:()=>s,th:()=>l});var a=r(75222),n=r(11070),o=r(32736);let i=[n.K,n.N],s=new Map;i.forEach(e=>{s.set(e.key,e)}),Object.fromEntries(i.map(e=>[e.key,e.paramsSchema]));let l=a.gM("key",i.map(e=>{let t,r;return t=e.key,r=e.paramsSchema,a.Ik({key:a.eu(t),params:r.optional(),contexts:a.YO(a.fc(o.M)),timestamp:a.ai().optional()})}))},75239:(e,t,r)=>{r.d(t,{X:()=>p,V:()=>f});var a=r(77145),n=r(95661),o=r(84510),i=r(60935),s=r(6279),l=r(19620),c=r(75222);let u=c.Ik({message:c.Yj().min(1),stack:c.Yj().optional(),filename:c.Yj().optional(),lineno:c.ai().optional(),colno:c.ai().optional(),blankScreen:c.zM().optional()});var d=r(63851);let m=()=>(0,o.vt)(()=>({runtimeErrors:[],latestBuildTimestamp:0})),g=(0,n.createContext)({store:m(),clearDiagnostics:()=>{},clearBlankScreenErrors:()=>{},updateLatestBuildTimestamp:()=>{},addRuntimeError:()=>{throw Error("ProjectDiagnostics must be used within a ProjectDiagnosticsProvider")}}),p=e=>{let{children:t}=e,r=(0,s.M)();if(!r)throw Error("Project ID is required and should always be set here");let o=(0,n.useRef)(void 0);o.current||(o.current=m());let c=(0,d.P)(),p={store:o.current,clearDiagnostics:()=>{o.current.setState({runtimeErrors:[]})},addRuntimeError:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"RUNTIME_ERROR",a=function(e){let t=u.safeParse(e);return t.success?(t.data.stack||l.logging.warn("diagnostics.runtime_error.stack_missing",{parse_error:t.error,error_data:e}),t.data.filename||l.logging.warn("diagnostics.runtime_error.filename_missing",{parse_error:t.error,error_data:e}),t.data):(l.logging.error("diagnostics.runtime_error.invalid",{parse_error:t.error,error_data:e}),null)}(e);if(!a)return;a.blankScreen&&(0,i.N)({...a,error_type:"runtime"},r,c).catch(e=>{l.logging.error("error_reporting_runtime_error",{error:e})});let n=o.current,s=function(e,t){let r={timestamp:Date.now(),error_type:e,message:t.message||"Unknown error",filename:t.filename||"Unknown file",lineno:t.lineno||0,colno:t.colno||0,stack:t.stack||"Unavailable",has_blank_screen:(null==t?void 0:t.blankScreen)||!1};return r.message.length>1e4&&(r.message=r.message.slice(0,1e4)),r.stack.length>1e4&&(r.stack=r.stack.slice(0,1e4)),r}(t,a);n.setState(e=>{let t=[...e.runtimeErrors],r=t.findIndex(e=>0==e.lineno?e.message===s.message:e.filename===s.filename&&e.colno===s.colno&&e.lineno===s.lineno);-1!==r&&t.splice(r,1),t.push(s);let a=t.reduce((e,t)=>e+v(t),0);for(;a>1e5||t.length>50;){let e=t.shift();if(!e)break;a-=v(e)}return{runtimeErrors:t}})},updateLatestBuildTimestamp:e=>{let t=o.current;e>t.getState().latestBuildTimestamp&&t.setState({latestBuildTimestamp:e})},clearBlankScreenErrors:()=>{let e=o.current;e.setState({runtimeErrors:e.getState().runtimeErrors.filter(e=>!e.has_blank_screen)})}};return(0,a.jsx)(g.Provider,{value:p,children:t})};function f(){return(0,n.useContext)(g)}let v=e=>{var t,r,a,n,o,i;return((null==(t=e.error_type)?void 0:t.length)||0)+((null==(r=e.message)?void 0:r.length)||0)+((null==(a=e.filename)?void 0:a.length)||0)+((null==(n=e.lineno)?void 0:n.toString().length)||0)+((null==(o=e.colno)?void 0:o.toString().length)||0)+((null==(i=e.stack)?void 0:i.length)||0)}},85090:(e,t,r)=>{r.d(t,{Z:()=>c});let a={preview:/^preview(?:-([a-zA-Z0-9]+))?--(.+)$/,idPreview:/^id-preview(?:-([a-zA-Z0-9]+))?--(.+)$/,deployment:/^([a-z0-9](?:[a-z0-9-]*[a-z0-9])?)$/};var n=function(e){return e.PREVIEW="preview",e.ID_PREVIEW="id-preview",e.DEPLOYMENT="deployment",e}({}),o=r(46926);let i=["lovableproject.com","lovableproject-dev.com"],s=["lovable.app","gpt-eng.com","gptengineer.run"],l={[n.PREVIEW]:{prefix:"preview",useProjectId:!1},[n.ID_PREVIEW]:{prefix:"id-preview",useProjectId:!0}},c=e=>{if(null==e?void 0:e.split(".").find(e=>e.startsWith("xn--")))return{mode:"customDomain",customDomain:e};let[t,r]=e.split(/\.(.*)/),c=i.includes(r),u=s.includes(r);if(!(c||u)){let t=(0,o.qg)(e);if(!t.domain)throw Error("parseLovableDomain: Invalid domain: "+e);return{mode:"customDomain",customDomain:t.subdomain?t.subdomain+"."+t.domain:t.domain}}if(c)return{mode:"livePreview",projectID:t,tldp1:r};let d=(e=>a.preview.test(e)?"preview":a.idPreview.test(e)?"id-preview":a.deployment.test(e)?"deployment":null)(t);if(!d)throw Error("Not valid preview domain");if(d==n.DEPLOYMENT)return{mode:"deployment",projectName:t};let m=t.split("--");if(2!==m.length)throw Error("Invalid domain syntax: "+t);let[g,p]=m;if(!p)throw Error("Invalid domain syntax - missing project identifier "+t);let f=g.replace(l[d].prefix,""),v={mode:"staticPreview",sha:f.startsWith("-")?f.substring(1):void 0,tldp1:r};if(d==n.ID_PREVIEW)return{...v,projectID:p};if(d==n.PREVIEW)return{...v,projectName:p};throw Error("Unknown preview type")}},87240:(e,t,r)=>{r.d(t,{Vy:()=>g,bU:()=>f,bl:()=>p,lq:()=>m});var a=r(13410),n=r(95661),o=r(50444),i=r(83473),s=r(63851),l=r(19620),c=r(69777),u=r(61884);let d="pending-collaboration-invite",m=()=>{let[e,t]=(0,n.useState)(null);return(0,n.useEffect)(()=>{try{let e=sessionStorage.getItem(d);if(e){let r=JSON.parse(e);t(r)}}catch(e){l.logging.error("Error reading pending collaboration invite:",{error:e})}},[]),{pendingInvite:e,clearPendingInvite:(0,n.useCallback)(()=>{sessionStorage.removeItem(d),t(null)},[])}},g=()=>{let e=(0,a.useSearchParams)(),{pendingInvite:t,clearPendingInvite:r}=m(),{shouldRunAction:i}=(0,o.z)();return(0,n.useCallback)((a,n)=>{if(i(c.MR.EXISTING_USER_LOGIN)){window.location.href="/auth/post-login";return}if(t){let e="".concat(t.projectUrl,"?magic_link=").concat(t.magicLink);r(),window.location.href=e;return}let o=(e=>{let t=new URL((null==e?void 0:e.get("redirect"))?decodeURIComponent(e.get("redirect")):"/",window.location.origin);return t.searchParams.set("should-refresh-credentials","1"),t})(e),s=new URLSearchParams(e);if(a){if((null==n?void 0:n.preserveRedirect)===!1?(s.delete("redirect"),s.set("should-refresh-credentials","1")):s.set("redirect",o.pathname+o.search),a.includes("?")){window.location.href=a+"&".concat(s.toString());return}window.location.href=a+"?".concat(s.toString());return}window.location.href=o.pathname+o.search},[e,t,r,i])},p=()=>{let{setIsSuccessfulReferral:e}=(0,u.P)();return(0,n.useCallback)(async(t,r)=>{if(!r)return;let a=(0,s.g)();try{let n=await t.getIdToken();await a.post("/user/referral-code/use",{referral_code:r},{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)}}),e()}catch(t){let e=(0,i.yO)(t);400===e.status&&(e.message=e.message||"Invalid referral code",e.details="Your sign-up will proceed without the referral bonus."),(0,i.Ni)(e)}},[e])},f=()=>{let[e,t]=(0,n.useState)(!1),[r,a]=(0,n.useState)(null);return{checkAuthProvider:(0,n.useCallback)(async e=>{if(!e||!e.includes("@"))return a(null),null;t(!0);try{let t=(0,s.g)(),r=await t.post("/auth/check-auth-provider",{email:e}),n={hasSSOProvider:r.has_sso_provider,ssoProviderID:r.sso_provider_id,ssoDisplayName:r.sso_display_name,workspaceID:r.workspace_id,firebaseProviders:r.firebase_providers||[],hasEmailPassword:r.has_email_password,recommendedProvider:r.recommended_provider};return a(n),n}catch(t){console.error("Error checking auth provider:",t),(0,i.Ni)({message:"Unable to verify your account settings",details:"You can still sign in with your email and password.",status:500});let e={hasSSOProvider:!1,ssoProviderID:void 0,ssoDisplayName:void 0,workspaceID:void 0,firebaseProviders:[],hasEmailPassword:!1,recommendedProvider:void 0};return a(e),e}finally{t(!1)}},[]),isChecking:e,authProvider:r,setAuthProvider:a}}},93723:(e,t,r)=>{r.d(t,{pA:()=>$,Yi:()=>C,jn:()=>Q,E7:()=>X,ny:()=>z,$E:()=>U,Nc:()=>M,sF:()=>O});var a=r(77145),n=r(85090),o=r(18502),i=r(86686),s=r(95661),l=r(63401),c=r(84510),u=r(94197),d=r(99916),m=r(92918),g=r(19620);let p=e=>{var t,r,a,n,o,i,s,l;let c=Object.entries(e.headers||{}).reduce((e,t)=>{let[r,a]=t;return e+r.length+String(a).length},0);return((null==(t=e.responseBody)?void 0:t.length)||0)+((null==(r=e.requestBody)?void 0:r.length)||0)+((null==(n=e.error)||null==(a=n.message)?void 0:a.length)||0)+((null==(i=e.error)||null==(o=i.stack)?void 0:o.length)||0)+((null==(s=e.url)?void 0:s.length)||0)+((null==(l=e.statusText)?void 0:l.length)||0)+c};var f=r(60935),v=r(6279),h=r(63851),w=r(30542),_=r(680),b=r(75239),S=r(1133),y=r(11675),E=r(75417),x=r(71148);let k=e=>{let{isLoading:t}=e,[r,n]=(0,s.useState)(0),[o,i]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{t&&(n(0),i(!0))},[t]),(0,s.useEffect)(()=>{if(!t)return void n(100);let e=[];return[{duration:150,increment:15},{duration:250,increment:10},{duration:400,increment:5},{duration:500,increment:3},{duration:650,increment:3},{duration:750,increment:3},{duration:1500,increment:2},{duration:2e3,increment:1},{duration:3e3,increment:1},{duration:4e3,increment:1},{duration:5e3,increment:1},{duration:6e3,increment:1},{duration:7e3,increment:1},{duration:1e4,increment:1},{duration:14e3,increment:1}].forEach(t=>{let{duration:r,increment:a}=t,o=setTimeout(()=>{n(e=>e<75?e+a+2*Math.random():e)},r);e.push(o)}),()=>{e.forEach(e=>clearTimeout(e))}},[t]),(0,a.jsx)("div",{className:"pointer-events-none absolute left-0 right-0 top-0 h-[3px] w-full overflow-hidden bg-transparent",children:(0,a.jsx)(E.N,{children:o&&(0,a.jsx)(x.P.div,{className:"h-full bg-accent",initial:{width:0,opacity:1},animate:{width:"".concat(Math.min(r,100),"%"),opacity:1},exit:{opacity:0,transition:{delay:.2,duration:.3}},transition:{width:{duration:.15,bounce:0}},onAnimationComplete:()=>{t||i(!1)}})})})};function I(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return"";try{let r=new URL(e);return t.useCustomScript&&r.searchParams.set("lov-override-script","true"),t.accessToken&&r.searchParams.set("__lovable_token",t.accessToken),r.toString()}catch(t){return console.error("Error formatting preview URL:",t),e}}function R(e){if(!e)return null;try{return e.replace("http://","ws://").replace("https://","wss://")}catch(e){return console.error("Error converting to WebSocket URL:",e),null}}var j=r(52426),N=r(2848),P=r(82149);let T=(0,s.createContext)(null);function C(e){let{children:t}=e,r=(0,v.B)(),[n]=(0,s.useState)(()=>(0,c.vt)()((0,u.D)(()=>({device:"desktop",customScript:!1,_sandboxState:null,_isSandboxStateStale:!1,targetMode:N.a.STATIC,activeMode:N.a.STATIC,visibleMode:N.a.STATIC,currentPath:"/",baseUrls:{static:(0,w.O)({projectId:r}),live:null},error:null,transientErrorCount:0,consoleLogs:[],networkRequests:[],rrwebEvents:[],accessToken:void 0})))),o=(0,s.useRef)(null),d=(0,s.useRef)(null),p=(0,s.useMemo)(()=>({live:o,static:d}),[]),S=n(e=>e.targetMode===N.a.LIVE&&"running"===e._sandboxState?N.a.LIVE:N.a.STATIC),E=(0,m.Tp)(_.x.PreviewStabilityGuard);(0,s.useEffect)(()=>{n.setState(e=>{e.activeMode=S})},[S,n]),(0,s.useEffect)(()=>{if("live"!==S)return void n.setState(e=>{e.visibleMode=N.a.STATIC});let e=!1,t=()=>{e||(e=!0,n.setState(e=>{e.visibleMode=N.a.LIVE}))};if(E){let e=e=>{var r;(null==(r=e.data)?void 0:r.type)==="APP_READY"&&t()};window.addEventListener("message",e);let r=setTimeout(t,3e3);return()=>{window.removeEventListener("message",e),clearTimeout(r)}}{let e=setTimeout(t,3e3);return()=>clearTimeout(e)}},[S,n,E]);let x=n(e=>e.targetMode),k=n(e=>e._sandboxState);!function(e){let t=(0,h.P)(),r=(0,v.B)(),{setIsBuildErrorOccurredDuringStream:a}=(0,j.sK)(),n=(0,b.V)(),o=(0,s.useMemo)(()=>{let t=e.enabled&&e.url?new URL(e.url):null;return t?R("".concat(t.protocol,"//").concat(t.host)):null},[e.enabled,e.url]);(0,l.useWebSocket)(o,{protocols:"vite-hmr",share:!0,onMessage:e=>{try{let i=JSON.parse(e.data);if((null==i?void 0:i.type)==="update"){let e=Date.now()-500;n.updateLatestBuildTimestamp(e)}if((null==i?void 0:i.type)==="error"){var o;a(!0),g.logging.info("build_error_from_devserver",{message:null==i||null==(o=i.err)?void 0:o.message});let e=y.J.safeParse(null==i?void 0:i.err);e.success?(0,f.N)(e.data,r,t):(g.logging.error("error_parsing_devserver_error",{error:e}),(0,f.N)(null==i?void 0:i.err,r,t))}}catch(e){g.logging.error("error_parsing_devserver_error",{error:e})}},onOpen:t=>{var r;null==(r=e.onStatusChange)||r.call(e,"running"),g.logging.debug("devserver_websocket_open")},onClose:t=>{var r;null==(r=e.onStatusChange)||r.call(e,"stopped"),g.logging.debug("devserver_websocket_close")},onError:t=>{var r;null==(r=e.onStatusChange)||r.call(e,"error"),g.logging.debug("devserver_websocket_error",{event:t})},shouldReconnect:()=>!0,reconnectInterval:1e3})}({enabled:"live"===x&&"running"===k,url:n(e=>e.baseUrls.live)});let I=e=>{n.setState(t=>{t.device=e})},C=e=>{n.setState(t=>{t.customScript=e})},U=(0,s.useCallback)(()=>{n.setState(e=>{e.targetMode="static",e._sandboxState=null,e._isSandboxStateStale=!0,e.error=null})},[n]),M=(0,s.useCallback)(()=>{n.setState(e=>{("live"!==e.targetMode||"running"!==e._sandboxState||e.error)&&(e.targetMode="live",e._sandboxState="starting",e.error=null)})},[n]),O=(0,s.useCallback)(e=>{n.setState(t=>{t._sandboxState="starting",t.targetMode="live",t.error=null,e&&(t.transientErrorCount=0)})},[n]),L=(0,s.useCallback)(()=>{n.setState(e=>{e._sandboxState="error",e.error={type:"dev_server",message:"Sorry, we ran into an issue starting the live preview!"}})},[n]),z=(0,s.useCallback)(()=>{n.setState(e=>{e.transientErrorCount+=1}),n.getState().transientErrorCount<5?O():(E&&U(),L())},[O,L,n,E]),J=(0,s.useCallback)(async()=>{n.setState(e=>{e._sandboxState="starting",e.error=null});try{let e=(0,h.P)(),t=await e.post("/projects/".concat(r,"/sandbox/start"),{project_id:r});n.setState(e=>{t.url&&!t.url.endsWith("/")&&(t.url=t.url+"/"),e.baseUrls.live=t.url,e._isSandboxStateStale=!0})}catch(e){L()}},[r,L,n]),X=(0,s.useCallback)(async e=>{let t=n.getState();if("live"===t.targetMode&&(t.error||"error"===t._sandboxState)){O(),n.setState(t=>{t.currentPath=null!=e?e:"/"});return}if(e)n.setState(t=>{t.currentPath=e});else{var r;null==(r=p[t.targetMode].current)||r.reload()}},[p,O,n]),K=(0,s.useCallback)(()=>{n.setState(e=>{e._sandboxState="running",e.error=null})},[n]),Q=(0,s.useMemo)(()=>({store:n,setDevice:I,setCustomScript:C,startLiveMode:M,restartLiveMode:O,revertToStaticMode:U,refreshPreview:X,refs:p,buildFullPreviewUrl:q}),[]),$=(0,P.Iw)(e=>{var t;return null==(t=e.project)?void 0:t.latest_commit_sha}),Z=n(e=>"live"===e.targetMode&&"starting"===e._sandboxState)&&!!$;(0,s.useEffect)(()=>{Z&&J()},[J,Z]);let ee=(0,i.UQ)(18e5);return(0,a.jsxs)(T.Provider,{value:Q,children:[(0,a.jsx)(H,{}),(0,a.jsx)(A,{}),(0,a.jsx)(F,{}),"live"===S&&(0,a.jsx)(B,{}),"live"===x&&"error"!==k&&!ee&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Y,{}),(0,a.jsx)(W,{}),(0,a.jsx)(V,{}),(0,a.jsx)(D,{}),(0,a.jsx)(G,{onStarted:K,onFatalError:L,onTransientError:z,onInactivityTimeout:U})]}),t]})}function U(){let e=(0,s.useContext)(T);if(!e)throw Error("usePreviewContext must be used within a PreviewProvider");return e}function M(e){let{store:t}=U();return t(e)}function O(){let e=M(e=>e.baseUrls.live);return(0,s.useMemo)(()=>{if(!e)return null;let t=new URL(e);return R("".concat(t.protocol,"//").concat(t.host))},[e])}let L=async function(e){let{timeoutMs:t=9e3,maxRetries:r=3,retryDelay:a=2e3,backoffMultiplier:n=2,maxBackoff:o=3e4}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i="unknown";for(let s=0;s<=r;s++){let l=()=>{if(s>=r)return Promise.resolve();let e=Math.min(a*Math.pow(n,s),o);return new Promise(t=>setTimeout(t,e))};try{let r=new URL("_sandbox/dev-server",e),a=await fetch(r,{signal:AbortSignal.timeout(t)});if(!a.ok){let e=a.status>=500||429===a.status;if(i="offline",e){await l();continue}return i}try{let e=await a.json();switch(e.state){case"error":case"stopped":case"stopping":case"starting":case"started":case"disabled":return e.state;default:return g.logging.error("unexpected_dev_server_state",{state:e.state}),"unknown"}}catch(e){return g.logging.debug("malformed_dev_server_state_response",{error:e}),"error"}}catch(e){i="unknown",await l();continue}}return i};function A(){let e=U().refs[N.a.STATIC],t=(0,P.Iw)(e=>{var t;return null==(t=e.project)?void 0:t.preview_build_commit_sha}),r=(0,s.useRef)(t);return(0,s.useEffect)(()=>{if(t&&r.current&&t!==r.current){var a;null==(a=e.current)||a.reload()}r.current=t},[t,e]),null}function D(){let e=U().store;return(0,s.useEffect)(()=>{let t=!0;async function r(){let t=e.getState();if("running"!==t._sandboxState)return;let r=t.baseUrls.live;if(!r)return;let a=new URL(r).origin;try{await fetch("".concat(a,"/__l5e/proxy/keepAlive"),{method:"POST",signal:AbortSignal.timeout(1e3)})}catch(e){}}let a=setInterval(()=>{t&&r()},6e4);return()=>{t=!1,clearInterval(a)}},[e]),null}function B(){let e=U().refs[N.a.LIVE];return(0,s.useEffect)(()=>{var t;null==(t=e.current)||t.reload()},[e]),null}function F(){let e=M(e=>e.targetMode),t=U().startLiveMode,r=(0,j.wV)(e=>e.isSendChatMessageMutationPending);return(0,s.useEffect)(()=>{r&&"static"===e&&t()},[r,e,t]),null}function W(){let e=M(e=>e._isSandboxStateStale),t=U().store;return(0,s.useEffect)(()=>{if(e)return;let r=setTimeout(()=>{t.setState(e=>{e._isSandboxStateStale=!0})},"starting"===t.getState()._sandboxState?250:1e4);return()=>clearTimeout(r)},[e,t]),null}function Y(){let e=U().store;return(0,s.useEffect)(()=>{e.setState(e=>{e._isSandboxStateStale||(e._isSandboxStateStale=!0)})},[e]),null}function V(){let e=U().store;return(0,s.useEffect)(()=>{let t=()=>{"visible"===document.visibilityState&&e.setState(e=>{e._isSandboxStateStale||(e._isSandboxStateStale=!0)})};return document.addEventListener("visibilitychange",t),()=>document.removeEventListener("visibilitychange",t)},[e]),null}function G(e){let{onStarted:t,onTransientError:r,onFatalError:a,onInactivityTimeout:n}=e,o=M(e=>e._isSandboxStateStale),i=U().store,l=(0,v.B)();return(0,s.useEffect)(()=>{if(!o)return;let e=!0;return async function(){try{let o=i.getState().baseUrls.live;if(!o)return;let s=await L(o);if(!e)return;switch(s){case"offline":n();break;case"error":a();break;case"unknown":case"stopped":r();break;case"started":t()}}finally{if(!e)return;i.setState(e=>{e._isSandboxStateStale=!1})}}(),()=>{e=!1}},[o,a,r,t,n,i,l]),null}function H(){let e=U().store,t=(0,v.B)();return(0,s.useEffect)(()=>{(async()=>{let r=e.getState();if(!r.baseUrls.live&&null===r._sandboxState)try{let r=(0,h.P)(),a=await Promise.race([r.get("/projects/".concat(t,"/sandbox/url")),new Promise((e,t)=>setTimeout(()=>t(Error("API call timeout")),1e3))]);if(a.url){let t=await L(a.url,{timeoutMs:1e3,maxRetries:0});"started"===t&&e.setState(e=>{e.baseUrls.live=a.url,e._sandboxState="running",e.targetMode="live",e.activeMode="live",e.visibleMode="live"})}}catch(e){}})()},[e,t]),null}function q(e){let{baseUrl:t,path:r}=e;if(!t)return null;let a=t.endsWith("/")?t.slice(0,-1):t,n=r.startsWith("/")?r:"/".concat(r);return"".concat(a).concat(n)}let z=e=>(0,o.I)({queryKey:["projects",e,"accessToken"],queryFn:async()=>{let t=(0,h.P)(),{token:r}=await t.get("/projects/".concat(e,"/auth-token"));return r},enabled:!!e});function J(e){let{url:t,useCustomScript:r,onNavigate:o,onMessage:i,id:l,ref:c}=e,u=(0,d.g)(),m=(0,s.useRef)(null),[g,p]=(0,s.useState)(null),[f,v]=(0,s.useState)(!0),h=(0,P.Iw)(e=>e.project),_=z(null==h?void 0:h.id),b=!1;try{let e=(0,n.Z)(new URL(t||"").hostname);b="livePreview"===e.mode}catch(e){}let S=!!(null==h?void 0:h.id)&&!(null==h?void 0:h.is_protected)&&!b||!!_.data,y=g&&S?I(g,{useCustomScript:r,accessToken:_.data}):null;return(0,s.useImperativeHandle)(c,()=>({reload(){m.current&&(m.current.src=y||m.current.src)}}),[y]),(0,s.useEffect)(()=>{if(m.current&&t&&t!==g&&S){let e=I(t,{useCustomScript:r,accessToken:_.data});p(t),v(!0),m.current.src=e}},[_,S,g,o,t,r]),(0,s.useEffect)(()=>{let e=e=>{var t,r,a;if((null==(t=m.current)?void 0:t.contentWindow)===e.source)if("URL_CHANGED"===e.data.type){if(e.data.url!==g&&(p(e.data.url),e.data.url)){let{pathname:t,search:r,hash:a}=new URL(e.data.url),n=t;r&&(n+=r),a&&(n+=a),o(n)}}else"FORCE_RELOAD"===e.data.type?(null==(r=m.current)?void 0:r.contentWindow)&&(m.current.contentWindow.location.href=null!=(a=(0,w.O)({projectId:null==h?void 0:h.id,accessToken:_.data}))?a:m.current.contentWindow.location.href):"404"===e.data?v(!1):i(e)};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[g,i,o]),(0,a.jsxs)(a.Fragment,{children:[f&&(0,a.jsx)(k,{isLoading:!0}),(0,a.jsx)("iframe",{sandbox:u,ref:m,id:l,className:"min-h-full w-full flex-grow overscroll-y-none md:overscroll-y-auto",allow:"accelerometer; autoplay; camera; encrypted-media; fullscreen; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; payment; usb; vr; xr-spatial-tracking; screen-wake-lock; magnetometer; ambient-light-sensor; battery; gamepad; picture-in-picture; display-capture; bluetooth;",onLoad:()=>v(!1),onError:()=>{v(!1)}})]})}J.displayName="PreviewIframe";let X=e=>"".concat(e,"-preview-panel");function K(e){let t=X(e);return(0,s.memo)(function(){let r=M(t=>t.activeMode===e),n=M(e=>e.currentPath),[o,i]=(0,s.useState)(n);(0,s.useEffect)(()=>{r&&i(n)},[r,n]);let{fullUrl:l,customScript:c}=M(t=>({fullUrl:q({baseUrl:t.baseUrls[e],path:o}),customScript:t.customScript})),u=(0,s.useMemo)(()=>l,[l]),{store:d}=U(),m=U().refs[e],w=(0,v.B)(),_=(0,b.V)(),E=(0,h.P)(),x=(0,s.useCallback)(e=>{i(e),r&&d.setState(t=>{t.currentPath!==e&&(t.currentPath=e)})},[d,r,i]),k=(0,s.useCallback)(e=>{if(r){var t,a;if(!function(e,t){if("CONSOLE_OUTPUT"!==e.data.type)return;let r=[];if(Array.isArray(e.data.messages))e.data.messages.forEach(t=>{"object"==typeof t&&null!==t&&"string"==typeof t.message&&"string"==typeof t.level?r.push({level:t.level,message:t.message.length>1e4?t.message.slice(0,1e4):t.message,logged_at:t.logged_at||e.data.logged_at||new Date().toISOString()}):g.logging.warn("Received invalid message format within messages array",{msgData:t})});else{if("string"!=typeof e.data.message||"string"!=typeof e.data.level)return g.logging.warn("Received invalid CONSOLE_OUTPUT data format",{data:e.data});r.push({level:e.data.level,message:e.data.message.length>1e4?e.data.message.slice(0,1e4):e.data.message,logged_at:e.data.logged_at||new Date().toISOString()})}t(e=>{r.length>50?e.consoleLogs=r.slice(0,50):e.consoleLogs.push(...r);let t=e.consoleLogs.reduce((e,t)=>e+t.message.length,0);for(;t>1e4||e.consoleLogs.length>50;){let r=e.consoleLogs.shift();if(!r)break;t-=r.message.length}})}(e,d.setState),t=d.setState,"NETWORK_REQUEST"===e.data.type&&t(t=>{let r={...e.data.request};r.responseBody&&r.responseBody.length>1e4&&(r.responseBody=r.responseBody.slice(0,1e4)),r.requestBody&&r.requestBody.length>1e4&&(r.requestBody=r.requestBody.slice(0,1e4)),r.error&&(r.error.message&&r.error.message.length>1e4&&(r.error.message=r.error.message.slice(0,1e4)),r.error.stack&&r.error.stack.length>1e4&&(r.error.stack=r.error.stack.slice(0,1e4))),r.url&&r.url.length>1e4&&(r.url=r.url.slice(0,1e4)),r.statusText&&r.statusText.length>1e4&&(r.statusText=r.statusText.slice(0,1e4)),t.networkRequests.push(r);let a=t.networkRequests.reduce((e,t)=>e+p(t),0);for(;a>1e5||t.networkRequests.length>50;){let e=t.networkRequests.shift();if(!e)break;a-=p(e)}}),a=d.setState,"RRWEB_EVENT"===e.data.type&&a(t=>{for(t.rrwebEvents.push(e.data.event);t.rrwebEvents.length>60;)t.rrwebEvents.shift()}),"RUNTIME_ERROR"===e.data.type||"UNHANDLED_PROMISE_REJECTION"===e.data.type)_.addRuntimeError(e.data.error,e.data.type);else if("FETCH_ERROR"===e.data.type){let t=y.p.safeParse(e.data.error),r=t.success?t.data:e.data.error;t.error&&g.logging.error("error_parsing_fetch_error",{error:t.error,event_data:e.data}),"status"in r&&(null==r?void 0:r.status)>=400&&(null==r?void 0:r.status)<500?(0,f.N)({...r,error_type:S.B.HTTP_CLIENT_ERROR},w,E):(0,f.N)({...r,error_type:S.B.HTTP_SERVER_ERROR},w,E)}else if("NETWORK_REQUEST"===e.data.type){let t=e.data.request,r=t.url.includes(".supabase.co/functions/v1");if((null==t?void 0:t.url)&&(null==t?void 0:t.status)&&(t.status<200||t.status>=300)&&r){let e="supabase/functions/"+t.url.split("/").pop()+"/index.ts";_.addRuntimeError({message:"Edge function returned ".concat(t.status,": ").concat(t.statusText||"Error",", ").concat(t.responseBody||""),error_type:S.B.SUPABASE_EDGE_FUNCTION_ERROR,url:t.url,status:t.status,filename:e,lineno:0,colno:0,stack:"not_applicable",blankScreen:!0,statusText:t.statusText,body:t.responseBody||"",method:t.method},"RUNTIME_ERROR")}}}},[r,d,_,w,E]);return(0,a.jsx)(J,{ref:m,id:t,url:u,useCustomScript:c,onNavigate:x,onMessage:k})})}let Q=K("static"),$=K("live")},99916:(e,t,r)=>{r.d(t,{g:()=>n});var a=r(27912);function n(){let{isAvailable:e}=(0,a.V)();return e?"allow-scripts allow-same-origin allow-forms allow-modals allow-pointer-lock allow-downloads allow-popups":"allow-scripts allow-same-origin allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-presentation allow-downloads allow-popups"}}}]);